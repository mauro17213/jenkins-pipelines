<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<ui:composition template="/home.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:b="http://bootsfaces.net/ui"
                xmlns:pe="http://primefaces.org/ui/extensions" >
    <ui:define name="bodyJR">
        <style>
            .ui-panelgrid .ui-grid-responsive .ui-panelgrid-cell {
                border: 1px solid #e5e2e2;
            }
            @media (max-height: 768px) {
                div#panel1 {
                    width: 100%!important;
                }
                input#j_idt60 {
                    width: 10%!important;
                }
                input#j_idt62 {
                    width: 13.56%;
                }
                input#j_idt62 {
                    width: 10%;
                }
            }
        </style>
        <center>
            <h:form id="frmCopagoModeradora" prependId="false">
                <p:remoteCommand name="cerrarDialogoMedicamento" action="#{copagoModeradoraBean.cerrarDialogoMedicamento()}"/>
                <p:remoteCommand name="cerrarDialogoPaquete" action="#{copagoModeradoraBean.cerrarDialogoPaquete()}"/>
                <p:remoteCommand name="cerrarDialogoTecnologia" action="#{copagoModeradoraBean.cerrarDialogoTecnologia()}"/>
                <p:remoteCommand name="cerrarDialogoInsumo" action="#{copagoModeradoraBean.cerrarDialogoInsumo()}"/>
                <p:toolbar>
                    <f:facet name="left" >
                        <span title="#{copagoModeradoraBean.modulo.descripcion}">#{copagoModeradoraBean.modulo.nombre}</span>
                        <p:spacer width="30"/>
                    </f:facet>
                </p:toolbar>
                <p:spacer height="30"/>
                <p:panelGrid id="panel1" 
                             style="text-align: initial; width: 85%; display: grid;justify-content: center;" columns="1">
                    <p:panel header="Búsqueda Afiliado" toggleable="true" style="height:auto; width: 100%" closable="false" >                               
                        <p:panelGrid id="panelBusquedaCedula" columns="4" layout="grid" styleClass="showcase-text-align-center">
                            <p:row>
                                <p:column class="ui-g-2">
                                    <p:outputLabel value="Tipo Documento" for="tipoDocumento" style="font-weight:bold"/>
                                </p:column>
                                <p:column class="ui-g-4">
                                    <p:selectOneMenu id="tipoDocumento" label="Tipo Documento" value="#{copagoModeradoraBean.objeto.maeTipoDocumento}"  style="width: 80%;"                                      
                                             editable="fase"  requiredMessage="Tipo Documento : Este campo es obligatorio.">
                                        <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />
                                        <f:selectItems value="#{copagoModeradoraBean.listaTiposDocumento}" var="tipo" itemValue="#{tipo.id}" itemLabel="#{tipo.nombre}" itemDescription="#{tipo.descripcion}" />
                                    </p:selectOneMenu>
                                </p:column>
                                <p:column class="ui-g-2">
                                    <p:outputLabel value="Documento" for="numeroDocumento" style="font-weight:bold" />
                                </p:column>
                                <p:column class="ui-g-4">
                                    <p:inputText id="numeroDocumento" 
                                         value="#{copagoModeradoraBean.objeto.numeroDocumento}" maxlength="16"/>
                                </p:column>
                            </p:row>
                        </p:panelGrid>
                    </p:panel>

                    <p:panel id="panelTecnologia" header="Búsqueda Tecnología" toggleable="true" style="height:auto; width: 100% " closable="false" >                               
                        <div align="right">
                            <p:commandButton title="Nueva busqueda" icon=" ui-icon-arrowrefresh-1-w">
                                <p:ajax event="click" listener="#{copagoModeradoraBean.resetFormularioTecnologia()}"/>
                            </p:commandButton>
                        </div>

                        <p:panelGrid id="panelBusquedaTecnologia" columns="4"
                                     columnClasses="ui-grid-col-2,ui-grid-col-4,ui-grid-col-2,ui-grid-col-4"
                                     layout="grid"
                                     styleClass="ui-panelgrid-blank ui-fluid" >
                            <p:row>
                                <p:column class="ui-g-1" style="width: 10%">
                                    <p:outputLabel value="Tipo Tecnología" style="font-weight:bold"/>
                                </p:column>
                                <p:column class="ui-g-2" style="width: 13.56%">
                                    <p:inputText readonly="true" value="#{copagoModeradoraBean.objetoTecnologia.tipoTecnologiaStr}"/>
                                </p:column>
                                <p:column class="ui-g-1" style="width: 10%">
                                    <p:outputLabel value="Codigo Tecnología" style="font-weight:bold"/>
                                </p:column>
                                <p:column class="ui-g-2">
                                    <p:inputText readonly="true" value="#{copagoModeradoraBean.objetoTecnologia.maTecnologiaCodigo}"/>
                                </p:column>
                                <p:column class="ui-g-2">
                                    <p:outputLabel value="Descripción Tecnología" style="font-weight:bold"/>
                                </p:column>
                                <p:column class="ui-g-2" style="width: 19.44%;">
                                    <p:inputText readonly="true" value="#{copagoModeradoraBean.objetoTecnologia.maTecnologiaValor}"/>
                                </p:column>
                                <p:column class="ui-g-2" style="width: 14%">
                                    <p:commandButton immediate="true" action="#{copagoModeradoraBean.consultarProcedimiento()}" icon="ui-icon-clipboard" title="Agregar Procedimiento" style="width: 32px"/>
                                    <p:commandButton immediate="true" action="#{copagoModeradoraBean.consultarMedicamento()}" icon="ui-icon-heart" title="Agregar Medicamento" style="width: 32px"/>
                                    <p:commandButton immediate="true" action="#{copagoModeradoraBean.consultarInsumo()}" icon="ui-icon-tag" title="Agregar Insumo" style="width: 32px"/>
                                    <p:commandButton immediate="true" action="#{copagoModeradoraBean.consultarPaquete()}" icon="ui-icon-cart" title="Agregar Paquete" style="width: 32px"/>
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column class="ui-g-2">
                                    <p:outputLabel value="Sede" style="font-weight:bold"/>
                                </p:column>
                                <p:column class="ui-g-4">
                                    <p:inputText readonly="true" value="#{copagoModeradoraBean.cntContratoDetalle.cntContratoSede.cntPrestadorSede.nombreSede}" style="width: 98%"/>
                                </p:column>
                                <p:column class="ui-g-2">
                                    <p:outputLabel value="Contrato" style="font-weight:bold"/>
                                </p:column>
                                <p:column class="ui-g-4">
                                    <p:inputText readonly="true" value="#{copagoModeradoraBean.cntContratoDetalle.cntContratoSede.cntContrato.contrato}" style="width: 98%" />
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column class="ui-g-2">
                                    <p:outputLabel value="Tarifa" style="font-weight:bold"/>
                                </p:column>
                                <p:column class="ui-g-4">
                                    <p:inputText readonly="true" value="$ #{copagoModeradoraBean.cntContratoDetalle.valorContratado}" style="width: 98%"/>
                                </p:column>
                                <p:column class="ui-g-2">
                                    <p:outputLabel value="Ámbito Contrato" style="font-weight:bold"/>
                                </p:column>
                                <p:column class="ui-g-2" style="width: 19.64%;">
                                    <p:inputText readonly="true" value="#{copagoModeradoraBean.cntContratoDetalle.maeAmbitoValor}"/>
                                </p:column>
                                <p:column class="ui-g-2" style="width: 13.8%">
                                    <p:commandButton id="btnContrato" immediate="true" action="#{copagoModeradoraBean.listarContratos()}" icon="ui-icon-script" title="Agregar Contrato" style="width: 33px"/>
                                </p:column>
                            </p:row>
                        </p:panelGrid>

                    <div align="center" style="margin-top: 10px">
                        <p:commandButton value="Buscar" 
                                         action="#{copagoModeradoraBean.ver()}" />
                        <p:spacer width="10" height="0"/>
                        <p:commandButton value="Nueva Busqueda"
                                         immediate="true">
                            <p:ajax listener="#{copagoModeradoraBean.resetFormulario()}" update="frmCopagoModeradora"/>
                        </p:commandButton>
                    </div>
                    </p:panel>

                </p:panelGrid>

            </h:form>

            <!--ver-->
            <p:dialog header="Cobros del afiliado" widgetVar="dialogoVer" appendTo="@(body)" width="80%"  modal="true" class="modal-no-scroll">
                <p:scrollPanel mode="native" style="height:500px"> 
                    <h:form id="frmVer">
                        <!--datos personales-->
                        <p:panel id="pnlVerDatosPersonales" header="Datos Personales" style="margin-bottom:10px;" toggleable="true">
                            <p:panelGrid id="panelVer1" columns="4"
                                         columnClasses="ui-grid-col-2,ui-grid-col-4,ui-grid-col-2,ui-grid-col-4"
                                         layout="grid"
                                         styleClass="ui-panelgrid-blank ui-fluid" >

                                <p:outputLabel value="Tipo Documento" style="font-weight:bold"/>
                                <p:outputLabel value="#{copagoModeradoraBean.objeto.maeTipoDocumentoValor}" />

                                <p:outputLabel value="Número Documento" style="font-weight:bold"/>
                                <p:outputLabel value="#{copagoModeradoraBean.objeto.numeroDocumento}" title="#{copagoModeradoraBean.objeto.historicoDocumentoAfiliado}" />

                                <p:outputLabel value="Primer Apellido" style="font-weight:bold"/>
                                <p:outputLabel value="#{copagoModeradoraBean.objeto.primerApellido}" />

                                <p:outputLabel value="Segundo Apellido" style="font-weight:bold"/>
                                <p:outputLabel value="#{copagoModeradoraBean.objeto.segundoApellido}" />

                                <p:outputLabel value="Primer Nombre" style="font-weight:bold"/>
                                <p:outputLabel value="#{copagoModeradoraBean.objeto.primerNombre}" />

                                <p:outputLabel value="Segundo Nombre" style="font-weight:bold"/>
                                <p:outputLabel value="#{copagoModeradoraBean.objeto.segundoNombre}" />

                                <p:outputLabel value="Fecha Nacimiento" style="font-weight:bold"/>
                                <p:outputLabel value="#{copagoModeradoraBean.objeto.fechaNacimiento}" >
                                    <f:convertDateTime type="date" pattern="yyyy-MM-dd" timeZone="America/Bogota"/>
                                </p:outputLabel>

                                <p:outputLabel value="Tipo Afiliado"  style="font-weight:bold"/>
                                <p:outputLabel value="#{copagoModeradoraBean.objeto.maeTipoAfiliadoValor}" />

                                <p:outputLabel value="Parentesco" style="font-weight:bold" />
                                <p:outputLabel value="#{copagoModeradoraBean.objeto.maeParentescoCotizanteValor}" />

                                <p:outputLabel value="Tipo Documento CF" style="font-weight:bold" />
                                <p:outputLabel value="#{copagoModeradoraBean.objeto.maeTipoDocumentoCfValor}" />

                                <p:outputLabel value="Número Documento CF" style="font-weight:bold"/>
                                <p:outputLabel value="#{copagoModeradoraBean.objeto.numeroDocumentoCf}" />

                                <p:outputLabel value="Régimen" style="font-weight:bold" />
                                <p:outputLabel value="#{copagoModeradoraBean.objeto.maeRegimenValor}" />

                                <p:outputLabel value="Estado Afiliación" style="font-weight:bold"/>
                                <p:outputLabel value="#{copagoModeradoraBean.objeto.maeEstadoAfiliacionValor}" />

                                <p:outputLabel value="Categoría IBC" style="font-weight:bold" />
                                <p:outputLabel value="#{copagoModeradoraBean.objeto.maeCategoriaIbcValor}" />

                                <p:outputLabel value="Modelo Liquidación" style="font-weight:bold"/>
                                <p:outputLabel value="#{copagoModeradoraBean.objeto.maeModeloLiquidacionValor}" />

                            </p:panelGrid>
                        </p:panel>
                        <!--datos socioeconomicos-->
                        <p:panel id="pnlVerDatosSocioeconomicos" header="Datos Socioeconómicos" style="margin-bottom:10px;" toggleable="true" collapsed="true">
                            <p:panelGrid id="panelVerDatosSocioeconomicos" columns="4"
                                         columnClasses="ui-grid-col-2,ui-grid-col-4,ui-grid-col-2,ui-grid-col-4"
                                         layout="grid"
                                         styleClass="ui-panelgrid-blank ui-fluid" >

                                <p:outputLabel value="Grupo Poblacional" style="font-weight:bold"/>
                                <p:outputLabel value="#{copagoModeradoraBean.objeto.maeGrupoPoblacionalValor}"/>

                                <p:outputLabel value="Grupo Etnico" style="font-weight:bold"/>
                                <p:outputLabel value="#{copagoModeradoraBean.objeto.maeEtniaValor}"/>

                                <p:outputLabel value="Grupo SISBEN" style="font-weight:bold"/>
                                <p:outputLabel value="#{copagoModeradoraBean.objeto.maeGrupoSisbenValor}"/>

                                <p:outputLabel value="Sub-Grupo SISBEN" style="font-weight:bold"/>
                                <p:outputLabel value="#{copagoModeradoraBean.objeto.maeSubGrupoSisbenValor}"/>

                                <p:outputLabel value="Nivel SISBEN" style="font-weight:bold"/>
                                <p:outputLabel value="#{copagoModeradoraBean.objeto.maeNivelSisbenValor}"/>

                                <p:outputLabel value="Puntaje SISBEN" style="font-weight:bold"/>
                                <p:outputLabel value="#{copagoModeradoraBean.objeto.puntajeSisben}"/>

                                <p:outputLabel value="Ficha SISBEN" style="font-weight:bold"/>
                                <p:outputLabel value="#{copagoModeradoraBean.objeto.fichaSisben}"/>

                                <p:outputLabel value="Fecha Ficha" style="font-weight:bold"/>
                                <p:outputLabel value="#{copagoModeradoraBean.objeto.fechaSisben}" >
                                    <f:convertDateTime type="date" pattern="yyyy-MM-dd" timeZone="America/Bogota"/>
                                </p:outputLabel>

                            </p:panelGrid>
                        </p:panel>

                        <p:panel id="pnlVerDiscapacidad" header="Discapacidad" style="margin-bottom:10px;" toggleable="true" collapsed="true">
                            <p:panelGrid id="panelVerDiscapacidad" >
                                <p:row>
                                    <p:column class="ui-g-2">
                                        <p:outputLabel value="Discapacidad" style="font-weight:bold"/>
                                    </p:column>
                                    <p:column class="ui-g-4">
                                        <h:outputText value="#{copagoModeradoraBean.obtenerBoolean(copagoModeradoraBean.objeto.discapacidad)}" title="#{copagoModeradoraBean.obtenerBoolean(copagoModeradoraBean.objeto.discapacidad)}"/>
                                    </p:column>
                                    <p:column class="ui-g-2">
                                        <p:outputLabel value="Tipo Discapacidad" style="font-weight:bold"/>
                                    </p:column>
                                    <p:column class="ui-g-4">
                                        <p:outputLabel value="#{copagoModeradoraBean.objeto.maeTipoDiscapacidadValor}"/>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column class="ui-g-2">
                                        <p:outputLabel value="Condicion de discapacidad" style="font-weight:bold"/>
                                    </p:column>
                                    <p:column class="ui-g-4">
                                        <p:outputLabel value="#{copagoModeradoraBean.objeto.condicionDiscapacidad}"/>
                                    </p:column>
                                    <p:column class="ui-g-2">
                                        <p:outputLabel value="Fecha inicio discapacidad" style="font-weight:bold"/>
                                    </p:column>
                                    <p:column class="ui-g-4">
                                        <p:outputLabel value="#{copagoModeradoraBean.objeto.fechaIniciodiscapacidad}">
                                            <f:convertDateTime type="date" pattern="yyyy-MM-dd" timeZone="America/Bogota"/>
                                        </p:outputLabel>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column class="ui-g-2">
                                        <p:outputLabel value="Fecha fin discapacidad" style="font-weight:bold"/>
                                    </p:column>
                                    <p:column class="ui-g-4">
                                        <p:outputLabel value="#{copagoModeradoraBean.objeto.fechaFinDiscapacidad}">
                                            <f:convertDateTime type="date" pattern="yyyy-MM-dd" timeZone="America/Bogota"/>
                                        </p:outputLabel>
                                    </p:column>
                                </p:row>
                                <p:row rendered="#{copagoModeradoraBean.objeto.discapacidad}">
                                    <p:column class="ui-g-12">
                                        <p:outputLabel value="Paciente con discapacidad, se exonera de copagos y cuotas moderadoras." style="font-weight:bold; color: red"/>
                                    </p:column>
                                </p:row>
                            </p:panelGrid>
                        </p:panel>
                        <!--mas datos socieconomicos, historicos, copagos-moderador-->
                        <p:panel id="pnlVerMasDatosSocioeconomicos" header="Topes" style="margin-bottom:10px;" toggleable="true" collapsed="true">
                            <!--tabla topes copago-->
                            <p:dataTable id="tablaTopesCopago" var="topeC" value="#{copagoModeradoraBean.listaTopeCopagos}" 
                                         widgetVar="wtablaTopesCopago" resizableColumns="true" 
                                         emptyMessage="No se encontraron registros"
                                         paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                         rowsPerPageTemplate="5,10,30,50,100" 
                                         rows="10" paginator="true">                             
                                <f:facet name="header">
                                    Topes copago del #{copagoModeradoraBean.anioActual}
                                </f:facet>                           
                                <p:column headerText="Regimen" >                                    
                                    <h:outputText value="#{topeC.maeRegimenValor}" title="#{topeC.maeRegimenValor}"/>
                                </p:column>
                                <p:column headerText="Tipo Afiliado" >                                    
                                    <h:outputText value="#{topeC.maeTipoAfiliadoValor}" title="#{topeC.maeTipoAfiliadoValor}"/>
                                </p:column>
                                <p:column headerText="Nivel Sisben" >                                    
                                    <h:outputText value="#{topeC.maeNivelSisbenValor}" title="#{topeC.maeNivelSisbenValor}"/>
                                </p:column>
                                <p:column headerText="Categoria" >                                    
                                    <h:outputText value="#{copagoModeradoraBean.obtenerCategoria(topeC.categoriaIbc)}" title="#{copagoModeradoraBean.obtenerCategoria(topeC.categoriaIbc)}"/>
                                </p:column>
                                <p:column headerText="Porcentaje" >                                    
                                    <h:outputText value="#{topeC.porcentaje} %" title="#{topeC.porcentaje}"/>
                                </p:column>
                                <p:column headerText="Valor Tope Evento" >                                    
                                    <h:outputText value="#{topeC.valorTopeEvento}" title="#{topeC.valorTopeEvento}">
                                        <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="0"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Valor Tope Año" >                                    
                                    <h:outputText value="#{topeC.valorTopeAgno}" title="#{topeC.valorTopeAgno}">
                                        <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="0"/>
                                    </h:outputText>
                                </p:column>
                            </p:dataTable>
                            <p:spacer/>
                            <!--tabla topes moderadora-->
                            <p:dataTable id="tablaTopesModeradora" var="tope" value="#{copagoModeradoraBean.listaTopeModeradoras}" 
                                         widgetVar="wtablaTopesModeradora" resizableColumns="true" 
                                         emptyMessage="No se encontraron registros"
                                         paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                         rowsPerPageTemplate="5,10,30,50,100" 
                                         rows="10" paginator="true">                             
                                <f:facet name="header">
                                    Topes moderadora del #{copagoModeradoraBean.anioActual}
                                </f:facet>                           
                                <p:column headerText="Regimen" >                                    
                                    <h:outputText value="#{tope.maeRegimenValor}" title="#{tope.maeRegimenValor}"/>
                                </p:column>
                                <p:column headerText="Tipo Afiliado" >                                    
                                    <h:outputText value="#{tope.maeTipoAfiliadoValor}" title="#{tope.maeTipoAfiliadoValor}"/>
                                </p:column>
                                <p:column headerText="Nivel Sisben" >                                    
                                    <h:outputText value="#{tope.maeNivelSisbenValor}" title="#{tope.maeNivelSisbenValor}"/>
                                </p:column>
                                <p:column headerText="Categoria" >                                    
                                    <h:outputText value="#{copagoModeradoraBean.obtenerCategoria(tope.categoriaIbc)}" title="#{copagoModeradoraBean.obtenerCategoria(tope.categoriaIbc)}"/>
                                </p:column>                              
                                <p:column headerText="Valor" >                                    
                                    <h:outputText value="#{tope.valor}" title="#{tope.valor}">
                                        <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="0"/>
                                    </h:outputText>
                                </p:column>
                            </p:dataTable>
                            <p:spacer/>
                            <!--tabla historico copago moderadora-->
                            <p:dataTable id="tablaHistorico" widgetVar="tablaWidgetHistorico" var="objeto" value="#{copagoModeradoraBean.lazyCopagoModeradoraHistorico}" rowKey="#{objeto.id}"
                                         rows="10" paginator="true" lazy="true" reflow="true"
                                         currentPageReportTemplate="Registros del {startRecord} al {endRecord} de {totalRecords}, Página {currentPage} de {totalPages}"
                                         paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                         rowsPerPageTemplate="5,10,30,50,100" 
                                         emptyMessage= "No se encontro historicos">
                                <f:facet name="header">
                                    Historico copago y moderadora del #{copagoModeradoraBean.anioActual}
                                </f:facet>                             

                                <p:column headerText="Autorización" filterBy="#{objeto.auAnexos4Id.id}">
                                    <f:facet name="filter">
                                        <p:inputText label="Autorización" maxlength="50" style="width: 95%;" onchange="PF('tablaWidgetHistorico').filter()"/>
                                    </f:facet>
                                    <h:outputText value="#{objeto.auAnexos4Id.id}"/>
                                </p:column>
                                <p:column headerText="Tipo/Cobro" filterBy="#{objeto.moderadoraCopago}">
                                    <f:facet name="filter">
                                        <p:selectOneMenu onchange="PF('tablaWidgetHistorico').filter()" >
                                            <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />
                                            <f:selectItem itemLabel="Copago" itemValue="true" />
                                            <f:selectItem itemLabel="Moderadora" itemValue="false" />
                                        </p:selectOneMenu>
                                    </f:facet>
                                    <h:outputText value="#{objeto.moderadoraCopagoStr()}"/>
                                </p:column>
                                <p:column headerText="Valor Proyectado">

                                    <h:outputText value="#{objeto.valorProyectado}">
                                        <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="0"/>
                                    </h:outputText>
                                </p:column>

                                <p:columnGroup type="footer">
                                    <p:row>
                                        <p:column colspan="2" style="text-align:right;font-weight:bold" footerText="Total Copago:"/>
                                        <p:column>
                                            <f:facet name="footer">
                                                <h:outputText style="font-weight:bold" value="#{copagoModeradoraBean.totalCopagoHistorico}">
                                                    <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="0"/>
                                                </h:outputText>
                                            </f:facet>
                                        </p:column>                                       
                                    </p:row>
                                    <p:row>
                                        <p:column colspan="2" style="text-align:right;font-weight:bold" footerText="Total Moderadora:"/>                                      
                                        <p:column >
                                            <f:facet name="footer">
                                                <h:outputText style="font-weight:bold" value="#{copagoModeradoraBean.totalModeradoraHistorico}">
                                                    <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="0"/>
                                                </h:outputText>
                                            </f:facet>
                                        </p:column>
                                    </p:row>
                                </p:columnGroup>

                            </p:dataTable>   
                        </p:panel>      
                        <!--datos tecnologia--> 
                        <p:panel id="pnlVerTecnlogia" header="Datos Tecnología" style="margin-bottom:10px;" toggleable="true">
                            <p:panelGrid id="panelVerTecnologia" columns="4"
                                         columnClasses="ui-grid-col-2,ui-grid-col-4,ui-grid-col-2,ui-grid-col-4"
                                         layout="grid"
                                         styleClass="ui-panelgrid-blank ui-fluid" >

                                <p:outputLabel value="Tipo" style="font-weight:bold"/>
                                <p:outputLabel value="#{copagoModeradoraBean.objetoTecnologia.tipoTecnologiaStr}"/>

                                <p:outputLabel value="Codigo" style="font-weight:bold"/>
                                <p:outputLabel value="#{copagoModeradoraBean.objetoTecnologia.maTecnologiaCodigo}"/>

                                <p:outputLabel value="Descripción" style="font-weight:bold"/>
                                <p:outputLabel value="#{copagoModeradoraBean.objetoTecnologia.maTecnologiaValor}"/>

                                <p:outputLabel value="Sede" style="font-weight:bold"/>
                                <p:outputLabel value="#{copagoModeradoraBean.cntContratoDetalle.cntContratoSede.cntPrestadorSede.nombreSede}"/>

                                <p:outputLabel value="Contrato" style="font-weight:bold"/>
                                <p:outputLabel value="#{copagoModeradoraBean.cntContratoDetalle.cntContrato.contrato}"/>

                                <p:outputLabel value="Tarifa" style="font-weight:bold"/>
                                <p:outputLabel value="$ #{copagoModeradoraBean.cntContratoDetalle.valorContratado}"/>

                                <p:outputLabel value="Ambito" style="font-weight:bold"/>
                                <p:selectOneMenu style="width: 80%;" value="#{copagoModeradoraBean.codigoAmbito}">
                                    <f:selectItems value="#{copagoModeradoraBean.listaTipoAmbito}" var="tipoAmb" itemValue="#{tipoAmb.valor}" itemLabel="#{tipoAmb.nombre}" itemDescription="#{tipoAmb.descripcion}" />
                                    <p:ajax event="change" listener="#{copagoModeradoraBean.refrescarValores()}"/>
                                </p:selectOneMenu>

                                <p:outputLabel value="SM" title="Subsidiado - Moderadora" style="font-weight:bold"/>
                                <p:outputLabel value="#{copagoModeradoraBean.aplicaSM}"/>

                                <p:outputLabel value="SC" title="Subsidiado - Copago" style="font-weight:bold"/>
                                <p:outputLabel value="#{copagoModeradoraBean.aplicaSC}"/>

                                <p:outputLabel value="CM" title="Contributivo - Moderadora" style="font-weight:bold"/>
                                <p:outputLabel value="#{copagoModeradoraBean.aplicaCM}"/>

                                <p:outputLabel value="CC" title="Contributivo - Copago" style="font-weight:bold"/>
                                <p:outputLabel value="#{copagoModeradoraBean.aplicaCC}"/>

                            </p:panelGrid>
                        </p:panel>
                        <!--programa especiales-->
                        <p:panel id="pnlVerProgramasEspeciales" header="Programas Especiales" style="margin-bottom:10px;" toggleable="true">

                            <div align="right">
                                <p:selectBooleanCheckbox value="#{copagoModeradoraBean.aplicaProgramasEspecial}" title="Aplica Programa Especial" itemLabel="Aplica">
                                    <p:ajax listener="#{copagoModeradoraBean.refrescarValores()}"/>
                                </p:selectBooleanCheckbox>
                            </div>

                            <p:dataTable id="tablaProgramas" var="objPrograma" value="#{copagoModeradoraBean.listaProgramasEspeciales}" 
                                         widgetVar="wtablaProgramas" resizableColumns="true" emptyMessage="No se encontraron registros">                             
                                <p:column headerText="Programa" >                                    
                                    <h:outputText value="#{objPrograma.descripcionPrograma}" title="#{objPrograma.descripcionPrograma}"/>
                                </p:column>                            
                                <p:column headerText="Exonerado Copago" >                                    
                                    <h:outputText value="#{copagoModeradoraBean.obtenerBoolean(objPrograma.exoneradoCopago)}" title="#{copagoModeradoraBean.obtenerBoolean(objPrograma.exoneradoCopago)}"/>
                                </p:column>
                                <p:column headerText="Exonerado obligatorio" >                                    
                                    <h:outputText value="#{copagoModeradoraBean.obtenerBoolean(objPrograma.exoneracionObligatoria)}" title="#{copagoModeradoraBean.obtenerBoolean(objPrograma.exoneracionObligatoria)}"/>
                                </p:column>
                            </p:dataTable>                                                   
                        </p:panel>
                        <!--tutelas-->
                        <p:panel id="pnlVerTutelas" header="Tutelas" style="margin-bottom:10px;" toggleable="true">

                            <div align="right">
                                <p:selectBooleanCheckbox value="#{copagoModeradoraBean.aplicaTutelas}" title="Aplica Tutela" itemLabel="Aplica" >
                                    <p:ajax listener="#{copagoModeradoraBean.refrescarValores()}"/>
                                </p:selectBooleanCheckbox>
                            </div>

                            <p:dataTable id="tablaTutelas" var="tutela" value="#{copagoModeradoraBean.listaTutelas}" 
                                         widgetVar="tablaTutelas" resizableColumns="true" emptyMessage="No se encontraron registros">
                                <p:column headerText="Número Tutela">
                                    <h:outputText value="#{tutela.numeroTutela}" />
                                </p:column>
                                <p:column headerText="Exonerado Copago">
                                    <h:outputText value="#{tutela.exoneracionCopago}" />
                                </p:column>
                                <p:column headerText="Estado">
                                    <h:outputText value="#{tutela.estadoProceso}" />
                                </p:column>
                            </p:dataTable> 
                        </p:panel>                   
                        <!--panel cobros-->
                        <p:panel id="pnlCobros" header="Información de cobros" style="margin-bottom:10px;" toggleable="true">
                            <p:panelGrid id="panelCobros" columns="4"
                                         columnClasses="ui-grid-col-2,ui-grid-col-4,ui-grid-col-2,ui-grid-col-4"
                                         layout="grid"
                                         styleClass="ui-panelgrid-blank ui-fluid" >

                                <p:outputLabel value="Aplica Copago" style="font-weight:bold"/>
                                <p:outputLabel value="#{copagoModeradoraBean.aplicaCopago}"/>

                                <p:outputLabel value="Aplica Moderadora" style="font-weight:bold"/>
                                <p:outputLabel value="#{copagoModeradoraBean.aplicaCuotaModeradora}"/>
                                
                                <p:outputLabel value="Aplica Tope Afiliado" style="font-weight:bold"/>
                                <p:outputLabel value="#{copagoModeradoraBean.apliacaTopeAfiliado}"/>

                                <p:outputLabel value="Valor copago" style="font-weight:bold"/>
                                <h:outputText value="#{copagoModeradoraBean.valorCopago}">
                                    <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="0"/>
                                </h:outputText>  

                                <p:outputLabel value="Valor Moderadora" style="font-weight:bold"/>
                                <h:outputText value="#{copagoModeradoraBean.valorCuotaModeradora}">
                                    <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="0"/>
                                </h:outputText>  

                                <p:outputLabel value="Porcentaje" style="font-weight:bold"/>
                                <h:outputText value="#{copagoModeradoraBean.porcentajeRecuperacion} %">
                                </h:outputText>  

                            </p:panelGrid>
                        </p:panel>
                        <p:panelGrid id="panelVer4" style="width:98%;height:auto;">
                            <f:facet name="footer">
                                <p:row>
                                    <p:column colspan="4" style="text-align: center">
                                        <h:panelGroup style="display:block; text-align:center; margin-top: 10px;">
                                            <p:commandButton value="Cerrar" type="button" onclick="PF('dialogoVer').hide()" immediate="true"/>
                                        </h:panelGroup>
                                    </p:column>
                                </p:row>
                            </f:facet>
                        </p:panelGrid>
                    </h:form>
                </p:scrollPanel>
            </p:dialog>       
            <!--Lista Contrato Detalle-->
            <p:dialog header="Consultar Contrato" widgetVar="dialogoContratoLista" appendTo="@(body)" modal="true" style="max-width: 90%;max-height: 90%;" dynamic="true">
                <p:scrollPanel mode="native" style="max-height: 550px;">
                    <h:form id="frmContratoLista">
                        <div align="right">
                            <p:commandButton rendered="#{copagoModeradoraBean.accionListar}" title="Refrescar" actionListener="#{copagoModeradoraBean.refrescarContratoDetalle()}" icon="ui-icon-refresh"/>
                        </div>
                        <p:dataTable id="tablaContratoLista" widgetVar="tablaWidgetContratoLista" var="objetoContrato" value="#{copagoModeradoraBean.lazyContratoDetalles}" rowKey="#{objetoContrato.id}"
                                     rows="#{copagoModeradoraBean.tamanoPagina}" paginator="true" lazy="true" reflow="true"
                                     currentPageReportTemplate="Registros del {startRecord} al {endRecord} de {totalRecords}, Página {currentPage} de {totalPages}"
                                     paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                     rowsPerPageTemplate="5,10,30,50,100" 
                                     emptyMessage= "No se encontro un prestador con los servicios seleccionados contratados" selectionMode="single">
                            <p:ajax event="rowSelect" listener="#{copagoModeradoraBean.onRowSelectContrato}"/>
                            <p:column headerText="Código Habilitación" filterBy="#{objetoContrato.cntContratoSede.cntPrestadorSede.codigoHabilitacionSede}">
                                <f:facet name="filter">
                                    <p:inputText label="Código Habilitación" maxlength="128" style="width: 95%;" onchange="PF('tablaWidgetContratoLista').filter()"/>
                                </f:facet>
                                <h:outputText value="#{objetoContrato.cntContratoSede.cntPrestadorSede.codigoHabilitacionSede}"/>
                            </p:column>
                            <p:column headerText="Razón Social" filterBy="#{objetoContrato.cntContratoSede.cntPrestadorSede.cntPrestador.razonSocial}">
                                <f:facet name="filter">
                                    <p:inputText label="Razón social" maxlength="128" style="width: 95%;" onchange="PF('tablaWidgetContratoLista').filter()"/>
                                </f:facet>
                                <h:outputText value="#{objetoContrato.cntContratoSede.cntPrestadorSede.cntPrestador.razonSocial}"/>
                            </p:column>
                            <p:column headerText="Prestador Sede" filterBy="#{objetoContrato.cntContratoSede.cntPrestadorSede.nombreSede}">
                                <f:facet name="filter">
                                    <p:inputText label="Prestador Sede" maxlength="128" style="width: 95%;" onchange="PF('tablaWidgetContratoLista').filter()"/>
                                </f:facet>
                                <h:outputText value="#{objetoContrato.cntContratoSede.cntPrestadorSede.nombreSede}"/>
                            </p:column>
                            <p:column headerText="Dirección">
                                <h:outputText value="#{objetoContrato.cntContratoSede.cntPrestadorSede.direccion}"/>
                            </p:column>
                            <p:column headerText="Municipio">
                                <h:outputText value="#{copagoModeradoraBean.obtenerMunicipio(objetoContrato.cntContratoSede.cntPrestadorSede.ubicacionId)}"/>
                            </p:column>
                            <p:column headerText="Código Servicio" filterBy="#{objetoContrato.maServicioHabilitacionCodigo}">
                                <f:facet name="filter">
                                    <p:inputText label="Código Servicio" maxlength="128" style="width: 95%;" onchange="PF('tablaWidgetContratoLista').filter()"/>
                                </f:facet>
                                <h:outputText value="#{objetoContrato.maServicioHabilitacionCodigo}"/>
                            </p:column>
                            <p:column headerText="Servicio Contratado" filterBy="#{objetoContrato.maServicioHabilitacionValor}">
                                <f:facet name="filter">
                                    <p:inputText label="Servicio Habilitación" maxlength="128" style="width: 95%;" onchange="PF('tablaWidgetContratoLista').filter()"/>
                                </f:facet>
                                <h:outputText value="#{objetoContrato.maServicioHabilitacionValor}"/>
                            </p:column>
                            <p:column headerText="Tarifa" sortBy="#{objetoContrato.valorContratado}">
                                <h:outputText value="$ #{objetoContrato.valorContratado}"/>
                            </p:column>
                            <p:column headerText="Ámbito" filterBy="#{objetoContrato.maeAmbitoValor}">
                                <f:facet name="filter">
                                    <p:inputText label="Ámbito" maxlength="128" style="width: 95%;" onchange="PF('tablaWidgetContratoLista').filter()"/>
                                </f:facet>
                                <h:outputText value="#{objetoContrato.maeAmbitoValor}"/>
                            </p:column>
                        </p:dataTable>                    
                    </h:form>
                </p:scrollPanel>
            </p:dialog>
            <!--Ver tutela Servicio -->
            <p:dialog header="Ver Tutela" widgetVar="dialogoTutelaServicio" appendTo="@(body)" modal="true" width="90%" dynamic="true" class="modal-no-scroll">
                <p:scrollPanel mode="native" style="height: 500px" >
                    <h:form id="frmTutelaServicio">
                        <!-- Informacíon Basica -->
                        <p:panel id="pTutelaServicioInfo" header="Información Tutela" style="margin-bottom:10px;" collapsed="false" toggleable="true">
                            <p:panelGrid id="panelTutelaServicioInfo" columns="4"
                                         columnClasses="ui-grid-col-2,ui-grid-col-4,ui-grid-col-2,ui-grid-col-4"
                                         layout="grid"
                                         styleClass="ui-panelgrid-blank ui-fluid" >

                                <p:outputLabel value="Número Tutela" style="font-weight:bold"/>
                                <p:outputLabel id="numeroTutelaVerTutelaServicio" value="#{copagoModeradoraBean.tuTutelaRespuesta.numeroTutela}"/>

                                <p:outputLabel value="Estado" style="font-weight:bold"/>
                                <p:outputLabel id="estadoVerTutelaServicio" value="#{copagoModeradoraBean.tuTutelaRespuesta.estadoProceso}" />

                                <p:outputLabel value="Fecha Notificación" style="font-weight:bold"/>
                                <p:outputLabel id="fechaNotificacionVerTutelaServicio" value="#{copagoModeradoraBean.tuTutelaRespuesta.feachaNotificacion}">
                                    <f:convertDateTime type="date" pattern="yyyy-MM-dd" timeZone="America/Bogota" />
                                </p:outputLabel>

                                <p:outputLabel value="Fecha Vencimiento" style="font-weight:bold"/>
                                <p:outputLabel id="fechaVencimientoVerTutelaServicio" value="#{copagoModeradoraBean.tuTutelaRespuesta.feachaVencimiento}" >
                                    <f:convertDateTime type="date" pattern="yyyy-MM-dd HH:mm" timeZone="America/Bogota" />
                                </p:outputLabel>

                                <p:outputLabel value="Tipo Fase" style="font-weight:bold"/>
                                <p:outputLabel id="faseVerTutelaServicio" value="#{copagoModeradoraBean.tuTutelaRespuesta.tipoFase}"/>

                                <p:outputLabel value="Número Radicado" style="font-weight:bold"/>
                                <p:outputLabel id="numeroRadicadoVerTutelaServicio" value="#{copagoModeradoraBean.tuTutelaRespuesta.numeroRadicadoJuzgado}" />

                                <p:outputLabel value="Número Fallo" style="font-weight:bold"/>
                                <p:outputLabel id="numeroFalloVerTutelaServicio" value="#{copagoModeradoraBean.tuTutelaRespuesta.numeroFallo}"/>

                                <p:outputLabel value="Fecha Fallo" style="font-weight:bold"/>
                                <p:outputLabel id="fechaFalloVerTutelaServicio" value="#{copagoModeradoraBean.tuTutelaRespuesta.fechaFallo}" >
                                    <f:convertDateTime type="date" pattern="yyyy-MM-dd HH:mm" timeZone="America/Bogota" />
                                </p:outputLabel>

                                <p:outputLabel value="Medida Provisional" style="font-weight:bold"/>
                                <p:outputLabel id="provisionalVerTutelaServicio" value="#{copagoModeradoraBean.tuTutelaRespuesta.medidaProvisional}"/>

                                <p:outputLabel value="Integralidad" style="font-weight:bold"/>
                                <p:outputLabel id="integralidadVerTutelaServicio" value="#{copagoModeradoraBean.tuTutelaRespuesta.integralidad}" />

                            </p:panelGrid>
                        </p:panel>
                        <!-- Servicios -->
                        <p:panel id="pTutelaServicioServicios" header="Servicios" style="margin-bottom:10px;" collapsed="false" toggleable="true">
                            <p:dataTable id="tablaTutelaServicioservicios" var="tutelaServicio" value="#{copagoModeradoraBean.tuTutelaRespuesta.servicios}" widgetVar="tablaTutelaServicioservicios" resizableColumns="true" emptyMessage="No se encontraron registros" style="text-align: center" >
                                <p:column headerText="Código">
                                    <h:outputText value="#{tutelaServicio.maTecnologiaCodigo}" />
                                </p:column>
                                <p:column headerText="Descripción">
                                    <h:outputText value="#{tutelaServicio.maTecnologiaValor}" />
                                </p:column>
                            </p:dataTable>
                        </p:panel>
                        <!-- Diagnosticos -->
                        <p:panel id="pTutelaServicioDiagnosticos" header="Diagnosticos" style="margin-bottom:10px;" collapsed="false" toggleable="true">
                            <p:dataTable id="tablaTutelaServicioDiagnosticos" var="tutelaDiagnostico" value="#{copagoModeradoraBean.tuTutelaRespuesta.diagnosticos}" widgetVar="tablaTutelaServicioDiagnosticos" resizableColumns="true" emptyMessage="No se encontraron registros" style="text-align: center" >
                                <p:column headerText="Código">
                                    <h:outputText value="#{tutelaDiagnostico.maDiagnosticosCodigo}" />
                                </p:column>
                                <p:column headerText="Descripción">
                                    <h:outputText value="#{tutelaDiagnostico.maDiagnosticosValor}" />
                                </p:column>
                            </p:dataTable>
                        </p:panel>
                        <!-- Anexos -->
                        <p:panel id="pTutelaServicioAnexos" header="Anexos" style="margin-bottom:10px;" collapsed="false" toggleable="true">
                            <p:dataTable id="tablaTutelaServicioAnexos" var="tutelaAnexo" value="#{copagoModeradoraBean.tuTutelaRespuesta.adjuntos}" widgetVar="tablaTutelaServicioAnexos" resizableColumns="true" emptyMessage="No se encontraron registros" style="text-align: center" >
                                <p:column headerText="Nombre">
                                    <h:outputText value="#{tutelaAnexo.nombreArchivo}" />
                                </p:column>
                                <p:column headerText="Acciones" style="text-align: center">
                                    <p:commandButton title="Descargar" ajax="false" onclick="PrimeFaces.monitorDownload(start, stop);" icon="ui-icon-arrowthickstop-1-s">
                                        <p:fileDownload value="#{copagoModeradoraBean.descargarAdjunto(tutelaAnexo)}" />
                                    </p:commandButton>
                                </p:column>
                            </p:dataTable>
                        </p:panel>
                        <!--Acciones-->
                        <p:panelGrid id="panelAccionesVerTutelaServicio" style="width:100%;margin:10px 0px">
                            <f:facet name="footer">
                                <p:row>
                                    <p:column colspan="6" style="text-align: center">
                                        <p:commandButton value="Salir" type="button" onclick="PF('dialogoTutelaServicio').hide()" immediate="true" style="margin-left: 5px;"/>
                                    </p:column>
                                </p:row>
                            </f:facet>
                        </p:panelGrid>
                    </h:form>
                </p:scrollPanel>                
            </p:dialog>
            <ui:include src="../maestro/seleccion/sel_medicamentos.xhtml" />
            <ui:include src="../maestro/seleccion/sel_insumos.xhtml" /> 
            <ui:include src="../maestro/seleccion/sel_paquetes.xhtml" /> 
            <ui:include src="../maestro/seleccion/sel_tecnologias.xhtml" />
        </center>
    </ui:define>
</ui:composition>