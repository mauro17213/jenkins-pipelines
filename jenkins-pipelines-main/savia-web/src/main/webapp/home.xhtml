<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

    <h:head>
        <f:facet name="first">
            <h:outputStylesheet name="css/default.css"/>
            <h:outputStylesheet name="css/cssLayout.css"/>
            <h:outputStylesheet name="css/sistema.css"/>
            <h:outputStylesheet name="primeicons/primeicons.css" library="primefaces" />
            <h:outputStylesheet library="webjars" name="primeflex/3.3.1/primeflex.min.css" />
            <meta content='text/html; charset=UTF-8' http-equiv="Content-Type"/>
            <link rel="icon" type="image/x-icon" href="/savia/resources/images/icono.png"/>
            <title>Conexiones Savia</title>
        </f:facet>
    </h:head>
    <style>
        body {
            overflow-y: hidden!important;
            overflow-x: hidden!important;
            margin:0px;
        }
        .ui-dialog.ui-widget-content .ui-dialog-titlebar {
           
            border-bottom: 1px solid #eee;
            background-color: #f5f5f5;
        }
        .growl {
            width: 300px;
        }
        .ui-badge.ui-badge-no-gutter {
            border-radius: 100%;
            padding: 0px 5px;
        }
        .ui-panel .ui-panel-content {
            padding: 0;
        }
        .ui-widget .ui-widget {
            font-size: 12px;
        }
        .ui-panel .ui-panel-titlebar {
            padding-left: 5px;
        }
        .ui-panelgrid .ui-panelgrid-footer {
            text-align: center!important;

        }
        .ui-menu.ui-widget li > .ui-menuitem-link {
            padding: 0.3em 0;
            width: 100%;
            border-width: 1px 0px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: -4px;
        }


    </style>
    <script type="text/javascript">
        window.onload = function () {
            document.getElementsByClassName('txtModulo').item(0).value = sessionStorage.getItem('Modulo');
        }
    </script>
    <div id="overlay">
        <div class="loader">Cargando...</div>
    </div>
    <h:body style="background: white;">
        <f:view>
            <p:splitter layout="vertical" style="width: 100%">
                <p:splitterPanel size="10" style="background: white">
                    <table style="width: 100%;">
                        <tr>
                            <th style="width: 50%;text-align: left;">
                        <h:graphicImage value="/resources/images/logo_aplicacion.png" style="height: 50px;" title="Sistema Savia" />
                        </th>
                        <th style="text-align: right;">
                        <h:form id="frmModulo">
                            <p:inputText id="txtModulo" class="txtModulo" value="#{homeBean.moduloAbierto}" style="visibility: hidden"/>
                            <p:commandLink onclick="PrimeFaces.monitorDownload();" title="Ayuda" ajax="false" process="@form">
                                <h:graphicImage value="/resources/images/ayuda.png" />
                                <p:fileDownload value="#{homeBean.generarManual()}" />
                            </p:commandLink>
                        </h:form>                                
                        </th>
                        </tr>
                    </table>
                </p:splitterPanel>
                <p:splitterPanel size="90" style="background: white">
                    <p:splitter>
                        <p:splitterPanel styleClass="flex" size="10" style="max-width: 15vw" class="card" >    
                            <p:scrollPanel style="max-height:88vh" mode="native">
                                <h:form id="frmSelEmpBoton">
                                    <p:growl id="mensajeGeneral" escape="false" showSummary="true" showDetail="true" sticky="false" class="growl">
                                        <p:autoUpdate />
                                    </p:growl>
                                    <p:panel header="Menu Principal" footer="Ver. #{homeBean.moduloVersion.version} (#{homeBean.moduloVersion.fechaVersion})">
                                        <p:menu style="width: 100%" >
                                            <p:submenu label="#{sessionScope.conexion.usuario.nombre}">
                                                <p:menuitem>
                                                    <p:selectOneMenu value="#{homeBean.empresa.id}" filter="true" filterMatchMode="contains" required="true" style="width: 160px;" rendered="#{sessionScope.conexion.usuario.empresa.administradora}"> 
                                                        <p:ajax listener="#{homeBean.cambioEmpresa}" />
                                                        <f:selectItem itemLabel="#{sessionScope.conexion.empresa.nombreComercial}" itemValue="#{sessionScope.conexion.empresa.id}" />
                                                        <f:selectItems value="#{homeBean.empresasConFiltro}" var="emp" itemValue="#{emp.id}" itemLabel="#{emp.nombreComercial}" itemDescription="#{emp.nombreComercial} - #{emp.descripcion}"/>
                                                    </p:selectOneMenu>  
                                                </p:menuitem>
                                                <p:menuitem>
                                                    <p:commandButton action="#{homeBean.refrescar}" title="Inicio" icon="pi pi-home" oncomplete="sessionStorage.clear();"/>

                                                    <p:badge id="cantidadPendientes" value="#{homeBean.alertasPendientes}" style="background-color: #04997C;">
                                                        <p:commandButton action="#{homeBean.listarAlertas()}" title="Alertas" icon="#{homeBean.getIconAlerta()}" />
                                                    </p:badge>

                                                    <p:commandButton action="#{homeBean.cambiarContrasena}" title="Cambio Contraseña" icon="pi pi-key" />
                                                    <p:commandButton action="#{homeBean.salir}" title="Salir del Sistema" icon="pi pi-power-off" oncomplete="sessionStorage.clear();"/>
                                                </p:menuitem>
                                            </p:submenu>
                                        </p:menu>
                                        <p:panelMenu  style="padding-top: 2px;" model="#{sessionScope.conexion.menuModel}"/>
                                    </p:panel>                       
                                </h:form> 
                            </p:scrollPanel>
                        </p:splitterPanel>
                        <p:splitterPanel id="spliterVista" styleClass="flex" size="90" style="max-width: 85vw" class="card">
                            <p:scrollPanel mode="native" style="max-height: 88vh;">
                                <ui:insert name="bodyJR">
                                    <center>
                                        <h:form id="frmDashBoard">
                                            <div style="background: url(/savia/resources/images/home.png); background-size:cover;
                                                 width:84vw; height:87vh; background-repeat:no-repeat;
                                                 background-position:center;">                                    

                                                <a title="Savia Salud EPS" href="http://www.saviasaludeps.com/" target="_blank"></a>
                                                <p:scrollPanel mode="native" style="max-height: 40%" rendered="#{homeBean.listaMensajes.size() > 0}">
                                                    <p:panel id="panelMensajes" header="Mensajes">
                                                        <p:accordionPanel value="#{homeBean.listaMensajes}" var="mensaje" widgetVar="accordion" style="text-align: start" styleClass="ui-accordion" activeIndex="" >
                                                            <p:tab title="#{mensaje.nombre}">
                                                                <p:panelGrid>
                                                                    <p:row style="width: 100%">
                                                                        <p:column style="text-align: end; width: 3%; border-color: transparent">
                                                                            <i class="pi pi-circle-on" style="color : #{homeBean.colorMensaje(mensaje)}" />
                                                                        </p:column>
                                                                        <p:column style="text-align: start; width: 93%; border-color: transparent">
                                                                            <p:outputLabel value="#{mensaje.descripcon}"/>
                                                                        </p:column>
                                                                        <p:column style="text-align: end; width: 4%; border-color: transparent; left: 20px;">
                                                                            <p:commandButton ajax="true" title="Ver" actionListener="#{homeBean.mostrarMensaje(mensaje)}" icon="pi pi-search" immediate="true"/>
                                                                        </p:column>
                                                                    </p:row>
                                                                </p:panelGrid>
                                                            </p:tab>
                                                        </p:accordionPanel>
                                                    </p:panel>
                                                </p:scrollPanel>
                                            </div>
                                        </h:form>
                                        <!-- Mensaje -->
                                        <p:dialog header="Mensaje" widgetVar="dialogoVerMensajeHome" appendTo="@(body)" modal="true" width="80%" height="400px" dynamic="true" >                                
                                            <h:form id="frmVerMensajeHome">
                                                <p:panelGrid id="panelVerMensaje" columns="1" layout="grid" styleClass="showcase-text-align-center">
                                                    <p:textEditor id="texto" secure="false" toolbarVisible="false" value="#{homeBean.objetoMensaje.texto}" style="width:99%"  readonly="true">
                                                    </p:textEditor>
                                                </p:panelGrid>                                                                                
                                            </h:form>
                                        </p:dialog>
                                    </center>
                                </ui:insert>      
                            </p:scrollPanel>
                        </p:splitterPanel>
                    </p:splitter>
                    <p:dialog header="Alertas" widgetVar="dialogoListaAlertas" appendTo="@(body)" modal="true" style="max-width: 90%;max-height: 90%;" dynamic="true" >
                        <p:scrollPanel mode="native" style="height: 400px" >
                            <h:form id="frmListaAlertas">
                                <p:dataTable id="tablaAlertas" var="obj" value="#{homeBean.listaAlertas}" 
                                             emptyMessage="No se encontraron registros"
                                             widgetVar="tablaAlertas"
                                             scrollable="true"
                                             rowKey="#{obj.id}" >

                                    <p:column headerText="Severidad">
                                        <h:outputText value="#{obj.severidadStr}"/>
                                    </p:column>

                                    <p:column headerText="Nombre" >
                                        <h:outputText value="#{obj.nombre}"/>
                                    </p:column>

                                    <p:column style="text-align: center;">
                                        <f:facet name="header">
                                            <h:outputText value="Acciones"/>
                                        </f:facet>    
                                        <p:commandButton title="Ver" actionListener="#{homeBean.verAlerta(obj)}" icon="pi pi-search"/>
                                    </p:column>
                                </p:dataTable>
                                <p:panelGrid style="width: 100%;margin:10px 0px">
                                    <f:facet name="footer">
                                        <p:row >
                                            <p:column colspan="4" style="text-align: center">
                                                <p:commandButton value="Salir" type="button" onclick="PF('dialogoListaAlertas').hide()" immediate="true"/>
                                            </p:column>
                                        </p:row>
                                    </f:facet>
                                </p:panelGrid>                            
                            </h:form>
                        </p:scrollPanel>

                    </p:dialog>

                    <p:dialog header="Ver alerta" widgetVar="dialogoVerAlerta" appendTo="@(body)" modal="true"  width="90%" dynamic="true">
                        <h:form id="frmVerAlerta">
                            <p:panelGrid id="panelVerAlerta" columns="4"
                                         columnClasses="ui-grid-col-3,ui-grid-col-3,ui-grid-col-3,ui-grid-col-3"
                                         layout="grid"
                                         styleClass="ui-panelgrid-blank ui-fluid" >

                                <h:outputText value="Estado" class="header-celda" />
                                <h:outputText value="#{homeBean.objetoAlerta.estadoStr}" />

                                <h:outputText value="Severidad" class="header-celda" />
                                <h:outputText value="#{homeBean.objetoAlerta.severidadStr}" />

                                <h:outputText value="Nombre" class="header-celda" />
                                <h:outputText value="#{homeBean.objetoAlerta.nombre}" style="width: 90%"/>


                                <p:row>
                                    <p:column class="ui-g-3">
                                        <h:outputText value="Descripción" class="header-celda" />
                                    </p:column>
                                    <p:column class="ui-g-9">
                                        <p:inputTextarea label="Descripción" value="#{homeBean.objetoAlerta.descripcion}" cols="150" rows="4" maxlength="512" readonly="true" />
                                    </p:column>
                                </p:row>

                            </p:panelGrid>


                            <p:panelGrid style="width: 100%;">
                                <f:facet name="footer">
                                    <p:row>
                                        <p:column colspan="4" style="text-align: center">
                                            <h:panelGroup style="display:block; text-align:center; margin-top: 10px;">
                                                <p:commandButton value="Descartar" type="button" onclick="descartarRemote()" validateClient="true"/>
                                                <p:remoteCommand name="descartarRemote" action="#{homeBean.descartar()}" process="@all"  />
                                                <p:commandButton value="Salir" type="button" onclick="PF('dialogoVerAlerta').hide()" immediate="true"/>
                                            </h:panelGroup>
                                        </p:column>
                                    </p:row>
                                </f:facet>
                            </p:panelGrid>
                        </h:form>
                    </p:dialog>
                </p:splitterPanel>
            </p:splitter>
            <script>
<!--TODO: add event, xhr, options> -->
                $(document).on("ajaxStart pfAjaxSend", function () {
                    $("html").addClass("progress");
                    $("#overlay").css("display", "block");
                }).on("ajaxStop pfAjaxComplete", function () {
                    $("html").removeClass("progress");
                    $("#overlay").css("display", "none");
                }).on("ajaxError", function () {
                    $("html").removeClass("progress");
                    $("#overlay").css("display", "none");
                });
                function do_nothing() {
                    return false;
                }
                function disableF5(e) {
                    if ((e.which || e.keyCode) == 116)
                        e.preventDefault();
                }
                ;

                $(document).ready(function () {
                    $(document).on("keydown", disableF5);
                });
            </script>
            <style>

            </style>
        </f:view>
    </h:body>
</html>


