<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<ui:composition template="/home.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui">
    <ui:define name="bodyJR"> 
        <style type="text/css">
            .old {
                background-color: #fca752 !important;
                background-image: none !important;
                color: #000000 !important;
            }
            .yellow{
                background-color: #ffff00 !important;
                background-image: none !important;
                color: #000000 !important;
            }
            .green{
                background-color: #009900 !important;
                background-image: none !important;
                color: #ffffff !important;
            }
            .red{
                background-color: #ff0000 !important;
                background-image: none !important;
                color: #ffffff !important;
            }

            .red  .ui-row-editor{
                display: none;
            }  
            .ui-panelgrid .ui-grid-responsive .ui-panelgrid-cell {
                border: 1px solid #e5e2e2;
            }
            .ui-panelgrid .ui-panelgrid-footer {
                text-align: center;
                padding: 2px 5px;
            }
        </style>
        <center>
            <h:form id="frmGlosas">
                <p:toolbar>
                    <f:facet name="left" >
                        <span title="#{cmFacturaGlosaBean.modulo.descripcion}">#{cmFacturaGlosaBean.modulo.nombre}</span>
                        <p:spacer width="30"/>                        
                        <p:outputLabel value="Radicación Desde"/>
                        <p:spacer width="5"/>
                        <p:calendar id="fInicial" value="#{cmFacturaGlosaBean.paramConsulta.parametroConsulta1}"  pattern="yyyy-MM-dd" maxdate="#{cmFacturaGlosaBean.fechaMaximaCalendario}" navigator="true"  yearRange="c-100:c" >
                            <p:ajax event="dateSelect" update="tablaRegistros"/>
                            <f:convertDateTime pattern="yyyy-MM-dd" type="both" timeZone="America/Bogota"/>
                        </p:calendar>
                        <p:spacer width="10"/>                        
                        <p:outputLabel value="Radicación Hasta"/>
                        <p:spacer width="5"/>
                        <p:calendar id="fFinal" value="#{cmFacturaGlosaBean.paramConsulta.parametroConsulta2}" pattern="yyyy-MM-dd" maxdate="#{cmFacturaGlosaBean.fechaMaximaCalendario}"  navigator="true"  yearRange="c-100:c" >
                            <p:ajax event="dateSelect" update="tablaRegistros"/>
                            <f:convertDateTime pattern="yyyy-MM-dd" type="both" timeZone="America/Bogota"/>
                        </p:calendar>
                    </f:facet>
                    <f:facet name="right">
                        <p:commandButton rendered="#{cmFacturaGlosaBean.accionListar}" title="Refrescar" ajax="false" actionListener="#{cmFacturaGlosaBean.refrescar()}" icon="ui-icon-refresh"/>
                        <h:commandLink class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only">
                            <p:commandButton icon="ui-icon-arrowthickstop-1-s" title="Descargar"/>
                            <p:dataExporter type="csv"
                                            target="tablaRegistros" fileName="conexiones-respuesta-glosa" pageOnly="true" />
                        </h:commandLink>
                    </f:facet>
                </p:toolbar>
                <p:dataTable var="obj" value="#{cmFacturaGlosaBean.lazyRegistro}" paginator="true" rows="#{cmFacturaGlosaBean.tamanoPagina}" 
                             emptyMessage="No se encontraron registros"
                             currentPageReportTemplate="Registros del {startRecord} al {endRecord} de {totalRecords}, Página {currentPage} de {totalPages}"
                             paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             rowsPerPageTemplate="30,50,100,200" id="tablaRegistros" lazy="true"
                             widgetVar="tablaWidget"
                             style="font-size:12px;"
                             styleClass="myTable" 
                             scrollable="true"
                             scrollWidth="140%"
                             rowStyleClass="#{cmFacturaGlosaBean.asignarColorFila(obj)}"
                             rowKey="#{obj.id}" reflow="true">

                    <p:column width="80" style="text-align: center;" exportable="false">
                        <f:facet name="header">
                            <h:outputText value="Acciones"/>
                        </f:facet>
                        <p:commandButton rendered="#{cmFacturaGlosaBean.accionVer}" title="Ver Glosa" actionListener="#{cmFacturaGlosaBean.ver(obj.id)}" icon="ui-icon-search"/>
                        <p:commandButton rendered="#{cmFacturaGlosaBean.accionAdicional1 and !obj.estadoFacturaDeBloqueo}" title="Gestionar" actionListener="#{cmFacturaGlosaBean.verGestionarGlosas(obj.id)}" icon="ui-icon-script"/>
                        <p:commandButton rendered="#{cmFacturaGlosaBean.accionAdicional2 and !obj.estadoFacturaDeBloqueo and !obj.bloqueda }" title="Bloquear Factura" actionListener="#{cmFacturaGlosaBean.bloquearFacturas(obj.id)}" icon=" ui-icon-locked"/>
                        <p:commandButton rendered="#{cmFacturaGlosaBean.accionAdicional2 and !obj.estadoFacturaDeBloqueo and obj.bloqueda }" title="Desbloquear Factura" actionListener="#{cmFacturaGlosaBean.desBloquearFactura(obj.id)}" icon="ui-icon-key">
                            <p:confirm header="Confirmación" message="Está seguro que desea desbloquear la factura?" icon="ui-icon-alert" />
                        </p:commandButton>
                        <p:commandButton rendered="#{cmFacturaGlosaBean.accionVer and obj.tieneNotas}" title="Ver Notas" actionListener="#{cmFacturaGlosaBean.verNota(obj)}" icon="ui-icon-copy"/>
                    </p:column>

                    <p:column headerText="Estado Factura" sortBy="#{obj.estadoFactura}">
                        <h:outputText value="#{obj.estadoFacturaStr}" title="#{obj.estadoFacturaStr}"/>
                    </p:column>

                    <p:column headerText="Tipo respuesta" filterBy="#{obj.tipoRespuesta}">
                        <f:facet name="filter">
                            <p:selectOneMenu style="width: 70%;" onchange="PF('tablaWidget').filter()">
                                <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />
                                <f:selectItem itemLabel="Sin Responder" itemValue="0" />
                                <f:selectItem itemLabel="Respondida" itemValue="1" />
                                <f:selectItem itemLabel="Conciliada" itemValue="2" />
                            </p:selectOneMenu>
                        </f:facet>
                        <h:outputText value="#{obj.tipoRespuestaStr}"/>
                    </p:column>

                    <p:column headerText="Tipo auditoría" filterBy="#{obj.tipoAuditoria}">
                        <f:facet name="filter">
                            <p:selectOneMenu style="width: 70%;" onchange="PF('tablaWidget').filter()">
                                <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />
                                <f:selectItem itemLabel="Sin Auditoría" itemValue="0" />
                                <f:selectItem itemLabel="Técnica" itemValue="6" />
                                <f:selectItem itemLabel="Médica" itemValue="7" />
                                <f:selectItem itemLabel="Para Pago" itemValue="8" />
                            </p:selectOneMenu>
                        </f:facet>
                        <h:outputText value="#{obj.tipoAuditoriaStr}"/>
                    </p:column>

                    <p:column headerText="Número radicado" sortBy="#{obj.numeroRadicado}" filterBy="#{obj.numeroRadicado}" style="text-align: center;">
                        <f:facet name="filter">
                            <p:inputText label="Número Radicado" maxlength="64" style="width: 95%;" onkeypress="if (event.keyCode === 13) {
                                        onchange();
                                        return false;
                                    }"  onchange="PF('tablaWidget').filter()" />
                        </f:facet>
                        <h:outputText value="#{obj.numeroRadicado}" title="#{obj.numeroRadicado}"/>
                    </p:column>

                    <p:column  headerText="NIT" sortBy="#{obj.nit}" filterBy="#{obj.nit}" style="text-align: center;">
                        <f:facet name="filter">
                            <p:inputText label="NIT" maxlength="64" style="width: 95%;" onkeypress="if (event.keyCode === 13) {
                                        onchange();
                                        return false;
                                    }"  onchange="PF('tablaWidget').filter()" />
                        </f:facet>
                        <h:outputText value="#{obj.nit}" title="#{obj.nit}"/>
                    </p:column>

                    <p:column headerText="IPS" sortBy="#{obj.ips}" filterBy="#{obj.ips}" width="120" >
                        <f:facet name="filter">
                            <p:inputText label="IPS" maxlength="64" style="width: 95%;" onkeypress="if (event.keyCode === 13) {
                                        onchange();
                                        return false;
                                    }"  onchange="PF('tablaWidget').filter()" />
                        </f:facet>
                        <h:outputText value="#{obj.ips}" title="#{obj.ips}"/>
                    </p:column>

                    <p:column headerText="Número facturado" sortBy="#{obj.numeroFacturado}" filterBy="#{obj.numeroFacturado}" width="80" style="text-align: center;">
                        <f:facet name="filter">
                            <p:inputText label="Número Facturado" maxlength="64" style="width: 95%;" onkeypress="if (event.keyCode === 13) {
                                        onchange();
                                        return false;
                                    }"  onchange="PF('tablaWidget').filter()" />
                        </f:facet>
                        <h:outputText value="#{obj.numeroFacturado}" title="#{obj.numeroFacturado}"/>
                    </p:column>

                    <p:column  headerText="Fecha radicación" sortBy="#{obj.fechaRadicacion}"  style="text-align: center;">
                        <h:outputText value="#{obj.fechaRadicacion}"/>
                    </p:column>

                    <p:column headerText="Fecha inicio marcación" sortBy="#{obj.fechaMarcacion}"  style="text-align: center;">
                        <h:outputText value="#{obj.fechaMarcacion}"/>
                    </p:column>

                    <p:column headerText="Fecha vencimiento marcación" sortBy="#{obj.fechaVencimiento}" style="text-align: center;">
                        <h:outputText value="#{obj.fechaVencimiento}"/>
                    </p:column>

                    <p:column  headerText="Valor factura" sortBy="#{obj.valorFactura}" width="110" style="text-align: center;">
                        <h:outputText value="#{obj.valorFactura}" title="#{obj.valorFactura}">
                            <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                        </h:outputText>
                    </p:column>

                    <p:column  headerText="Valor inicial glosa" sortBy="#{obj.valorInicialGlosa}" width="80" style="text-align: center;">
                        <h:outputText value="#{obj.valorInicialGlosa}" title="#{obj.valorInicialGlosa}">
                            <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                        </h:outputText>
                    </p:column>

                    <p:column  headerText="Valor pendiente actual" sortBy="#{obj.valorPendienteActual}" width="100" style="text-align: center;">
                        <h:outputText value="#{obj.valorPendienteActual}" title="#{obj.valorPendienteActual}">
                            <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                        </h:outputText>
                    </p:column>

                    <p:column headerText="Multi Usuario" filterBy="#{obj.multiUsuario}">
                        <f:facet name="filter">
                            <p:selectOneMenu style="width: 70%;" onchange="PF('tablaWidget').filter()">
                                <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />
                                <f:selectItem itemLabel="Si" itemValue="true" />
                                <f:selectItem itemLabel="No" itemValue="false" />
                            </p:selectOneMenu>
                        </f:facet>
                        <h:outputText  value="#{obj.multiUsuarioStr}" title="Doc : #{obj.documentoMonoUsuario} - #{obj.nombreMonoUsuario}"/>
                    </p:column>

                    <p:column headerText="Origen" filterBy="#{obj.origenFactura}">  
                        <f:facet name="filter">
                            <p:selectOneMenu style="width: 70%;" onchange="PF('tablaWidget').filter()">
                                <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />
                                <f:selectItem itemLabel="IntraSavia" itemValue="1" />
                                <f:selectItem itemLabel="SomosMas" itemValue="2" />
                                <f:selectItem itemLabel="Conexiones" itemValue="3" />
                            </p:selectOneMenu>
                        </f:facet>
                        <h:outputText value="#{obj.getOrigenFacturaStr()}" title="#{obj.getOrigenFacturaStr()}"/>
                    </p:column>

                    <p:column headerText="Documento" rendered="#{cmFacturaGlosaBean.habilitarBusquedaMuliUsuario}">  
                        <h:outputText value="#{obj.documentoMonoUsuario}" title="#{obj.documentoMonoUsuario}"/>
                    </p:column>

                    <p:column headerText="Nombre usuario" rendered="#{cmFacturaGlosaBean.habilitarBusquedaMuliUsuario}">
                        <h:outputText value="#{obj.nombreMonoUsuario}" title="#{obj.nombreMonoUsuario}"/>
                    </p:column>

                </p:dataTable>
                <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                    <p:commandButton value="Si" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" style="left:25%"/>
                    <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" style="left:25%"/>
                </p:confirmDialog>
            </h:form>

            <p:dialog header="Ver Glosa" id="dialogoVer" widgetVar="dialogoVer" appendTo="@(body)" modal="true"  width="90%" dynamic="true" style="max-height:90%;">
                <p:scrollPanel id="scrollPanelVer" mode="native" style="height:450px">
                    <h:form id="frmVer">
                        <p:panel id="pVerFactura" toggleable="true" header="Factura" style="margin-bottom:10px;">                         
                            <p:outputPanel class="frmAuditoria" style="margin-top: -5px; text-align: right;">
                                <p:commandButton  class="btnAuditoria" action="#{cmFacturaGlosaBean.getAuditoria(cmFacturaGlosaBean.objeto.auditoriaStrHTML)}" icon="ui-icon-comment" title="Auditoría" />
                            </p:outputPanel>
                            <p:panelGrid id="panelVerFactura" columns="4"
                                         layout="grid" >

                                <p:row>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Estado factura"  style="font-weight:bold"/>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText value="#{cmFacturaGlosaBean.objeto.estadoFacturaStr}"/>
                                    </p:column>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Número radicado" style="font-weight:bold" />
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText value="#{cmFacturaGlosaBean.objeto.numeroRadicado}"/>
                                    </p:column>
                                </p:row>
                               
                                <p:row>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Número factura"  style="font-weight:bold"/>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText value="#{cmFacturaGlosaBean.objeto.numeroFacturado}"/>
                                    </p:column>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Fecha radicación" style="font-weight:bold" />
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText value="#{cmFacturaGlosaBean.objeto.fechaRadicacion}"/>
                                    </p:column>
                                </p:row>

                                <p:row>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Fecha prestación" style="font-weight:bold" />
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText value="#{cmFacturaGlosaBean.objeto.fechaPrestacion}"/>
                                    </p:column>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Modalidad contrato"  style="font-weight:bold"/>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText value="#{cmFacturaGlosaBean.objeto.maeTipoContratoValor}"/>
                                    </p:column>
                                </p:row>

                                <p:row>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Valor factura" style="font-weight:bold" ></p:outputLabel>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText value="#{cmFacturaGlosaBean.objeto.valorFactura}">
                                            <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Valor copago" style="font-weight:bold" ></p:outputLabel>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText value="#{cmFacturaGlosaBean.objeto.valorCopago}">
                                            <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                        </h:outputText>
                                    </p:column>
                                </p:row>
                                                           
                                <p:row>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Valor bruto" style="font-weight:bold" ></p:outputLabel>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText value="#{cmFacturaGlosaBean.objeto.valorBruto}">
                                            <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Valor inicial glosa"  style="font-weight:bold"/>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText value="#{cmFacturaGlosaBean.objeto.valorInicialGlosa}">
                                            <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                        </h:outputText>
                                    </p:column>
                                </p:row>
                                                              
                                <p:row>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Valor pendiente actual"  style="font-weight:bold"/>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText value="#{cmFacturaGlosaBean.objeto.valorPendienteActual}">
                                            <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Régimen" style="font-weight:bold" ></p:outputLabel>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText value="#{cmFacturaGlosaBean.objeto.maeRegimenValor}"/>
                                    </p:column>
                                </p:row>

                                <p:row>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Fecha inicial bloqueo" style="font-weight:bold"></p:outputLabel>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText value="#{cmFacturaGlosaBean.objeto.fechaMarcacion}"/>
                                    </p:column>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Fecha final bloqueo"  style="font-weight:bold"></p:outputLabel>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText value="#{cmFacturaGlosaBean.objeto.fechaVencimiento}"/>
                                    </p:column>
                                </p:row>

                                <p:row>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Pbs" style="font-weight:bold" ></p:outputLabel>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText style="color:red;font-weight:bold;" value="#{cmFacturaGlosaBean.objeto.pbs?'Si':'No'}"/>
                                    </p:column>
                                </p:row>

                            </p:panelGrid>
                        </p:panel>

                        <p:panel id="pDetalles" header="Servicios Con Valores Pendientes" style="margin-bottom:10px; width: 120%;" toggleable="true" >                               
                            <p:dataTable var="obj" value="#{cmFacturaGlosaBean.lazyDetalles}" paginator="true" rows="#{cmFacturaGlosaBean.tamanoPagina}" 
                                         emptyMessage="No se encontraron registros"
                                         currentPageReportTemplate="Registros del {startRecord} al {endRecord} de {totalRecords}, Página {currentPage} de {totalPages}"
                                         paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                         rowsPerPageTemplate="30,50,100,200" id="tablaRegistros" lazy="true"
                                         widgetVar="tablaWidgetDetalles"
                                         scrollable="true"
                                         scrollHeight="250"
                                         scrollWidth="100%"
                                         style="font-size:12px;"
                                         rowKey="#{obj.id}" >
                                <p:column style="text-align: center;">                                 
                                    <f:facet name="header">
                                        <h:outputText value="Acciones"/>
                                    </f:facet>    
                                    <p:commandButton  title="Ver Auditoria Servicio" actionListener="#{cmFacturaGlosaBean.verServicioAuditado(obj.id)}" icon="ui-icon-search"/> 
                                </p:column>  
                                <p:column  headerText="Id descripción" sortBy="#{obj.id}">
                                    <h:outputText value="#{obj.id}" title="#{obj.id}"/>
                                </p:column>
                                <p:column  headerText="Estado" sortBy="#{obj.estado}">
                                    <h:outputText value="#{obj.estadoStr}" title="#{obj.estadoStr}"/>
                                </p:column>
                                <p:column  headerText="Código servicio" sortBy="#{obj.maServicioCodigo}" filterBy="#{obj.maServicioCodigo}">
                                    <f:facet name="filter">
                                        <p:inputText label="Código servicio" maxlength="64" style="width: 95%;" onkeypress="if (event.keyCode === 13) {
                                                    onchange();
                                                    return false;
                                                }"  onchange="PF('tablaWidgetDetalles').filter()" />
                                    </f:facet>
                                    <h:outputText value="#{obj.maServicioCodigo}" title="#{obj.maServicioCodigo}"/>
                                </p:column>
                                <p:column  headerText="Nombre servicio" sortBy="#{obj.maServicioValor}" filterBy="#{obj.maServicioValor}">
                                    <f:facet name="filter">
                                        <p:inputText label="Nombre servicio" maxlength="64" style="width: 95%;" onkeypress="if (event.keyCode === 13) {
                                                    onchange();
                                                    return false;
                                                }"  onchange="PF('tablaWidgetDetalles').filter()" />
                                    </f:facet>
                                    <h:outputText value="#{obj.nombreServicioCorto}" title="#{obj.nombreServicioCorto}"/>
                                    <p:commandButton rendered="#{obj.nombreServicioCorto.length() > 0 }" actionListener="#{cmFacturaGlosaBean.mostrarMensaje(obj.maServicioValor)}" icon="ui-icon-comment" title="Ver completo"/>
                                </p:column>                                                             
                                <p:column  headerText="Tipo documento" sortBy="#{obj.maeTipoDocumentoValor}">
                                    <h:outputText value="#{obj.maeTipoDocumentoValor}" title="#{obj.maeTipoDocumentoValor}"/>
                                </p:column> 
                                <p:column  headerText="Documento afiliado" sortBy="#{obj.documento}" filterBy="#{obj.documento}">
                                    <f:facet name="filter">
                                        <p:inputText label="Documento afiliado" maxlength="64" style="width: 95%;" onkeypress="if (event.keyCode === 13) {
                                                    onchange();
                                                    return false;
                                                }"  onchange="PF('tablaWidgetDetalles').filter()" />
                                    </f:facet>
                                    <h:outputText value="#{obj.documento}" title="#{obj.documento}"/>
                                </p:column>
                                <p:column  headerText="Nombre afiliado" sortBy="#{obj.nombreCompletoAfiliado}">
                                    <h:outputText value="#{obj.nombreCompletoAfiliado}" title="#{obj.nombreCompletoAfiliado}"/>
                                </p:column>
                                <p:column  headerText="Radicado Glosa" sortBy="#{obj.radicadoGlosa}" filterBy="#{obj.radicadoGlosa}">
                                    <f:facet name="filter">
                                        <p:inputText label="Radicado Glosa" maxlength="64" style="width: 95%;" onkeypress="if (event.keyCode === 13) {
                                                    onchange();
                                                    return false;
                                                }"  onchange="PF('tablaWidgetDetalles').filter()" />
                                    </f:facet>
                                    <h:outputText value="#{obj.radicadoGlosa}" title="#{obj.radicadoGlosa}"/>
                                </p:column>

                                <p:column  headerText="Motivos Glosa" sortBy="#{obj.motivoGlosa}" filterBy="#{obj.motivoGlosa}">
                                    <f:facet name="filter">
                                        <p:inputText label="Motivos Glosa" maxlength="64" style="width: 95%;" onkeypress="if (event.keyCode === 13) {
                                                    onchange();
                                                    return false;
                                                }"  onchange="PF('tablaWidgetDetalles').filter()" />
                                    </f:facet>
                                    <h:outputText value="#{obj.motivoGlosaCorto}" title="#{obj.motivoGlosaCorto}"/>
                                    <p:commandButton rendered="#{obj.motivoGlosaCorto.length() > 0 }" actionListener="#{cmFacturaGlosaBean.mostrarMensaje(obj.motivoGlosa)}" icon="ui-icon-comment" title="Ver completo"/>
                                </p:column>
                                <p:column  headerText="Valor copago" sortBy="#{obj.valorCopago}">
                                    <h:outputText value="#{obj.valorCopago}" title="#{obj.valorCopago}">
                                        <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                    </h:outputText>
                                </p:column>
                                <p:column  headerText="Valor facturado" sortBy="#{obj.valorFacturado}">
                                    <h:outputText value="#{obj.valorFacturado}" title="#{obj.valorFacturado}">
                                        <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                    </h:outputText>
                                </p:column>
                                <p:column  headerText="Valor pagado" sortBy="#{obj.valorPagado}">
                                    <h:outputText value="#{obj.valorPagado}" title="#{obj.valorPagado}">
                                        <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                    </h:outputText>
                                </p:column>                          
                                <p:column  headerText="Valor pendiente inicial" sortBy="#{obj.valorPendiente}">
                                    <h:outputText value="#{obj.valorPendiente}" title="#{obj.valorPendiente}">
                                        <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                    </h:outputText>
                                </p:column>
                                <p:column  headerText="Valor pendiente actual" sortBy="#{obj.valorPendienteActual}">
                                    <h:outputText value="#{obj.valorPendienteActual}" title="#{obj.valorPendienteActual}">
                                        <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                    </h:outputText>
                                </p:column>
                                <p:column  headerText="Observación" sortBy="#{obj.observacion}">
                                    <h:outputText value="#{obj.observacionCorto}" />
                                    <p:commandButton  rendered="#{obj.observacionCorto.length() > 1 }" actionListener="#{cmFacturaGlosaBean.mostrarMensaje(obj.observacion)}" icon="ui-icon-comment" title="Ver completo"/>
                                </p:column> 
                                <p:column  headerText="Aplica AC" width="40" sortBy="#{obj.aplicaAc}">
                                    <h:outputText value="#{obj.aplicaAcStr}" title="#{obj.aplicaAcStr}"/>
                                </p:column>
                                <p:column  headerText="Aplica DC" width="40" sortBy="#{obj.aplicaDc}">
                                    <h:outputText value="#{obj.aplicaDcStr}" title="#{obj.aplicaDcStr}"/>
                                </p:column>
                                <p:column  headerText="Aplica PBS" width="30" sortBy="#{obj.aplicaPbs}" >
                                    <h:outputText value="#{obj.aplicaPbsStr}" title="#{obj.aplicaPbsStr}"/>
                                </p:column>
                                <p:column  headerText="Aplica diagnóstico" width="40" sortBy="#{obj.aplicaDx}">
                                    <h:outputText value="#{obj.aplicaDxStr}" title="#{obj.aplicaDxStr}"/>
                                </p:column>
                                <p:column  headerText="Aplica autorización" width="40" sortBy="#{obj.aplicaAutorizacion}">
                                    <h:outputText value="#{obj.aplicaAutorizacionStr}" title="#{obj.aplicaAutorizacionStr}"/>
                                </p:column>
                                <p:column  headerText="Aplica concepto" width="40" sortBy="#{obj.aplicaConcepto}">
                                    <h:outputText value="#{obj.aplicaConceptoStr}" title="#{obj.aplicaConceptoStr}"/>
                                </p:column>
                                <p:column  headerText="Aplica glosa" width="40" sortBy="#{obj.aplicaGlosa}">
                                    <h:outputText value="#{obj.aplicaGlosaStr}" title="#{obj.aplicaGlosaStr}"/>
                                </p:column>
                                <p:column  headerText="Valor glosa" style="width: 80px;">
                                    <h:outputText value="#{obj.valorGlosa}" title="#{obj.valorGlosa}">
                                        <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                    </h:outputText>
                                </p:column>
                                <p:column  headerText="Fecha prestación" sortBy="#{obj.fechaPrestacion}">
                                    <h:outputText value="#{obj.fechaPrestacion}" title="#{obj.fechaPrestacion}"/>
                                </p:column> 
                            </p:dataTable>                             
                        </p:panel>

                        <p:panel id="pRespuesta" toggleable="true" header="Respuesta Glosas" style="margin-bottom:10px;">                               
                            <p:dataTable var="obj" value="#{cmFacturaGlosaBean.lazyGlosaRespuesta}" paginator="true" rows="#{cmFacturaGlosaBean.tamanoPagina}" 
                                         emptyMessage="No se encontraron registros"
                                         currentPageReportTemplate="Registros del {startRecord} al {endRecord} de {totalRecords}, Página {currentPage} de {totalPages}"
                                         paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                         rowsPerPageTemplate="5,10,30,50,100" id="tablaWidgetRespuestaGlosas" lazy="true"
                                         widgetVar="tablaWidgetRespuestaGlosas"
                                         scrollable="true"
                                         scrollWidth="100%"
                                         scrollHeight="250"
                                         style="font-size:12px;"
                                         rowKey="#{obj.id}">
                                <p:column width="80" style="text-align: center;">
                                    <f:facet name="header">
                                        <h:outputText value="Acciones"/>
                                    </f:facet>
                                    <p:commandButton title="Ver servicios glosados" actionListener="#{cmFacturaGlosaBean.verRespuestaDestallesGlosa(obj.id)}" icon="ui-icon-search"/>
                                    <p:commandButton rendered="#{cmFacturaGlosaBean.accionAdicional3 and obj.tipoRespuesta == 1 and obj.visualizarPdf}" title="Generar reporte respuesta glosas" ajax="true" onclick="PrimeFaces.monitorDownload(start, stop);" icon="ui-icon-document">
                                        <p:fileDownload value="#{cmFacturaGlosaBean.generarReporteRespuestaGlosa(obj.id)}" />
                                    </p:commandButton>
                                    <p:commandButton title="Ejecutar Reintento Sincronización" rendered="#{cmFacturaGlosaBean.accionAdicional4}" actionListener="#{cmFacturaGlosaBean.guardarReintentoSincronizacion(obj.id)}" icon="ui-icon-shuffle"/>
                                </p:column>
                                <p:column  headerText="Id respuesta" sortBy="#{obj.id}">
                                    <h:outputText value="#{obj.id}" title="#{obj.id}"/>
                                </p:column>
                                <p:column  headerText="Id factura" sortBy="#{obj.cmFactura.id}">
                                    <h:outputText value="#{obj.cmFactura.id}" title="#{obj.cmFactura.id}"/>
                                </p:column>
                                <p:column  headerText="Procesada en sap">
                                    <h:outputText value="#{obj.isProcesadaSapStr()}" title="#{obj.isProcesadaSapStr()}"/>
                                </p:column>
                                <p:column  headerText="Tipo respuesta" sortBy="#{obj.tipoRespuesta}">
                                    <h:outputText value="#{obj.tipoRespuestaStr}" title="#{obj.tipoRespuestaStr}"/>
                                </p:column>
                                <p:column  headerText="Representante Saviasalud Eps" sortBy="#{obj.representanteEps}">
                                    <h:outputText value="#{obj.representanteEps}" title="#{obj.representanteEps}"/>
                                </p:column>
                                <p:column  headerText="Representante IPS" sortBy="#{obj.representanteIps}">
                                    <h:outputText value="#{obj.representanteIps}" title="#{obj.representanteIps}"/>
                                </p:column>
                                <p:column  headerText="Id conciliación masiva" sortBy="#{obj.cmConciliacion.id}">
                                    <h:outputText value="#{obj.cmConciliacion.id}" title="#{obj.cmConciliacion.id}"/>
                                </p:column>
                                <p:column  headerText="Valor cobro detalle" sortBy="#{obj.valorCobroDetalle}">
                                    <h:outputText value="#{obj.valorCobroDetalle}" title="#{obj.valorCobroDetalle}">
                                        <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                    </h:outputText>
                                </p:column>
                                <p:column  headerText="Valor facturado" sortBy="#{obj.valorFacturado}">
                                    <h:outputText value="#{obj.valorFacturado}" title="#{obj.valorFacturado}">
                                        <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                    </h:outputText>
                                </p:column>
                                <p:column  headerText="Valor pagado" sortBy="#{obj.valorPagado}">
                                    <h:outputText value="#{obj.valorPagado}" title="#{obj.valorPagado}">
                                        <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                    </h:outputText>
                                </p:column>                          
                                <p:column  headerText="Valor pagado EPS" sortBy="#{obj.valorPagadoEps}">
                                    <h:outputText value="#{obj.valorPagadoEps}" title="#{obj.valorPagadoEps}">
                                        <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                    </h:outputText>
                                </p:column>
                                <p:column  headerText="Valor pendiente" sortBy="#{obj.valorPendiente}">
                                    <h:outputText value="#{obj.valorPendiente}" title="#{obj.valorPendiente}">
                                        <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                    </h:outputText>
                                </p:column>
                                <p:column  headerText="Valor aceptado IPS" sortBy="#{obj.valorAceptadoIps}">
                                    <h:outputText value="#{obj.valorAceptadoIps}" title="#{obj.valorAceptadoIps}">
                                        <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                    </h:outputText>
                                </p:column>
                                <p:column  headerText="Observación" sortBy="#{obj.observacion}">
                                    <h:outputText value="#{obj.observacionCorto}" />
                                    <p:commandButton  rendered="#{obj.observacionCorto.length() > 1 }" actionListener="#{cmFacturaGlosaBean.mostrarMensaje(obj.observacion)}" icon="ui-icon-comment" title="Ver completo"/> 
                                </p:column>
                                <p:column  headerText="Fecha hora creación" sortBy="#{obj.fechaHoraCrea}">
                                    <h:outputText value="#{obj.fechaHoraCrea}" title="#{obj.fechaHoraCrea}"/>
                                </p:column>
                            </p:dataTable>  
                        </p:panel>

                        <p:panel id="panelVerAdjuntosFactura" header="Adjuntos" style="margin-bottom:10px;" collapsed="false" toggleable="true">
                            <p:dataTable id="tablaVerAdjuntosFactura" var="adjunto" value="#{cmFacturaGlosaBean.registrosAdjuntosFactura}" widgetVar="tablaWidgetAdjuntosFactura" scrollable="true" emptyMessage="No se encontraron registros">
                                <p:column headerText="Acciones" style="text-align: center;">
                                    <p:commandButton rendered="#{adjunto.id != null}" title="Descargar" ajax="false" onclick="PrimeFaces.monitorDownload(start, stop);" icon="ui-icon-arrowthickstop-1-s">
                                        <p:fileDownload value="#{cmFacturaGlosaBean.descargarAdjunto(adjunto)}" />
                                    </p:commandButton>  
                                </p:column>
                                <p:column headerText="Nombre">
                                    <h:outputText value="#{adjunto.archivoNombre}"/>
                                </p:column>
                                <p:column headerText="Tipo" style="text-align: center;">
                                    <h:outputText value="#{adjunto.tipoStr}"/>
                                </p:column>
                                <p:column headerText="Usuario">
                                    <h:outputText value="#{adjunto.usuarioCrea}"/>
                                </p:column>
                                <p:column headerText="F.H. Crea" style="text-align: center;">
                                    <h:outputText value="#{adjunto.fechaHoraCrea}">
                                        <f:convertDateTime type="date" pattern="yyyy-MM-dd HH:mm:ss" timeZone="America/Bogota"/>
                                    </h:outputText>
                                </p:column>
                            </p:dataTable>
                        </p:panel>

                        <p:panelGrid  style="width:100%;margin:10px 0px">
                            <f:facet name="footer">
                                <p:row>
                                    <p:column style="text-align: center">
                                        <h:panelGroup style="display:block; text-align:center;">
                                            <p:commandButton value="Salir" type="button" onclick="PF('dialogoVer').hide()" immediate="true"/>
                                        </h:panelGroup>
                                    </p:column>
                                </p:row>
                            </f:facet>
                        </p:panelGrid>
                    </h:form>
                </p:scrollPanel> 
            </p:dialog>

            <p:dialog header="Gestionar Glosas" id="dialogoGestionarGlosas" widgetVar="dialogoGestionarGlosas" appendTo="@(body)" modal="true"  width="90%" dynamic="true" style="max-height:90%;">    
                <p:ajax event="open" listener="#{cmFacturaGlosaBean.mostrarFaceMensajeGeneral()}" oncomplete="PF('tablaWidgetDetalles').filter();" form="frmGestionarGlosas"/>
                <p:ajax event="close" listener="#{cmFacturaGlosaBean.cerrarVentanaGestionarGlosas}" form="frmGestionarGlosas"/>
                <p:scrollPanel  id="scrollPanelGestionarGlosa" mode="native" style="height:450px">
                    <h:form id="frmGestionarGlosas">
                        <p:panel id="pGlosasFactura" toggleable="true" header="Factura" style="margin-bottom:10px; width: 100%">
                            <p:remoteCommand immediate="true" name="abrirVentanaAuditoria" action="#{cmFacturaGlosaBean.getAuditoria(cmFacturaGlosaBean.objeto.auditoriaStrHTML)}" />                            
                            <p:outputPanel class="frmAuditoria" style="margin-top: -5px; text-align: right;">
                                <p:commandButton  type="button" class="btnAuditoria" onclick="abrirVentanaAuditoria()"  process="@form" immediate="true" icon="ui-icon-comment" title="Auditoría" />
                            </p:outputPanel>
                            <p:panelGrid id="panelFacturaGlosa" columns="4"
                                         layout="grid">

                                <p:row>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Estado factura"  style="font-weight:bold"/>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText value="#{cmFacturaGlosaBean.objeto.estadoFacturaStr}"/>
                                    </p:column>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Número radicado" style="font-weight:bold" />
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText value="#{cmFacturaGlosaBean.objeto.numeroRadicado}"/>
                                    </p:column>
                                </p:row>
                             
                                <p:row>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Número factura" style="font-weight:bold" />
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText value="#{cmFacturaGlosaBean.objeto.numeroFacturado}"/>
                                    </p:column>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Fecha radicación"  style="font-weight:bold" />
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText value="#{cmFacturaGlosaBean.objeto.fechaRadicacion}"/>
                                    </p:column>
                                </p:row>
                                                             
                                <p:row>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Fecha prestación"  style="font-weight:bold" />
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText value="#{cmFacturaGlosaBean.objeto.fechaPrestacion}"/>
                                    </p:column>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Modalidad contrato"  style="font-weight:bold" />
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText value="#{cmFacturaGlosaBean.objeto.maeTipoContratoValor}"/>
                                    </p:column>
                                </p:row>
                                                             
                                <p:row>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Valor inicial glosa" style="font-weight:bold"/>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText value="#{cmFacturaGlosaBean.objeto.valorInicialGlosa}">
                                            <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Valor pendiente actual"  style="font-weight:bold"/>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText value="#{cmFacturaGlosaBean.objeto.valorPendienteActual}">
                                            <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                        </h:outputText>
                                    </p:column>
                                </p:row>
                                                            
                                <p:row>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Valor factura" style="font-weight:bold"></p:outputLabel>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText value="#{cmFacturaGlosaBean.objeto.valorFactura}">
                                            <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Régimen" style="font-weight:bold"></p:outputLabel>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText value="#{cmFacturaGlosaBean.objeto.maeRegimenValor}"/>
                                    </p:column>
                                </p:row>
                              
                                <p:row>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Fecha inicial bloqueo" style="font-weight:bold"></p:outputLabel>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText value="#{cmFacturaGlosaBean.objeto.fechaMarcacion}"/>
                                    </p:column>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Fecha final bloqueo" style="font-weight:bold"></p:outputLabel>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText value="#{cmFacturaGlosaBean.objeto.fechaVencimiento}"/>
                                    </p:column>
                                </p:row>
                                                
                                <p:row>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Pbs" style="font-weight:bold"></p:outputLabel>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText style="color:red;font-weight:bold;" value="#{cmFacturaGlosaBean.objeto.pbs?'Si':'No'}"/>
                                    </p:column>
                                </p:row>
                             
                            </p:panelGrid> 
                        </p:panel>
                        <p:panel  toggleable="true" id="pDetallesSumatoria" header="Sumatoria Valores Servicios" style="margin-bottom:10px;">                               
                            <p:panelGrid id="panelDetallesSumatoria" columns="4"
                                         layout="grid">
                                
                                <p:row>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Valor suma facturado" style="font-weight:bold" />
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText value="#{cmFacturaGlosaBean.objeto.cmGlosaRespuestaDetalle.valorFacturadoPrecalculado}">
                                            <f:convertNumber locale="es_CO" currencySymbol="$ " type="currency" maxFractionDigits="4"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Valor suma pendiente actual" style="font-weight:bold"/>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText value="#{cmFacturaGlosaBean.objeto.cmGlosaRespuestaDetalle.valorPendienteActualPrecalculado}">
                                            <f:convertNumber locale="es_CO" currencySymbol="$ " type="currency" maxFractionDigits="4"/>
                                        </h:outputText>
                                    </p:column>
                                </p:row>

                                <p:row>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Valor suma pagado EPS" style="font-weight:bold" />
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText value="#{cmFacturaGlosaBean.objeto.cmGlosaRespuestaDetalle.valorPagadoEpsPrecalculado}">
                                            <f:convertNumber locale="es_CO" currencySymbol="$ " type="currency" maxFractionDigits="4"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Valor suma aceptado IPS" style="font-weight:bold" />
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText value="#{cmFacturaGlosaBean.objeto.cmGlosaRespuestaDetalle.valorAceptadoIpsPrecalculado}">
                                            <f:convertNumber locale="es_CO" currencySymbol="$ " type="currency" maxFractionDigits="4"/>
                                        </h:outputText>
                                    </p:column>
                                </p:row>
                               
                            </p:panelGrid>
                        </p:panel>
                        <p:panel id="panelgNota" style="width:100%;margin:10px">
                            Nota : Los servicios o detalles con valor pendiente actual igual a cero no serán mostrados ni tenidos en cuenta en la respuesta glosa.
                        </p:panel>
                        <p:panelGrid id="panelCantidadRespuesta" columns="1" style="width:100%;margin:10px" rendered="#{cmFacturaGlosaBean.objeto.maximoProcesosRegistrados}">
                            <p:row>
                                <p:column style="color: #149bdf;">
                                    Observación : La factura ya tiene registrados más de 2 procesos.
                                </p:column>
                            </p:row>
                        </p:panelGrid>
                        <p:panel  toggleable="true" id="pDetalles" header="Servicios Con Valores Pendientes" style="margin-bottom:10px; font-size:11px; width: 120%;">   
                            <p:remoteCommand id="rcom" name="loadFilterTablaDetalles" process="@this" update="frmGestionarGlosas:tablaDetalles"  actionListener="#{cmFacturaGlosaBean.actualizarSumaValorePorFiltro}"/>                                
                            <p:dataTable var="obj" value="#{cmFacturaGlosaBean.registrosDetalles}" 
                                         paginator="false"                
                                         emptyMessage="No se encontraron registros"
                                         selection="#{cmFacturaGlosaBean.registrosDetallesSelected}"
                                         currentPageReportTemplate="Registros del {startRecord} al {endRecord} de {totalRecords}, Página {currentPage} de {totalPages}"
                                         paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                         rowsPerPageTemplate="30,50,100,200"  lazy="false"
                                         widgetVar="tablaWidgetDetalles"
                                         scrollable="true"
                                         scrollWidth="100%"
                                         scrollHeight="250"
                                         reflow="true"
                                         id="tablaDetalles"
                                         editable="true"
                                         filteredValue="#{cmFacturaGlosaBean.registrosDetallesFiltrados}"
                                         rowStyleClass="#{obj.valorPendienteActual le 0 ? 'red' : null}"
                                         rowKey="#{obj.id}" style="margin-top: 10px;">



                                <p:ajax event="filter" oncomplete="loadFilterTablaDetalles();"  />
                                <p:ajax event="rowEdit" listener="#{cmFacturaGlosaBean.onRowEdit}" />

                                <p:column style="text-align: center;" width="30">                                 
                                    <f:facet name="header">
                                        <h:outputText value=""/>
                                    </f:facet>    
                                    <p:commandButton  title="Ver Auditoria Servicio" process="@this" actionListener="#{cmFacturaGlosaBean.verServicioAuditado(obj.id)}" icon="ui-icon-search"/> 
                                </p:column> 

                                <p:column  headerText="Estado" sortBy="#{obj.estado}">     
                                    <h:outputText value="#{obj.estadoStr}" title="#{obj.estadoStr}"/>
                                </p:column>

                                <p:column  headerText="Estado Glosado IPS - EPS " sortBy="#{obj.estado}">     
                                    <h:outputText class="yellow" value="#{obj.porcentajeAceptadoIPS > 0 or obj.porcentajePagadoEPS > 0 or (obj.observacionRespuestaDetalles != null or obj.observacionGlosa != null) ? 'En Proceso glosado IPS - EPS':''}" title="#{obj.estadoStr}"/>
                                </p:column>                                        

                                <p:column  headerText="Código servicio" sortBy="#{obj.maServicioCodigo}" filterBy="#{obj.maServicioCodigo}">
                                    <f:facet name="filter">
                                        <p:inputText label="Código servicio" maxlength="64" style="width: 95%;" onkeypress="if (event.keyCode === 13) {
                                                    onchange();
                                                    return false;
                                                }"  onchange="PF('tablaWidgetDetalles').filter()" />
                                    </f:facet>
                                    <h:outputText value="#{obj.maServicioCodigo}" title="#{obj.maServicioCodigo}"/>
                                </p:column>
                                <p:column  headerText="Nombre servicio" sortBy="#{obj.maServicioValor}" filterBy="#{obj.maServicioValor}">

                                    <f:facet name="filter">
                                        <p:inputText label="Nombre servicio" maxlength="64" style="width: 95%;" onkeypress="if (event.keyCode === 13) {
                                                    onchange();
                                                    return false;
                                                }"  onchange="PF('tablaWidgetDetalles').filter()" />
                                    </f:facet>     
                                    <h:outputText value="#{obj.nombreServicioCorto}" title="#{obj.nombreServicioCorto}"/>
                                    <p:commandButton rendered="#{obj.nombreServicioCorto.length() > 1 }" onmouseup="PF('dlgMsg').show();" process="@this"  immediate="true"  icon="ui-icon-comment" title="Ver completo" actionListener="#{cmFacturaGlosaBean.actualizarPanelMostrarMensaje()}">
                                        <f:setPropertyActionListener value="#{obj.maServicioValor}" target="#{cmFacturaGlosaBean.mensaje}" />
                                    </p:commandButton>
                                </p:column>

                                <p:column  headerText="Documento afiliado" sortBy="#{obj.documento}" filterBy="#{obj.documento}">     
                                    <f:facet name="filter">
                                        <p:inputText label="Documento afiliado" maxlength="64" style="width: 95%;" onkeypress="if (event.keyCode === 13) {
                                                    onchange();
                                                    return false;
                                                }"  onchange="PF('tablaWidgetDetalles').filter()" />
                                    </f:facet>
                                    <h:outputText value="#{obj.documento}" title="#{obj.documento}"/>
                                </p:column>
                                <p:column  headerText="Nombre afiliado" sortBy="#{obj.nombreCompletoAfiliado}" filterBy="#{obj.nombreCompletoAfiliado}">
                                    <f:facet name="filter">
                                        <p:inputText label="Nombre afiliado" maxlength="64" style="width: 95%;" onkeypress="if (event.keyCode === 13) {
                                                    onchange();
                                                    return false;
                                                }"  onchange="PF('tablaWidgetDetalles').filter()" />
                                    </f:facet>
                                    <h:outputText value="#{obj.nombreCompletoAfiliado}" title="#{obj.nombreCompletoAfiliado}"/>
                                </p:column>

                                <p:column  headerText="Radicado glosa" sortBy="#{obj.radicadoGlosa}" filterBy="#{obj.radicadoGlosa}" >  
                                    <f:facet name="filter">
                                        <p:inputText label="Radicado glosa" maxlength="64" style="width: 95%;" onkeypress="if (event.keyCode === 13) {
                                                    onchange();
                                                    return false;
                                                }"  onchange="PF('tablaWidgetDetalles').filter()" />
                                    </f:facet>
                                    <h:outputText value="#{obj.radicadoGlosa}" title="#{obj.radicadoGlosa}"/>
                                </p:column>

                                <p:column  headerText="Motivos glosa" sortBy="#{obj.motivoGlosa}" filterBy="#{obj.motivoGlosa}">
                                    <f:facet name="filter">
                                        <p:inputText label="Motivos glosa" maxlength="64" style="width: 95%;" onkeypress="if (event.keyCode === 13) {
                                                    onchange();
                                                    return false;
                                                }"  onchange="PF('tablaWidgetDetalles').filter()" />
                                    </f:facet>
                                    <h:outputText value="#{obj.motivoGlosaCorto}" title="#{obj.motivoGlosa}"/>
                                    <p:commandButton rendered="#{obj.motivoGlosaCorto.length() > 1 }" onmouseup="PF('dlgMsg').show();" process="@this"  immediate="true"  icon="ui-icon-comment" title="Ver completo" actionListener="#{cmFacturaGlosaBean.actualizarPanelMostrarMensaje()}">
                                        <f:setPropertyActionListener value="#{obj.motivoGlosa}" target="#{cmFacturaGlosaBean.mensaje}" />
                                    </p:commandButton>                               
                                </p:column>

                                <p:column  headerText="Observación detalle">
                                    <f:facet name="filter">
                                        <p:inputText label="Observación detalle" maxlength="64" style="width: 95%;" onkeypress="if (event.keyCode === 13) {
                                                    onchange();
                                                    return false;
                                                }"  onchange="PF('tablaWidgetDetalles').filter()" />
                                    </f:facet>

                                    <h:outputText value="#{obj.observacionDetalleCorto}" title="#{obj.observacionDetalleCorto}"/>
                                    <p:commandButton rendered="#{obj.observacionDetalleCorto.length() > 1 }" onmouseup="PF('dlgMsg').show();" process="@this"  immediate="true"  icon="ui-icon-comment" title="Ver completo" actionListener="#{cmFacturaGlosaBean.actualizarPanelMostrarMensaje()}">
                                        <f:setPropertyActionListener value="#{obj.observacion}" target="#{cmFacturaGlosaBean.mensaje}" />
                                    </p:commandButton>

                                </p:column>

                                <p:column  headerText="Valor copago" sortBy="#{obj.valorCopago}">
                                    <h:outputText value="#{obj.valorCopago}" title="#{obj.valorCopago}">
                                        <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                    </h:outputText>
                                </p:column>
                                <p:column  headerText="Valor facturado" sortBy="#{obj.valorFacturado}">
                                    <h:outputText value="#{obj.valorFacturado}" title="#{obj.valorFacturado}">
                                        <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                    </h:outputText>
                                </p:column>
                                <p:column  headerText="Valor pagado" sortBy="#{obj.valorPagado}">
                                    <h:outputText value="#{obj.valorPagado}" title="#{obj.valorPagado}">
                                        <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                    </h:outputText>
                                </p:column>                          
                                <p:column  headerText="Valor pendiente inicial" sortBy="#{obj.valorPendiente}">
                                    <h:outputText value="#{obj.valorPendiente}" title="#{obj.valorPendiente}">
                                        <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                    </h:outputText>
                                </p:column>
                                <p:column  headerText="Valor pendiente actual" sortBy="#{obj.valorPendienteActual}">
                                    <h:outputText value="#{obj.valorPendienteActual}" title="#{obj.valorPendienteActual}">
                                        <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                    </h:outputText>
                                </p:column>
                                <p:column  headerText="Valor pagado EPS" sortBy="#{obj.valorPagadoEPS}">
                                    <p:cellEditor>       
                                        <f:facet name="output">
                                            <h:outputText value="#{obj.valorPagadoEPS}" title="#{obj.valorPagadoEPS}">
                                                <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                            </h:outputText>
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:inputText  value="#{obj.valorPagadoEPS}" style="width:100%" onkeypress="if (event.keyCode === 13) {
                                                        return false;
                                                    }"
                                                          validatorMessage="Ingreso solo números positivos"
                                                          converterMessage="Ingrese números positivos y decimales separados por punto, hasta 4 decimales Ej:12.9876">
                                                <f:validateLongRange minimum="0"  />  
                                            </p:inputText>
                                        </f:facet>
                                    </p:cellEditor>
                                </p:column>
                                <p:column  headerText="Porcentaje pagado EPS" sortBy="#{obj.porcentajePagadoEPS}">
                                    <p:cellEditor id="nombreCell">       
                                        <f:facet name="output">
                                            <h:outputText value="#{obj.porcentajePagadoEPS}" title="#{obj.porcentajePagadoEPS}" >
                                                <f:convertNumber  maxFractionDigits="2"/>
                                            </h:outputText>
                                            <h:outputText rendered="#{obj.porcentajePagadoEPS>0}" value="%" title="#{obj.porcentajePagadoEPS}"> </h:outputText>
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:inputNumber minValue="0" decimalPlaces="2" value="#{obj.porcentajePagadoEPS}" maxValue="100" symbol="%" symbolPosition="s" onkeypress="if (event.keyCode === 13) {
                                                        return false;
                                                    }" ></p:inputNumber>
                                        </f:facet>
                                    </p:cellEditor>
                                </p:column>

                                <p:column  headerText="Valor aceptado IPS" sortBy="#{obj.valorAceptadoIPS}">
                                    <p:cellEditor>       
                                        <f:facet name="output">
                                            <h:outputText value="#{obj.valorAceptadoIPS}" title="#{obj.valorAceptadoIPS}">
                                                <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                            </h:outputText>
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:inputText  value="#{obj.valorAceptadoIPS}" style="width:100%" 
                                                          onkeypress="if (event.keyCode === 13) {
                                                                      return false;
                                                                  }"
                                                          validatorMessage="Ingreso solo números positivos"
                                                          converterMessage="Ingrese números positivos y decimales separados por punto, hasta 4 decimales Ej:12.9876">
                                                <f:validateLongRange minimum="0"  />   
                                            </p:inputText>
                                        </f:facet>
                                    </p:cellEditor>
                                </p:column>

                                <p:column  headerText="Porcentaje aceptado IPS" sortBy="#{obj.porcentajeAceptadoIPS}">
                                    <p:cellEditor>       
                                        <f:facet name="output">
                                            <h:outputText value="#{obj.porcentajeAceptadoIPS}" title="#{obj.porcentajeAceptadoIPS}">
                                                <f:convertNumber  maxFractionDigits="2"/>
                                            </h:outputText>
                                            <h:outputText rendered="#{obj.porcentajeAceptadoIPS>0}" value="%" title="#{obj.porcentajeAceptadoIPS}"> </h:outputText>
                                        </f:facet>
                                        <f:facet name="input">
                                            <p:inputNumber minValue="0" decimalPlaces="2" value="#{obj.porcentajeAceptadoIPS}" maxValue="100" symbol="%" symbolPosition="s" onkeypress="if (event.keyCode === 13) {
                                                        return false;
                                                    }"  >
                                            </p:inputNumber>
                                        </f:facet>
                                    </p:cellEditor>
                                </p:column> 
                                <p:column  headerText="Observación Respuesta" sortBy="#{obj.observacionGlosa}" style="text-align: center;" >
                                    <p:cellEditor>       
                                        <f:facet name="output">
                                            <h:outputText value="#{obj.observacionGlosaCorto}" title="#{obj.observacionGlosaCorto}"/> 
                                        </f:facet>
                                        <f:facet name="input" >
                                            <p:commandButton onmouseup="PF('dlgObservacionDetalle').show();" process="@this"  immediate="true"  icon="ui-icon-comment" title="Ver completo" actionListener="#{cmFacturaGlosaBean.actualizarPanelObservacion()}">
                                                <f:setPropertyActionListener value="#{obj}" target="#{cmFacturaGlosaBean.detalleEditadoActual}" />
                                            </p:commandButton>
                                        </f:facet>
                                    </p:cellEditor>
                                </p:column>
                                <p:column style="width:20px">
                                    <p:rowEditor />
                                </p:column>
                            </p:dataTable>
                            <h:panelGroup style="display:block; text-align:center; margin-top: 10px;">  
                                <p:remoteCommand immediate="true" name="abrirVentanaResponder" action="#{cmFacturaGlosaBean.verReponderGlosa( )}" />
                                <p:commandButton type="button" value="Responder Glosas" onclick="abrirVentanaResponder()" process="@form"  immediate="true"/>
                            </h:panelGroup>
                        </p:panel>

                        <p:panel  toggleable="true" id="pDatosRespuesta" header="Aplicación Valor Masivo" style="margin-bottom:10px;">                          
                            <p:panelGrid id="panelFormularioCalculoRespuestas" columns="4"
                                         columnClasses="ui-grid-col-2,ui-grid-col-4,ui-grid-col-2,ui-grid-col-4"
                                         layout="grid"
                                         styleClass="ui-panelgrid-blank ui-fluid" >                            

                                <p:outputLabel value="Sumatoria pagado EPS items seleccionados "  style="font-weight:bold"/>
                                <h:outputText value="#{cmFacturaGlosaBean.objeto.cmGlosaRespuestaDetalle.valorPagadoEpsSeleccionados}" 
                                              title="#{cmFacturaGlosaBean.objeto.cmGlosaRespuestaDetalle.valorPagadoEpsSeleccionados}">
                                    <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                </h:outputText>

                                <p:outputLabel value="Sumatoria aceptado IPS items seleccionados"  style="font-weight:bold"/>
                                <h:outputText value="#{cmFacturaGlosaBean.objeto.cmGlosaRespuestaDetalle.valorAceptadoIpsSeleccionados}" 
                                              title="#{cmFacturaGlosaBean.objeto.cmGlosaRespuestaDetalle.valorAceptadoIpsSeleccionados}">
                                    <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                </h:outputText>

                                <p:outputLabel value="Sumatoria valor pagado items seleccionados" style="font-weight:bold" />
                                <h:outputText value="#{cmFacturaGlosaBean.objeto.cmGlosaRespuestaDetalle.valorPagadoItemsSeleccionados}" 
                                              title="#{cmFacturaGlosaBean.objeto.cmGlosaRespuestaDetalle.valorPagadoItemsSeleccionados}">
                                    <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                </h:outputText>

                                <p:outputLabel value="Sumatoria pendientes actuales items seleccionados"   style="font-weight:bold"/>
                                <h:outputText value="#{cmFacturaGlosaBean.objeto.cmGlosaRespuestaDetalle.valorPendienteActualItemsSeleccionados}" 
                                              title="#{cmFacturaGlosaBean.objeto.cmGlosaRespuestaDetalle.valorPendienteActualItemsSeleccionados}">
                                    <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                </h:outputText>

                                <p:outputLabel value="Valor pagado EPS" style="font-weight:bold" />
                                <p:inputNumber tabindex="1"  id="valorPagadoEps" minValue="0"  value="#{cmFacturaGlosaBean.objeto.cmGlosaRespuestaDetalle.valorPagadoEps}" decimalPlaces="4" >  
                                    <p:ajax event="blur" update="porcentajeEps"  listener="#{cmFacturaGlosaBean.conversionPorcentaje( 1 )}" /> 
                                </p:inputNumber>    

                                <p:outputLabel value="Porcentaje pagado EPS" style="font-weight:bold" />
                                <p:inputNumber  id="porcentajeEps" minValue="0" decimalPlaces="2" value="#{cmFacturaGlosaBean.objeto.cmGlosaRespuestaDetalle.porcentajePagadoEps}" maxValue="100" symbol="%" symbolPosition="s" >  
                                    <p:ajax event="blur" update="valorPagadoEps" listener="#{cmFacturaGlosaBean.conversionValor( 1 )}" /> 
                                </p:inputNumber> 

                                <p:outputLabel value="Valor aceptado IPS"  style="font-weight:bold"/>
                                <p:inputNumber tabindex="2" id="valorAceptadoIps" minValue="0"  value="#{cmFacturaGlosaBean.objeto.cmGlosaRespuestaDetalle.valorAceptadoIps}" decimalPlaces="4" emptyValue="empty" >  
                                    <p:ajax event="blur"  update="porcentajeIps" listener="#{cmFacturaGlosaBean.conversionPorcentaje( 2 )}" /> 
                                </p:inputNumber> 

                                <p:outputLabel value="Porcentaje aceptado IPS" style="font-weight:bold" />
                                <p:inputNumber id="porcentajeIps" minValue="0" decimalPlaces="2" value="#{cmFacturaGlosaBean.objeto.cmGlosaRespuestaDetalle.porcentajeAceptadoIps}" maxValue="100" symbol="%" symbolPosition="s" >  
                                    <p:ajax event="blur" update="valorAceptadoIps"  listener="#{cmFacturaGlosaBean.conversionValor( 2 )}" /> 
                                </p:inputNumber> 

                                <p:outputLabel value="Observación" for="observacionRespuesta" style="font-weight:bold" />
                                <h:inputTextarea id="observacionRespuesta" value="#{cmFacturaGlosaBean.objeto.cmGlosaRespuestaDetalle.observacionMasiva}" required="true" requiredMessage="Observación : Este campo es obligatorio." style="width: 100%;"/>

                            </p:panelGrid>

                            <p:panelGrid id="panelLimpiar" columns="1" layout="grid" styleClass="showcase-text-align-center">
                                <h:panelGroup style="display:block; text-align:center; margin-top: 10px;" class="ui-g-12">
                                    <p:commandButton value="Limpiar Datos"  actionListener="#{cmFacturaGlosaBean.refrescarLimpiarFormularioCalculoMasivo( )}"  immediate="true"/>
                                    <p:commandButton value="Aplicar Porcentajes"  actionListener="#{cmFacturaGlosaBean.aplicarCalculoGrupoDetalles( )}" process="@form" update="@form" resetValues="true"/>
                                </h:panelGroup>
                            </p:panelGrid>
                            
                        </p:panel> 

                        <p:panel toggleable="true" id="pEdicionAuditoria" header="Edición Auditoría" style="margin-bottom:10px;">
                            <p:panelGrid id="panelEdicionAuditoria" columns="3" layout="grid" styleClass="showcase-text-align-center">

                                <p:outputLabel value="Tipo Auditoría" for="tipoAuditoria"  style="font-weight:bold"/>
                                <p:selectOneMenu    editable="fase" id="tipoAuditoria" value="#{cmFacturaGlosaBean.objeto.tipoAuditoria}" >
                                    <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />
                                    <f:selectItem itemLabel="Sin Auditoría" itemValue="0" />
                                    <f:selectItem itemLabel="Técnica" itemValue="6" />
                                    <f:selectItem itemLabel="Médica" itemValue="7" />
                                    <f:selectItem itemLabel="Para Pago" itemValue="8" />
                                    <p:ajax update="pEdicionAuditoria" />
                                </p:selectOneMenu>

                                <p:commandButton process="@this" update="panelEdicionAuditoria" value="Cambiar Auditoría" actionListener="#{cmFacturaGlosaBean.modificarAuditoria( cmFacturaGlosaBean.objeto )}" immediate="true" />

                            </p:panelGrid>
                        </p:panel>

                        <p:panelGrid  style="width:100%;margin:10px 0px">
                            <f:facet name="footer">
                                <p:row>
                                    <p:column style="text-align: center">
                                        <h:panelGroup style="display:block; text-align:center;">
                                            <p:commandButton value="Salir" type="button" onclick="PF('dialogoGestionarGlosas').hide()"  actionListener="#{cmFacturaGlosaBean.cerrarVentanaResponderGlosa( )}" immediate="true"/>
                                        </h:panelGroup>
                                    </p:column>
                                </p:row>
                            </f:facet>
                        </p:panelGrid>
                    </h:form>
                </p:scrollPanel>
            </p:dialog>


            <p:dialog header="Ver Detalles Glosa" id="dialogoVerGlosaRespuestaDetalles" widgetVar="dialogoVerGlosaRespuestaDetalles" appendTo="@(body)" modal="true"  width="90%" dynamic="true"  style="max-height:90%;">
                <p:scrollPanel mode="native" style="height:500px">
                    <h:form id="frmVerGlosaRespuesas">
                        <p:panel id="pVerGlosaRespuesas" toggleable="true" header="Glosa Factura" style="margin-bottom:10px;">
                            <p:outputPanel class="frmAuditoria" style="margin-top: -5px; text-align: right;">
                                <p:commandButton  class="btnAuditoria" action="#{cmFacturaGlosaBean.getAuditoria(cmFacturaGlosaBean.cmGlosaRespuesta.auditoriaStrHTML)}" icon="ui-icon-comment" title="Auditoría" />
                            </p:outputPanel>
                            <p:panelGrid id="panelVerGlosaRespuesas" columns="4" layout="grid" >

                                <p:row>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Id factura" style="font-weight:bold"/>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <p:outputLabel value="#{cmFacturaGlosaBean.cmGlosaRespuesta.cmFactura.id}"/>
                                    </p:column>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Id respuesta factura" style="font-weight:bold"/>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <p:outputLabel value="#{cmFacturaGlosaBean.cmGlosaRespuesta.id}"/>
                                    </p:column>
                                </p:row>
                                                            
                                <p:row>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Valor pagado EPS" style="font-weight:bold"/>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <p:outputLabel value="#{cmFacturaGlosaBean.cmGlosaRespuesta.valorPagadoEps}">
                                            <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                        </p:outputLabel>
                                    </p:column>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Valor aceptado IPS" style="font-weight:bold"/>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <p:outputLabel value="#{cmFacturaGlosaBean.cmGlosaRespuesta.valorAceptadoIps}">
                                            <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                        </p:outputLabel>

                                    </p:column>
                                </p:row>
                                                               
                            </p:panelGrid>
                        </p:panel>

                        <p:panel id="pGlosaRespuestaDetalles" toggleable="true" header="Detalles de glosa" style="margin-bottom:10px;">                               
                            <p:dataTable var="obj" value="#{cmFacturaGlosaBean.lazyGlosaRespuestaDetalle}" paginator="true" rows="#{cmFacturaGlosaBean.tamanoPagina}" 
                                         emptyMessage="No se encontraron registros"
                                         currentPageReportTemplate="Registros del {startRecord} al {endRecord} de {totalRecords}, Página {currentPage} de {totalPages}"
                                         paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                         rowsPerPageTemplate="5,10,30,50,100" id="tablaRegistros" lazy="true"
                                         widgetVar="tablaWidgetGlosaRespuestaDetalles"
                                         scrollable="true"
                                         scrollHeight="400"
                                         scrollWidth="100%"
                                         rowKey="#{obj.id}" >
                                <p:column  headerText="Id" sortBy="#{obj.id}">
                                    <h:outputText value="#{obj.id}" title="#{obj.id}"/>
                                </p:column>
                                <p:column  headerText="Id glosa respuesta" sortBy="#{obj.cmGlosaRespuesta.id}">
                                    <h:outputText value="#{obj.cmGlosaRespuesta.id}" title="#{obj.cmGlosaRespuesta.id}"/>
                                </p:column>
                                <p:column  headerText="Id detalle servicio" sortBy="#{obj.cmDetalle.id}">
                                    <h:outputText value="#{obj.cmDetalle.id}" title="#{obj.cmDetalle.id}"/>
                                </p:column>
                                <p:column  headerText="Tipo Respuesta" sortBy="#{obj.cmGlosaRespuesta.tipoRespuestaStr}">
                                    <h:outputText value="#{obj.cmGlosaRespuesta.tipoRespuestaStr}" title="#{obj.cmGlosaRespuesta.tipoRespuestaStr}"/>
                                </p:column>
                                <p:column  headerText="Documento" sortBy="#{obj.documento}">
                                    <h:outputText value="#{obj.documento}" title="#{obj.documento}"/>
                                </p:column>

                                <p:column  headerText="Valor cobro detalle" sortBy="#{obj.valorCobroDetalle}">
                                    <h:outputText value="#{obj.valorCobroDetalle}" title="#{obj.valorCobroDetalle}">
                                        <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                    </h:outputText>
                                </p:column>
                                <p:column  headerText="Valor facturado" sortBy="#{obj.valorFacturado}">
                                    <h:outputText value="#{obj.valorFacturado}" title="#{obj.valorFacturado}">
                                        <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                    </h:outputText>
                                </p:column>     
                                <p:column  headerText="Valor pagado" sortBy="#{obj.valorPagado}">
                                    <h:outputText value="#{obj.valorPagado}" title="#{obj.valorPagado}">
                                        <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                    </h:outputText>
                                </p:column>
                                <p:column  headerText="Valor pagado EPS" sortBy="#{obj.valorPagadoEps}">
                                    <h:outputText value="#{obj.valorPagadoEps}" title="#{obj.valorPagadoEps}">
                                        <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                    </h:outputText>
                                </p:column>
                                <p:column  headerText="Porcentaje pagado EPS" sortBy="#{obj.porcentajePagadoEps}">
                                    <h:outputText value="#{obj.porcentajePagadoEps}" title="#{obj.porcentajePagadoEps}"></h:outputText>
                                    <h:outputText rendered="#{obj.porcentajePagadoEps>0}" value="%" title="#{obj.porcentajePagadoEps}"> </h:outputText>
                                </p:column>        
                                <p:column  headerText="Valor pendiente" sortBy="#{obj.valorPendiente}">
                                    <h:outputText value="#{obj.valorPendiente}" title="#{obj.valorPendiente}">
                                        <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                    </h:outputText>
                                </p:column>
                                <p:column  headerText="Valor aceptado Ips" sortBy="#{obj.valorAceptadoIps}">
                                    <h:outputText value="#{obj.valorAceptadoIps}" title="#{obj.valorAceptadoIps}">
                                        <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                    </h:outputText>
                                </p:column>
                                <p:column  headerText="Porcentaje pagado IPS" sortBy="#{obj.porcentajeAceptadoIps}">
                                    <h:outputText value="#{obj.porcentajeAceptadoIps}" title="#{obj.porcentajeAceptadoIps}"></h:outputText>
                                    <h:outputText rendered="#{obj.porcentajeAceptadoIps>0}" value="%" title="#{obj.porcentajeAceptadoIps}"> </h:outputText>
                                </p:column>  
                                <p:column  headerText="Fecha creación" sortBy="#{obj.fechaHoraCrea}">
                                    <h:outputText value="#{obj.fechaHoraCrea}" title="#{obj.fechaHoraCrea}"/>
                                </p:column>
                                <p:column  headerText="Observación" sortBy="#{obj.observacion}">
                                    <h:outputText value="#{obj.observacionCorto}" />
                                    <p:commandButton rendered="#{obj.observacionCorto.length() > 1 }" actionListener="#{cmFacturaGlosaBean.mostrarMensaje(obj.observacion)}" icon="ui-icon-comment" title="Ver completo"/>                                
                                </p:column>
                            </p:dataTable>                             
                        </p:panel>
                        <p:panelGrid  style="width:100%;margin:10px 0px">
                            <f:facet name="footer">
                                <p:row>
                                    <p:column style="text-align: center">
                                        <h:panelGroup style="display:block; text-align:center;">
                                            <p:commandButton value="Salir" type="button" onclick="PF('dialogoVerGlosaRespuestaDetalles').hide()" immediate="true"/>
                                        </h:panelGroup>
                                    </p:column>
                                </p:row>
                            </f:facet>
                        </p:panelGrid>
                    </h:form>
                </p:scrollPanel> 
            </p:dialog>

            <p:dialog header="Descripción" widgetVar="dlgMsg" minHeight="50" appendTo="@(body)" modal="true"  width="80%" dynamic="true">           
                <p:scrollPanel mode="native" style="height:100px">
                    <h:form id="frmObservacion" style="padding: 10px;">          
                        <h:outputText id="mensaje" value="#{cmFacturaGlosaBean.mensaje}" />
                        <p:panelGrid  style="width:100%;margin:10px 0px">
                            <f:facet name="footer">
                                <p:row>
                                    <p:column style="text-align: center">
                                        <h:panelGroup style="display:block; text-align:center;">
                                            <p:commandButton value="Salir" type="button" onclick="PF('dlgMsg').hide()" immediate="true"/>
                                        </h:panelGroup>
                                    </p:column>
                                </p:row>
                            </f:facet>
                        </p:panelGrid>
                    </h:form>
                </p:scrollPanel>
            </p:dialog>

            <p:dialog header="Registrar Respuesta" widgetVar="dialogoRegistrarGlosa" appendTo="@(body)" modal="true"  width="50%" dynamic="true">           
                <p:scrollPanel mode="native" style="height:250px">
                    <h:form id="frmReponderGlosa" style="padding: 10px;">   
                        <p:panelGrid id="panelRegistrar" columns="2" layout="grid" styleClass="showcase-text-align-center">

                            <p:outputLabel value="Estado" for="estadoRespuesta"  style="font-weight:bold" />
                            <p:selectOneMenu id="estadoRespuesta" value="#{cmFacturaGlosaBean.objeto.cmGlosaRespuestaDetalle.tipoEstadoRespuesta}"   editable="false" style="width: 64px;" required="true" requiredMessage="Estado : Este campo es obligatorio." >
                                <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />
                                <f:selectItem itemLabel="Respuesta" itemValue="1" />
                            </p:selectOneMenu>

                            <p:outputLabel value="Observación" for="observacionRespuesta" style="font-weight:bold"/>
                            <h:inputTextarea id="observacionRespuesta" value="#{cmFacturaGlosaBean.objeto.cmGlosaRespuestaDetalle.observacion}" required="false" requiredMessage="Observación : Este campo es obligatorio." style="width: 100%;"/>

                        </p:panelGrid>
                        <p:panelGrid  style="width:100%;margin:10px 0px">
                            <f:facet name="footer">
                                <p:row>
                                    <p:column style="text-align: center">
                                        <h:panelGroup style="display:block; text-align:center;">   
                                            <p:commandButton value="Registrar Respuesta"  actionListener="#{cmFacturaGlosaBean.responderGlosa( )}" />
                                            <p:commandButton value="Salir" type="button" onclick="PF('dialogoRegistrarGlosa').hide()" immediate="true" onkeypress="if (event.keyCode === 13) {
                                                        return false;
                                                    }"/>
                                        </h:panelGroup>
                                    </p:column>
                                </p:row>
                            </f:facet>
                        </p:panelGrid>
                    </h:form>
                </p:scrollPanel>
            </p:dialog>

            <p:dialog header="Observación" widgetVar="dlgObservacionDetalle" minHeight="200" appendTo="@(body)" modal="true"  width="90%" dynamic="true">           
                <p:scrollPanel mode="native" style="height:200px">
                    <h:form id="frmObservacionDetalle" style="padding: 10px;">          
                        <p:inputTextarea style="width: 100%;" value="#{cmFacturaGlosaBean.detalleEditadoActual.observacionGlosa}"/>
                        <h:outputText rendered="#{cmFacturaGlosaBean.detalleEditadoActual.existeObservacionHistorica}" value="Observaciones Realizadas: " title="Observaciones Realizadas"/>
                        <p:inputTextarea rendered="#{cmFacturaGlosaBean.detalleEditadoActual.existeObservacionHistorica}" disabled="true" style="width: 100%;" value="#{cmFacturaGlosaBean.detalleEditadoActual.observacionRespuestaDetalles}"/>
                        <p:panelGrid  style="width:100%;margin:10px 0px">
                            <f:facet name="footer">
                                <p:row>
                                    <p:column style="text-align: center">
                                        <h:panelGroup style="display:block; text-align:center;">
                                            <p:commandButton value="Aceptar" actionListener="#{cmFacturaGlosaBean.registrarObservacion( )}" />
                                            <p:commandButton value="Salir" type="button" onclick="PF('dlgObservacionDetalle').hide()" immediate="true"/>
                                        </h:panelGroup>
                                    </p:column>
                                </p:row>
                            </f:facet>
                        </p:panelGrid>
                    </h:form>
                </p:scrollPanel>
            </p:dialog> 

            <p:dialog widgetVar="dialogoVerAuditoriaServicio" header="Auditoría de servicio" appendTo="@(body)" responsive="true" modal="true" width="90%"  style="max-height:90%;">
                <p:scrollPanel mode="native" style="height:500px">
                    <h:form id="frmVerAuditoriaServicio">
                        <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                            <p:commandButton value="Si" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" style="left:25%"/>
                            <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" style="left:25%"/>
                        </p:confirmDialog>
                        <p:panel id="panelVerFacturaItem" header="Factura" style="margin-bottom:10px;" collapsed="false" toggleable="true">
                            <f:facet name="header">
                                <h:outputLabel value="Ver Factura"></h:outputLabel>
                            </f:facet>
                            <p:outputPanel class="frmAuditoria" style="margin-top: -5px; text-align: right;">
                                <p:commandButton  class="btnAuditoria" action="#{cmFacturaGlosaBean.getAuditoria(cmFacturaGlosaBean.objeto.auditoriaStrHTML)}" icon="ui-icon-comment" title="Auditoría" />
                            </p:outputPanel>
                            <p:panelGrid id="panelDatosFactura" columns="4"
                                         layout="grid">

                                <p:row>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Estado Factura"  style="font-weight:bold"/>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <p:outputLabel value="#{cmFacturaGlosaBean.objeto.estadoFacturaStr}"/>
                                    </p:column>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Número radicado"  style="font-weight:bold"/>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <p:outputLabel value="#{cmFacturaGlosaBean.objeto.numeroRadicado}"/>
                                    </p:column>
                                </p:row>
                                                              
                                <p:row>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Número factura"  style="font-weight:bold"/>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <p:outputLabel value="#{cmFacturaGlosaBean.objeto.numeroFacturado}"/>
                                    </p:column>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Fecha radicación"  style="font-weight:bold" />
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <p:outputLabel value="#{cmFacturaGlosaBean.objeto.fechaRadicacion}"/>
                                    </p:column>
                                </p:row>
                               
                                <p:row>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Fecha prestación"  style="font-weight:bold"/>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <p:outputLabel value="#{cmFacturaGlosaBean.objeto.fechaPrestacion}"/>
                                    </p:column>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Modalidad contrato"  style="font-weight:bold"/>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <p:outputLabel value="#{cmFacturaGlosaBean.objeto.maeTipoContratoValor}"/>
                                    </p:column>
                                </p:row>
                                                           
                                <p:row>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Valor factura"  style="font-weight:bold"/>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText value="#{cmFacturaGlosaBean.objeto.valorFactura}" title="#{cmFacturaGlosaBean.objeto.valorFactura}">
                                            <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Valor copago"  style="font-weight:bold"/>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText value="#{cmFacturaGlosaBean.objeto.valorCopago}" title="#{cmFacturaGlosaBean.objeto.valorCopago}">
                                            <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                        </h:outputText>
                                    </p:column>
                                </p:row>
                                                               
                                <p:row>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Valor bruto"  style="font-weight:bold"/>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText value="#{cmFacturaGlosaBean.objeto.valorBruto}" title="#{cmFacturaGlosaBean.objeto.valorBruto}">
                                            <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Régimen"  style="font-weight:bold"/>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <p:outputLabel value="#{cmFacturaGlosaBean.objeto.maeRegimenValor}"/>
                                    </p:column>
                                </p:row>
                                                             
                                <p:row>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Responsable del pago"  style="font-weight:bold"/>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <p:outputLabel value="#{cmFacturaGlosaBean.objeto.responsablePago}"/>
                                    </p:column>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Regional"  style="font-weight:bold"/>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <p:outputLabel value="#{cmFacturaGlosaBean.objeto.regional}"/>
                                    </p:column>
                                </p:row>
                               
                                <p:row>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Pbs"  style="font-weight:bold" ></p:outputLabel>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText style="color:red;font-weight:bold;" value="#{cmFacturaGlosaBean.objeto.pbs?'Si':'No'}"/>
                                    </p:column>
                                </p:row>
                                
                            </p:panelGrid>
                        </p:panel>
                        <p:panel id="panelVerServicio" header="Servicio" style="margin-bottom:10px;" collapsed="false" toggleable="true">
                            <f:facet name="header">
                                <h:outputLabel value="Servicio"></h:outputLabel>
                            </f:facet>
                            <p:outputPanel class="frmAuditoria" style="margin-top: -5px; text-align: right;">
                                <p:commandButton class="btnAuditoria" action="#{cmFacturaGlosaBean.getAuditoria(cmFacturaGlosaBean.detalleServicioActual.auditoriaStrHTML)}" icon="ui-icon-comment" title="Auditoría" />
                            </p:outputPanel>
                            <p:panelGrid id="panelDatosServicio" columns="4"
                                         layout="grid">
                                <p:row>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Tipo documento" style="font-weight:bold"/>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <p:outputLabel value="#{cmFacturaGlosaBean.detalleServicioActual.maeTipoDocumentoValor}"/>
                                    </p:column>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Documento" style="font-weight:bold"/>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <p:outputLabel value="#{cmFacturaGlosaBean.detalleServicioActual.documento}"/>
                                    </p:column>
                                </p:row>

                                <p:row>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Nombre completo" style="font-weight:bold"/>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <p:outputLabel value="#{cmFacturaGlosaBean.detalleServicioActual.nombreCompletoAfiliado}"/>
                                    </p:column>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Consecutivo item" style="font-weight:bold" />
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <p:outputLabel value="#{cmFacturaGlosaBean.detalleServicioActual.consecutivoItem}"/>
                                    </p:column>
                                </p:row>
                              
                                <p:row>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Código servicio" style="font-weight:bold"/>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <p:outputLabel value="#{cmFacturaGlosaBean.detalleServicioActual.maServicioCodigo}"/>
                                    </p:column>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Nombre servicio" style="font-weight:bold"/>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <p:outputLabel value="#{cmFacturaGlosaBean.detalleServicioActual.maServicioValor}"/>
                                    </p:column>
                                </p:row>
                                                              
                                <p:row>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Valor facturado" style="font-weight:bold"/>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText value="#{cmFacturaGlosaBean.detalleServicioActual.valorFacturado}" title="#{cmFacturaGlosaBean.detalleServicioActual.valorFacturado}">
                                            <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Valor pagado" style="font-weight:bold"/>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText value="#{cmFacturaGlosaBean.detalleServicioActual.valorPagado}" title="#{cmFacturaGlosaBean.detalleServicioActual.valorPagado}">
                                            <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                        </h:outputText>
                                    </p:column>
                                </p:row>
                                                                                           
                                <p:row>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Valor pendiente" style="font-weight:bold"/>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText value="#{cmFacturaGlosaBean.detalleServicioActual.valorPendiente}" title="#{cmFacturaGlosaBean.detalleServicioActual.valorPendiente}">
                                            <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                        </h:outputText>
                                    </p:column>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Valor pendiente actual" style="font-weight:bold"/>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <h:outputText value="#{cmFacturaGlosaBean.detalleServicioActual.valorPendienteActual}" title="#{cmFacturaGlosaBean.detalleServicioActual.valorPendienteActual}">
                                            <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                        </h:outputText>
                                    </p:column>
                                </p:row>

                                <p:row>
                                    <p:column styleClass="ui-widget-header ui-g-3">
                                        <p:outputLabel value="Fecha prestación" style="font-weight:bold"/>
                                    </p:column>
                                    <p:column styleClass=" ui-g-3" >
                                        <p:outputLabel value="#{cmFacturaGlosaBean.detalleServicioActual.fechaPrestacion}"/>
                                    </p:column>
                                </p:row>
                               
                            </p:panelGrid>
                        </p:panel>
                        <p:panel id="panelGestionGlosaItem" header="Conceptos Contables" style="margin-bottom:10px;" collapsed="false" toggleable="true">
                            <p:dataTable var="concepto" value="#{cmFacturaGlosaBean.registrosConceptoContable}" paginator="true" rows="#{cmFacturaGlosaBean.tamanoPagina}" 
                                         emptyMessage="No se encontraron registros"
                                         currentPageReportTemplate="Registros del {startRecord} al {endRecord} de {totalRecords}, Página {currentPage} de {totalPages}"
                                         paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                         rowsPerPageTemplate="5,10,30,50,100" id="tablaConceptos" lazy="false"
                                         widgetVar="tablaWidgetConceptos"
                                         style="font-size:11px;"
                                         rowKey="#{concepto.id}" >
                                <p:column  headerText="Concepto Contable" sortBy="#{concepto.maestroConceptos.id}">
                                    <h:outputText value="#{concepto.maestroConceptos.nombre}" title="#{concepto.maestroConceptos.nombre}"/>
                                </p:column>
                                <p:column  headerText="Centro Costo">
                                    <h:outputText value="#{concepto.maestroCentroCosto.nombre}" title="#{concepto.maestroCentroCosto.nombre}"/>
                                </p:column>
                                <p:column  headerText="Ubicación" sortBy="#{concepto.municipioAfiliado}">
                                    <h:outputText value="#{concepto.municipioAfiliado}" title="#{concepto.municipioAfiliado}"/>
                                </p:column>
                                <p:column  headerText="Porcentaje" sortBy="#{concepto.porcentaje}">
                                    <h:outputText value="#{concepto.porcentaje}" title="#{concepto.porcentaje}">
                                        <f:convertNumber locale="es_CO" currencySymbol="%" type="currency" maxFractionDigits="2"/>
                                    </h:outputText>
                                </p:column>   
                                <p:column  headerText="Auditoría" style="text-align: center;">
                                    <p:commandButton class="btnAuditoria" action="#{cmFacturaGlosaBean.getAuditoria(concepto.auditoriaStrHTML)}" icon="ui-icon-comment" title="Auditoría" />
                                </p:column>                              
                            </p:dataTable>
                        </p:panel>
                        <p:panel id="panelDiagnostico" header="Diagnóstico" style="margin-bottom:10px;" collapsed="false" toggleable="true">
                            <f:facet name="header">
                                <h:outputLabel value="Diagnóstico"></h:outputLabel>
                            </f:facet>
                            <p:panel id="pDiagnosticoCrear" header="Diagnósticos Opcionales" style="margin-bottom:10px;" collapsed="false" toggleable="true">        
                                <p:dataTable var="diagnostico" value="#{cmFacturaGlosaBean.registrosAuditoriaDiagnostico}" paginator="false" rows="#{cmFacturaGlosaBean.tamanoPagina}" 
                                             emptyMessage="No se encontraron registros"
                                             currentPageReportTemplate="Registros del {startRecord} al {endRecord} de {totalRecords}, Página {currentPage} de {totalPages}"
                                             paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                             rowsPerPageTemplate="5,10,30,50,100" id="tablaDiagnosticosCrear" lazy="false"
                                             widgetVar="tablaWidgetListaDiagnosticos"
                                             style="font-size:11px;"
                                             rowKey="#{diagnostico.id}" >
                                    <p:column headerText="Código">
                                        <h:outputText value="#{diagnostico.maDiagnosticoCodigo}" />
                                    </p:column>
                                    <p:column headerText="Nombre">
                                        <h:outputText value="#{diagnostico.maDiagnosticoValor}" />
                                    </p:column>
                                    <p:column headerText="Es principal">
                                        <h:outputText value="#{diagnostico.principalStr}" />
                                    </p:column>
                                    <p:column headerText="Auditoría" style="text-align: center;">
                                        <p:commandButton class="btnAuditoria" action="#{cmFacturaGlosaBean.getAuditoria(diagnostico.auditoriaStrHTML)}" icon="ui-icon-comment" title="Auditoría" />
                                    </p:column>
                                </p:dataTable>
                            </p:panel>
                        </p:panel>

                        <p:panel id="panelVerMotivos" header="Motivos" style="margin-bottom:10px;" collapsed="false" toggleable="true">  
                            <p:dataTable var="motivo" value="#{cmFacturaGlosaBean.registrosAuditoriaMotivoGlosa}" paginator="false" rows="#{cmFacturaGlosaBean.tamanoPagina}" 
                                         emptyMessage="No se encontraron registros"
                                         currentPageReportTemplate="Registros del {startRecord} al {endRecord} de {totalRecords}, Página {currentPage} de {totalPages}"
                                         paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                         rowsPerPageTemplate="5,10,30,50,100" id="tablaMotivos" lazy="false"
                                         widgetVar="tablaWidgetMotivos"
                                         style="font-size:11px;"
                                         rowKey="#{motivo.id}" >     
                                <p:column  headerText="Motivo glosa" sortBy="#{motivo.maestroMotivo.nombre}">
                                    <h:outputText value="#{motivo.maestroMotivo.nombre}" title="#{motivo.maestroMotivo.nombre}"/>
                                </p:column>
                                <p:column  headerText="Motivo específico" sortBy="#{motivo.maestroMotivoEspecifico.nombre}">
                                    <h:outputText value="#{motivo.maestroMotivoEspecifico.nombre}" title="#{motivo.maestroMotivoEspecifico.nombre}"/>
                                </p:column>
                                
                                <p:column  headerText="Motivo aplicación" sortBy="#{motivo.maestroMotivoAplicacion.nombre}">
                                    <h:outputText value="#{motivo.motivoAplicacionCorto}" title="#{motivo.motivoAplicacionCorto}"/>
                                    <p:commandButton rendered="#{motivo.esMotivoAplicacionExtenso}" actionListener="#{cmFacturaGlosaBean.mostrarMensaje(motivo.motivoAplicacionCompleto)}" icon="ui-icon-comment" title="Ver completo"/> 
                                </p:column>

                                <p:column  headerText="Tipología" sortBy="#{motivo.tipologia}">
                                    <h:outputText value="#{motivo.tipologiaStr}" title="#{motivo.tipologiaStr}"/>
                                </p:column>  

                                <p:column  headerText="Porcentaje" sortBy="#{motivo.porcentaje}">
                                    <h:outputText value="#{motivo.porcentaje}" title="#{motivo.porcentaje}">
                                        <f:convertNumber locale="es_CO" currencySymbol="%" type="currency" maxFractionDigits="2"/>
                                    </h:outputText>
                                </p:column>  

                                <p:column  headerText="Observación">
                                    <h:outputText value="#{motivo.observacionCorto}" title="#{motivo.observacionCorto}"/>
                                    <p:commandButton rendered="#{motivo.observacionCorto.length() > 0 }" actionListener="#{cmFacturaGlosaBean.mostrarMensaje(motivo.observacion)}" icon="ui-icon-comment" title="Ver completo"/> 
                                </p:column>

                                <p:column headerText="Auditoría" style="text-align: center;">
                                    <p:commandButton class="btnAuditoria" action="#{cmFacturaGlosaBean.getAuditoria(motivo.auditoriaStrHTML)}" icon="ui-icon-comment" title="Auditoría" />                               
                                </p:column>
                            </p:dataTable>
                        </p:panel>                        

                        <p:panel id="panelVerAutorizaciones" header="Autorización" style="margin-bottom:10px;" collapsed="false" toggleable="true">
                            <p:dataTable var="autorizacion" value="#{cmFacturaGlosaBean.registrosAuditoriaAutorizacion}" paginator="true" rows="#{cmFacturaGlosaBean.tamanoPagina}" 
                                         emptyMessage="No se encontraron registros"
                                         currentPageReportTemplate="Registros del {startRecord} al {endRecord} de {totalRecords}, Página {currentPage} de {totalPages}"
                                         paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                         rowsPerPageTemplate="5,10,30,50,100" id="tablaAutorizaciones" lazy="false"
                                         widgetVar="tablaWidgetAutorizacion"
                                         style="font-size:11px;"
                                         rowKey="#{autorizacion.id}" >

                                <p:column  headerText="Código servicio" sortBy="#{autorizacion.codigoServicio}">
                                    <h:outputText value="#{autorizacion.codigoServicio}" title="#{autorizacion.codigoServicio}"/>
                                </p:column>
                                <p:column  headerText="Número autorización" sortBy="#{autorizacion.numeroAutorizacion}">
                                    <h:outputText value="#{autorizacion.numeroAutorizacion}" title="#{autorizacion.numeroAutorizacion}"/>
                                </p:column>
                                <p:column  headerText="Nombre del servicio" sortBy="#{autorizacion.nombreServicio}">
                                    <h:outputText value="#{autorizacion.nombreServicio}" title="#{autorizacion.nombreServicio}"/>
                                </p:column>
                                <p:column  headerText="Id anexo 4" sortBy="#{autorizacion.anexo4.id}">
                                    <h:outputText value="#{autorizacion.anexo4.id}" title="#{autorizacion.anexo4.id}"/>
                                </p:column>
                                <p:column  headerText="Prestador" sortBy="#{autorizacion.razonSocialPrestador}" style="text-align: center">
                                    <h:outputText value="#{autorizacion.razonSocialPrestador}" title="#{autorizacion.razonSocialPrestador}"/>
                                </p:column>
                                <p:column  headerText="Nit Prestador" sortBy="#{autorizacion.nitPrestador}" style="text-align: center">
                                    <h:outputText value="#{autorizacion.nitPrestador}" title="#{autorizacion.nitPrestador}"/>
                                </p:column>
                                <p:column  headerText="Fecha Autorización" sortBy="#{autorizacion.fechaAutorizacion}">
                                    <h:outputText value="#{autorizacion.fechaAutorizacion}" title="#{autorizacion.fechaAutorizacion}"/>
                                </p:column>                                                          
                            </p:dataTable>
                        </p:panel>
                        
                        <p:panel id="panelVerContratos" header="Descuento Capita" style="margin-bottom:10px;" collapsed="false" toggleable="true">
                            <p:dataTable var="descuentoC" value="#{cmFacturaGlosaBean.registrosDescuentoCapita}" paginator="true" rows="#{cmFacturaGlosaBean.tamanoPagina}" 
                                         emptyMessage="No se encontraron registros"
                                         currentPageReportTemplate="Registros del {startRecord} al {endRecord} de {totalRecords}, Página {currentPage} de {totalPages}"
                                         paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                         rowsPerPageTemplate="5,10,30,50,100" id="tablaCapitaDescuento" lazy="false"
                                         widgetVar="tablaWidgetCapitaDescuento"
                                         style="font-size:11px;"
                                         rowKey="#{descuentoC.id}" >

                                <p:column  headerText="Número contrato" style="text-align: center">
                                    <h:outputText value="#{descuentoC.contrato}" title="#{descuentoC.contrato}"/>
                                </p:column>

                                <p:column  headerText="Nit" style="text-align: center">
                                    <h:outputText value="#{descuentoC.cntContrato.cntPrestador.numeroDocumento}" title="#{descuentoC.cntContrato.cntPrestador.numeroDocumento}"/>
                                </p:column>

                                <p:column  headerText="Razón social">
                                    <h:outputText value="#{descuentoC.cntContrato.cntPrestador.razonSocial}" title="#{descuentoC.cntContrato.cntPrestador.razonSocial}"/>
                                </p:column>

                                <p:column  headerText="Representante legal">
                                    <h:outputText value="#{descuentoC.cntContrato.cntPrestador.nombreRepresentanteLegal}" title="#{descuentoC.cntContrato.cntPrestador.nombreRepresentanteLegal}"/>
                                </p:column>

                                <p:column  headerText="Número documento prestador">
                                    <h:outputText value="#{descuentoC.cntContrato.cntPrestador.numeroDocumento}" title="#{descuentoC.cntContrato.cntPrestador.numeroDocumento}"/>
                                </p:column>
                                <p:column  headerText="Estado contrato" style="text-align: center">
                                    <h:outputText value="#{descuentoC.cntContrato.maeEstadoContratoValor}" title="#{descuentoC.cntContrato.maeEstadoContratoValor}"/>
                                </p:column>
                                <p:column  headerText="Marcación" style="text-align: center">
                                    <h:outputText value="#{descuentoC.marcacionStr}" title="#{descuentoC.cntContrato.diasLimitePago}"/>
                                </p:column>
                                <p:column  headerText="Fecha Inicio">
                                    <h:outputText value="#{descuentoC.cntContrato.fechaInicio}" title="#{descuentoC.cntContrato.fechaInicio}"/>
                                </p:column>
                                <p:column  headerText="Fecha Fin">
                                    <h:outputText value="#{descuentoC.cntContrato.fechaFin}" title="#{descuentoC.cntContrato.fechaFin}"/>
                                </p:column>
                                <p:column  headerText="Observación">
                                    <h:outputText value="#{descuentoC.observacionCorto}" />
                                    <p:commandButton rendered="#{descuentoC.observacionCorto.length() > 1 }" actionListener="#{cmFacturaGlosaBean.mostrarMensaje(descuentoC.observacion)}" icon="ui-icon-comment" title="Ver completo"/>
                                </p:column>
                            </p:dataTable>
                        </p:panel>

                        <p:panel widgetVar="panelVerAdjuntosCmDetalles" id="panelVerAdjuntosCmDetalles" header="Adjuntos Detalle" style="margin-bottom:10px;" collapsed="false" toggleable="true">
                            <p:dataTable id="tablaAdjuntosCmDetalles" var="adjunto" value="#{cmFacturaGlosaBean.registrosAuditoriaAdjutoCmDetalle}" widgetVar="tablaWidgetAdjuntosCmDetalles" scrollable="true" emptyMessage="No se encontraron registros">
                                <p:column headerText="Acciones" style="text-align: center;">
                                    <p:commandButton rendered="#{adjunto.id != null}" title="Descargar" ajax="false" onclick="PrimeFaces.monitorDownload(start, stop);" icon="ui-icon-arrowthickstop-1-s">
                                        <p:fileDownload value="#{cmFacturaGlosaBean.descargarAdjunto(adjunto)}" />
                                    </p:commandButton>  
                                </p:column>
                                <p:column headerText="Nombre">
                                    <h:outputText value="#{adjunto.archivoNombre}"/>
                                </p:column>
                                <p:column headerText="Tipo"  style="text-align: center;">
                                    <h:outputText value="#{adjunto.tipoStr}"/>
                                </p:column>
                                <p:column headerText="Usuario">
                                    <h:outputText value="#{adjunto.usuarioCrea}"/>
                                </p:column>
                                <p:column headerText="F.H. Crea"  style="text-align: center;">
                                    <h:outputText value="#{adjunto.fechaHoraCrea}">
                                        <f:convertDateTime type="date" pattern="yyyy-MM-dd HH:mm:ss" timeZone="America/Bogota"/>
                                    </h:outputText>
                                </p:column>
                            </p:dataTable>
                        </p:panel>

                        <p:panelGrid  style="width:100%;margin:10px 0px">
                            <f:facet name="footer">
                                <p:row>
                                    <p:column colspan="4" style="text-align: center">
                                        <p:commandButton value="Cerrar" type="button" onclick="PF('dialogoVerAuditoriaServicio').hide()" immediate="true" style="margin-left: 5px;"/>
                                    </p:column>
                                </p:row>
                            </f:facet>
                        </p:panelGrid>
                    </h:form>
                </p:scrollPanel>
            </p:dialog>
            
             <p:dialog widgetVar="dialogoVerNota" header="Información Nota" appendTo="@(body)"  modal="true" width="70%">             
                 <h:form class="frmAuditoria" style="margin-top: -15px; text-align: right;">
                    <p:commandButton id="auditoria" class="btnAuditoria" action="#{cmFacturaGlosaBean.getAuditoria(cmFacturaGlosaBean.objeto.cmFeNota.auditoriaStrHTML)}" icon="ui-icon-comment" title="Auditoría" />
                </h:form>              
                 <h:form id="frmVerNota" style="padding: 10px;">
                        <p:panelGrid id="panelFactura" columns="4" layout="grid" style="padding: 5px;" >
                            <p:row>
                                <p:column styleClass="ui-widget-header ui-g-3">
                                    <p:outputLabel value="Número Nota"  style="font-weight:bold"/>
                                </p:column>
                                <p:column styleClass=" ui-g-3" >
                                    <h:outputText value="#{cmFacturaGlosaBean.objeto.cmFeNota.numeroNota}"/>
                                </p:column>
                                <p:column styleClass="ui-widget-header ui-g-3">
                                    <p:outputLabel value="Valor Nota" style="font-weight:bold" />
                                </p:column>
                                <p:column styleClass=" ui-g-3" >
                                    <h:outputText value="#{cmFacturaGlosaBean.objeto.cmFeNota.valorNota}" title="#{cmFacturaGlosaBean.objeto.cmFeNota.valorNota}">
                                        <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="4"/>
                                    </h:outputText>
                                </p:column>
                            </p:row>
                                 <p:row>
                                <p:column styleClass="ui-widget-header ui-g-3">
                                    <p:outputLabel value="Fecha Nota"  style="font-weight:bold"/>
                                </p:column>
                                <p:column styleClass=" ui-g-3" >
                                    <h:outputText value="#{cmFacturaGlosaBean.objeto.cmFeNota.fechaHoraEmision}"/>
                                </p:column>
                                <p:column styleClass="ui-widget-header ui-g-3">
                                    <p:outputLabel value="Tipo Nota" style="font-weight:bold" />
                                </p:column>
                                <p:column styleClass=" ui-g-3" >
                                    <h:outputText value="#{cmFacturaGlosaBean.objeto.cmFeNota.tipoStr}"/>
                                </p:column>
                            </p:row>
                            
                             <p:row>
                                <p:column styleClass="ui-widget-header ui-g-3">
                                    <p:outputLabel value="Cude"  style="font-weight:bold"/>
                                </p:column>
                                <p:column styleClass=" ui-g-9" >
                                    <h:outputText value="#{cmFacturaGlosaBean.objeto.cmFeNota.cude}"/>
                                </p:column>
                            </p:row>
                            
                            <p:row>
                                <p:column styleClass="ui-widget-header ui-g-3">
                                    <p:outputLabel value="Número Factura"  style="font-weight:bold"/>
                                </p:column>
                                <p:column styleClass=" ui-g-3" style="color:#045491;font-weight:bold">
                                    <h:outputText value="#{cmFacturaGlosaBean.objeto.numeroFacturado}"/>
                                </p:column>
                            </p:row>

                        </p:panelGrid>     
                               
                        <p:panelGrid  style="width:100%;margin:10px 0px">
                            <f:facet name="footer">
                                <p:row>
                                    <p:column colspan="4" style="text-align: center">
                                        <p:commandButton value="Cerrar" type="button" onclick="PF('dialogoVerNota').hide()" immediate="true" style="margin-left: 5px;"/>
                                    </p:column>
                                </p:row>
                            </f:facet>
                        </p:panelGrid>
                    </h:form>
            </p:dialog>

            <body onunload="finalizar();"> 
            <h:form id="exit">
                <p:remoteCommand  id="finalizar" name="finalizar" action="#{cmFacturaGlosaBean.clearViewScopedBeans()}"/>
            </h:form>
            </body>    
        </center>
    </ui:define>
</ui:composition>
