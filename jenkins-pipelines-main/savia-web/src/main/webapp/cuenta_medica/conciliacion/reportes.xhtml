<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<ui:composition template="/home.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui">
    <ui:define name="bodyJR"> 

        <center>  
              <style>
            .ui-panelgrid .ui-grid-responsive .ui-panelgrid-cell {
                border: 1px solid #e5e2e2;
            }
            
        </style>
            <h:form id="frmReportes">
                <p:toolbar>
                    <f:facet name="left" >
                        <span title="#{reporteCuentasMedicasBean.modulo.descripcion}">#{reporteCuentasMedicasBean.modulo.nombre}</span>
                    </f:facet>
                    <f:facet name="right">
                        <p:remoteCommand name="abrirVentanaGeneracionReporte" action="#{reporteCuentasMedicasBean.verGeneracionInforme}" />
                        <p:commandButton rendered="#{reporteCuentasMedicasBean.accionCrear}" title="Generar Reporte"  onmouseup="abrirVentanaGeneracionReporte();" icon="ui-icon-circle-arrow-n"/>
                        <p:commandButton rendered="#{reporteCuentasMedicasBean.accionListar}" title="Refrescar" ajax="false" actionListener="#{reporteCuentasMedicasBean.refrescar()}" icon="ui-icon-refresh"/>
                    </f:facet>
                </p:toolbar>      
            </h:form>
            <p:panel id="panelConsultaInformes" header="Consulta Informes Cuentas Médicas" style="margin-bottom:10px;">
                <h:form id="frmConsultaInformes">
                    <p:dataTable var="obj" value="#{reporteCuentasMedicasBean.lazyInformes}" paginator="true" rows="15" 
                                 emptyMessage="No se encontraron registros"
                                 currentPageReportTemplate="Registros del {startRecord} al {endRecord} de {totalRecords}, Página {currentPage} de {totalPages}"
                                 paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                 rowsPerPageTemplate="15,30,50,100" id="tablaRegistros" lazy="true"
                                 widgetVar="tablaWidgetInformes"
                                 style="font-size:11px;"
                                 rowKey="#{obj.id}" reflow="true">

                        <p:column style="text-align: center;" width="80" >
                            <f:facet name="header">
                                <h:outputText value="Acciones"/>
                            </f:facet>    
                            <p:commandButton rendered="#{reporteCuentasMedicasBean.accionAdicional1}" title="Descargar" disabled="#{reporteCuentasMedicasBean.habilitarDescarga(obj)}" ajax="true" onclick="PrimeFaces.monitorDownload(start, stop);" icon="ui-icon-circle-arrow-s">
                                <p:fileDownload value="#{reporteCuentasMedicasBean.generarArchivoReporte(obj)}" />
                            </p:commandButton>
                            <p:commandButton rendered="#{reporteCuentasMedicasBean.accionAdicional1 and reporteCuentasMedicasBean.validarEstadoError(obj.estado)}" title="Ver Error" actionListener="#{reporteCuentasMedicasBean.verMensajeGeneral(obj.observacion)}" icon="ui-icon-search">
                            </p:commandButton>
                        </p:column>

                        <p:column headerText="Tipo" sortBy="#{obj.tipo}" filterBy="#{obj.tipo}">   
                            <f:facet name="filter">
                                <p:selectOneMenu onchange="PF('tablaWidgetInformes').filter()">
                                    <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />
                                    <f:selectItem itemLabel="Informe Motivos" itemValue="0" />
                                    <f:selectItem itemLabel="Informe Respuesta Detalles " itemValue="1" />
                                    <f:selectItem itemLabel="Informe Detalles Sin Respuesta" itemValue="2" />
                                    <f:selectItem itemLabel="Informe Respuesta Por Detalles" itemValue="3" />
                                    <f:selectItem itemLabel="Informe Auditoria" itemValue="4" />
                                    <f:selectItem itemLabel="Informe General Facturas CM" itemValue="5" />	
                                    <f:selectItem itemLabel="Informe General Detalles CM" itemValue="6" />	
                                    <f:selectItem itemLabel="Informe Devolucion Factura" itemValue="7" />
                                    <f:selectItem itemLabel="Informe Facturas Conciliadas" itemValue="8" />
                                    <f:selectItem itemLabel="Informe Facturas Rechazadas" itemValue="9" />
                                    <f:selectItem itemLabel="Informe Descuento Capita" itemValue="10" />
                                </p:selectOneMenu>
                            </f:facet>
                            <h:outputText value="#{obj.tipoStr}" title="#{obj.tipoStr}"/>
                        </p:column>

                        <p:column headerText="Archivo">
                            <h:outputText value="#{obj.archivo}" title="#{obj.archivo}"/>
                        </p:column>

                        <p:column headerText="Estado" sortBy="#{obj.estado}" filterBy="#{obj.estado}">
                            <f:facet name="filter">
                                <p:selectOneMenu onchange="PF('tablaWidgetInformes').filter()">
                                    <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />
                                    <f:selectItem itemLabel="En proceso" itemValue="0" />
                                    <f:selectItem itemLabel="Error" itemValue="3" />
                                    <f:selectItem itemLabel="Finalizado" itemValue="1" />
                                </p:selectOneMenu>
                            </f:facet>
                            <h:outputText value="#{obj.estadoStr}"/>
                        </p:column>

                        <p:column headerText="Fecha Solicitud" sortBy="#{obj.fechaHoraInicio}">
                            <h:outputText value="#{obj.fechaHoraInicio}" title="#{obj.fechaHoraInicio}"/>
                        </p:column>

                        <p:column headerText="Registros" width="80">
                            <h:outputText value="#{obj.registros}" title="#{obj.registros}"/>
                        </p:column>

                        <p:column headerText="Usuario Crea" sortBy="#{obj.usuarioCrea}">
                            <h:outputText value="#{obj.usuarioCrea}" title="#{obj.usuarioCrea}"/>
                        </p:column>

                    </p:dataTable>
                </h:form>
            </p:panel>
            <p:dialog header="Generar Reporte" id="dialogoGenerarReporte" widgetVar="dialogoGenerarReporte" appendTo="@(body)" modal="true" dynamic="true">
                <p:scrollPanel mode="native" style="height:300px">
                    <h:form id="frmGenerarReporte">
                        <p:panelGrid id="panelBuscarReportes" columns="2" layout="grid" styleClass="showcase-text-align-center">

                            <p:outputLabel value="Tipo de reporte" for="tipoInforme" />
                            <p:selectOneMenu id="tipoInforme" label="Tipos Informes" value="#{reporteCuentasMedicasBean.objeto.tipo}" style="width: 200px;" editable="false" required="true" requiredMessage="Tipo de reporte : Este campo es obligatorio.">
                                <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />  
                                <f:selectItem itemLabel="Informe Motivos" itemValue="0" />
                                <f:selectItem itemLabel="Informe Respuesta Detalles" itemValue="1" />
                                <f:selectItem itemLabel="Informe Detalles Sin Respuesta" itemValue="2" />
                                <f:selectItem itemLabel="Informe Respuesta Por Detalles" itemValue="3" />
                                <f:selectItem itemLabel="Informe Auditoria" itemValue="4" />
                                <f:selectItem itemLabel="Informe General Facturas CM" itemValue="5" />	
                                <f:selectItem itemLabel="Informe General Detalles CM" itemValue="6" />	
                                <f:selectItem itemLabel="Informe Devolucion Factura" itemValue="7" />
                                <f:selectItem itemLabel="Informe Facturas Conciliadas" itemValue="8" />
                                <f:selectItem itemLabel="Informe Facturas Rechazadas" itemValue="9" />
                                <f:selectItem itemLabel="Informe Descuento Capita" itemValue="10" />
                                <p:ajax event="change" update="frmGenerarReporte:panelBuscarReportes" listener="#{reporteCuentasMedicasBean.mostrarFormularioSegunTipoReporte()}" />
                            </p:selectOneMenu>

                            <p:outputLabel value="Fecha Radicación Inicial" for="fechaInicialRadicado" style="font-weight:bold"/>
                            <p:calendar id="fechaInicialRadicado" yearRange="c-100:c" label="Fecha Inicial" navigator="true" pattern="yyyy-MM-dd"  value="#{reporteCuentasMedicasBean.objeto.fechaDesde}" size="7" maxlength="10" required="true" requiredMessage="Fecha Radicación Inicial : Este campo es obligatorio."></p:calendar>     

                            <p:outputLabel value="Fecha Radicación Final" for="fechaFinalRadicado" style="font-weight:bold"/>
                            <p:calendar id="fechaFinalRadicado" yearRange="c-100:c" label="Fecha Final" navigator="true" pattern="yyyy-MM-dd"  value="#{reporteCuentasMedicasBean.objeto.fechaHasta}" size="7" maxlength="10" required="true" requiredMessage="Fecha Radicación Final : Este campo es obligatorio."></p:calendar>     

                            <p:outputLabel value="Nit" for="nitMotivo" style="font-weight:bold"/>
                            <p:inputText id="nitMotivo" label="Nit" value="#{reporteCuentasMedicasBean.objeto.nit}"
                                         maxlength="13"  >
                            </p:inputText> 

                            <p:outputLabel value="IPS" for="ipsMotivo" style="font-weight:bold"/>
                            <p:inputText id="ipsMotivo" label="IPS" value="#{reporteCuentasMedicasBean.objeto.ips}"
                                         maxlength="200" >
                            </p:inputText>                             


                            <f:facet name="footer">
                                <p:row>
                                    <p:column colspan="4" style="text-align: center">
                                        <p:commandButton action="#{reporteCuentasMedicasBean.generarReporte()}"
                                                         icon="ui-icon-document-b" 
                                                         value="Generar">
                                        </p:commandButton>
                                        <p:commandButton process="@this" value="Cancelar" action="#{reporteCuentasMedicasBean.limpiarFormularioBusqueda()}" immediate="true" style="margin-left: 5px;"/>
                                    </p:column>
                                </p:row>
                            </f:facet>
                        </p:panelGrid>  
                        <p:panelGrid style="width:100%;margin:10px 0px">
                            <f:facet name="footer">
                                <p:row>
                                    <p:column style="text-align: center">
                                        <p:commandButton value="Salir" type="button" onclick="PF('dialogoGenerarReporte').hide()" immediate="true"/>
                                    </p:column>
                                </p:row>
                            </f:facet>
                        </p:panelGrid>
                    </h:form>
                </p:scrollPanel>
            </p:dialog>

            <p:dialog header="Mensaje" widgetVar="dlgGeneral" minHeight="200" appendTo="@(body)" modal="true"  width="90%" dynamic="true">           
                <p:scrollPanel mode="native" style="height:200px">
                    <h:form id="frmGeneral" style="padding: 10px;">
                        <p:inputTextarea style="width: 100%;" value="#{reporteCuentasMedicasBean.mensajeGeneral}"/>
                        <p:panelGrid  style="width:100%;margin:10px 0px">
                            <f:facet name="footer">
                                <p:row>
                                    <p:column style="text-align: center">
                                        <h:panelGroup style="display:block; text-align:center;">
                                            <p:commandButton value="Salir" type="button" onclick="PF('dlgGeneral').hide()" immediate="true"/>
                                        </h:panelGroup>
                                    </p:column>
                                </p:row>
                            </f:facet>
                        </p:panelGrid>
                    </h:form>
                </p:scrollPanel>
            </p:dialog>
            <body onunload="finalizar();"> 
            <h:form id="exit">
                <p:remoteCommand  id="finalizar" name="finalizar" action="#{reporteCuentasMedicasBean.clearViewScopedBeans()}"/>
            </h:form>
            </body>
        </center>
    </ui:define>
</ui:composition>
