<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<ui:composition template="/home.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui">
    <ui:define name="bodyJR">
        <center>
            <style>
                .ui-panelgrid .ui-grid-responsive .ui-panelgrid-cell {
                    border: 1px solid #e5e2e2;
                }

                .ui-panelgrid .ui-panelgrid-footer {
                    text-align: center;
                    padding: 2px 5px;
                }
                
                .backgroud_label{
                    text-align: left;
                    background:#f5f5f5;
                }
            </style>
            <h:form id="frmFacturasUsuario" >
                <p:toolbar>
                    <f:facet name="left" >
                        <span title="#{cmFacturasUsuarioBean.modulo.descripcion}">#{cmFacturasUsuarioBean.modulo.nombre}</span>
                    </f:facet>
                    <f:facet name="right">
                        <p:commandButton  title="Limpiar" ajax="false" actionListener="#{cmFacturasUsuarioBean.limpiarFormulario}" icon="ui-icon-refresh"/>
                    </f:facet>
                </p:toolbar>
                <p:panelGrid id="panelFecha" columns="1">
                    <p:panel header="Búsqueda Factura ( Documento - Autorización )" toggleable="true"  closable="false" style="height:auto; position:upper; width: 70%; margin: 0 auto;">                               
                        <p:panelGrid id="panelBusquedaCedula" columns="4"
                                     columnClasses="ui-grid-col-2,ui-grid-col-4,ui-grid-col-2,ui-grid-col-4"
                                     layout="grid"
                                     styleClass="ui-panelgrid-blank ui-fluid">
                                                       
                            <p:row>
                                <p:column class="ui-g-3 backgroud_label">
                                    <p:outputLabel value="Tipo Documento" for="tipoDocumento" style="font-weight:bold"/>
                                </p:column>
                                <p:column class="ui-g-3">
                                    <p:selectOneMenu id="tipoDocumento" label="Tipo Documento" value="#{cmFacturasUsuarioBean.maeTipoDocumento}" 
                                                     editable="fase" style="width: 100%;" requiredMessage="Tipo Documento : Este campo es obligatorio.">
                                        <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />
                                        <f:selectItems value="#{cmFacturasUsuarioBean.listaTiposDocumento}" var="TIPO_DOCUMENTO" itemValue="#{TIPO_DOCUMENTO.id}" itemLabel="#{TIPO_DOCUMENTO.nombre}" itemDescription="#{TIPO_DOCUMENTO.descripcion}" />
                                    </p:selectOneMenu>

                                </p:column>
                                <p:column class="ui-g-3 backgroud_label">
                                    <p:outputLabel value="Documento" for="numeroDocumento" style="font-weight:bold"/>
                                </p:column>
                                <p:column class="ui-g-3">
                                    <p:inputNumber id="numeroDocumento" 
                                                   value="#{cmFacturasUsuarioBean.numeroDocumento}" thousandSeparator="" decimalPlaces="0"/>
                                </p:column>
                            </p:row>
                            <p:row>
                                <p:column class="ui-g-3 backgroud_label">
                                    <p:outputLabel value="Autorización" for="autorizacion" style="font-weight:bold"/>
                                </p:column>
                                 <p:column class="ui-g-3">
                                     <p:inputNumber id="autorizacion" 
                                                    value="#{cmFacturasUsuarioBean.numeroAutorizacion}" thousandSeparator="" decimalPlaces="0" maxValue="999999999"/>
                                </p:column>
                            </p:row>
                            
                        </p:panelGrid>
                        <div align="center" style="margin-top: 10px;">
                            <p:commandButton value="Buscar" 
                                             action="#{cmFacturasUsuarioBean.buscarFacturas()}" />
                            <p:spacer width="10" height="0"/>
                            <p:commandButton value="Cancelar"
                                             immediate="true">
                                <p:ajax listener="#{cmFacturasUsuarioBean.limpiarFormulario()}" update="frmFacturasUsuario"/>
                            </p:commandButton>
                        </div>
                    </p:panel>
                </p:panelGrid>

                <p:spacer height="10"/>
                <p:panel id="panelConsultaFactura" header="Facturas" style="margin-bottom:10px;" toggleable="true" rendered="#{cmFacturasUsuarioBean.hayBusquedaValida}">

                    <p:dataTable var="facturaDetalleUsuario" value="#{cmFacturasUsuarioBean.lazyDetalles}" 
                                 paginator="true" rows="#{cmFacturasUsuarioBean.tamanoPagina}"
                                 emptyMessage="No se encontraron registros"
                                 currentPageReportTemplate="Registros del {startRecord} al {endRecord} de {totalRecords}, Página {currentPage} de {totalPages}"
                                 paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                 rowsPerPageTemplate="10,20,30,50" lazy="true"
                                 widgetVar="tablaWidgetFacturasUsuario"
                                 id="tablaFacturasUsuario" 
                                 rowIndexVar="rowIndex"
                                 style="font-size:12px;"
                                 rowKey="#{facturaDetalleUsuario.id}" reflow="true">

                        <p:column headerText="Nombre Afiliado" style="text-align: center;">   
                            <h:outputText value="#{facturaDetalleUsuario.nombreCompletoAfiliado}"/>
                        </p:column>
                        <p:column headerText="Tipo Documento" style="text-align: center;">   
                            <h:outputText value="#{facturaDetalleUsuario.maeTipoDocumentoValor}"/>
                        </p:column>
                        <p:column headerText="Documento" style="text-align: center;">   
                            <h:outputText value="#{facturaDetalleUsuario.documento}"/>
                        </p:column>
                        <p:column headerText="Autorización" style="text-align: center;">   
                            <h:outputText value="#{facturaDetalleUsuario.numeroAutorizacion == null ? '' : facturaDetalleUsuario.numeroAutorizacion }"/>
                        </p:column>
                        <p:column headerText="Radicado" style="text-align: center;">   
                            <h:outputText value="#{facturaDetalleUsuario.cmFacturas.numeroRadicado}"/>
                        </p:column>
                        <p:column  headerText="Número Facturado" style="text-align: center;">
                            <h:outputText value="#{facturaDetalleUsuario.cmFacturas.numeroFacturado}"/>
                        </p:column>
                        <p:column  headerText="Nit" style="text-align: center;">
                            <h:outputText value="#{facturaDetalleUsuario.cmFacturas.nit}"/>
                        </p:column>
                        <p:column  headerText="Ips" style="text-align: center;">
                            <h:outputText value="#{facturaDetalleUsuario.cmFacturas.ips}"/>
                        </p:column>
                        <p:column  headerText="Fecha Radicación"  style="text-align: center">
                            <h:outputText value="#{facturaDetalleUsuario.cmFacturas.fechaRadicacion}"/>
                        </p:column>
                        <p:column  headerText="Valor Factura" style="text-align: center;">
                            <h:outputText value="#{facturaDetalleUsuario.cmFacturas.valorFactura}" title="#{facturaDetalleUsuario.cmFacturas.valorFactura}">
                                <f:convertNumber locale="es_CO" currencySymbol="$" type="currency" maxFractionDigits="2"/>
                            </h:outputText>
                        </p:column>
                        <p:column  headerText="Modalidad Contrato" style="text-align: center; ">
                            <h:outputText value="#{facturaDetalleUsuario.cmFacturas.maeTipoContratoValor}" style="text-transform: uppercase"/>
                        </p:column>
                        <p:column  headerText="Estado Factura" style="text-align: center;">
                            <h:outputText value="#{facturaDetalleUsuario.cmFacturas.estadoFacturaStr}" style="text-transform: uppercase"/>
                        </p:column>
                    </p:dataTable>
                </p:panel>
            </h:form>
        </center>
    </ui:define>
</ui:composition>
