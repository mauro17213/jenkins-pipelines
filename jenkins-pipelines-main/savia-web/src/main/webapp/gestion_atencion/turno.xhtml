<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<ui:composition template="/home.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui">
    <ui:define name="bodyJR">
        <h:outputScript name="js/calendar-localization.js"/>
        <h:outputScript name="js/ticket.js"/>
        <h:outputStylesheet name="css/solicitudes.css"/>
        <h:outputStylesheet name="css/gp.css"/>
        <h:outputStylesheet name="css/gestionAtencion.css"/>
        <center>
            <h:form id="frmTurnos" prependId="false" >
                <p:toolbar>
                    <f:facet name="left" >
                        <span title="#{gatTurnoBean.modulo.descripcion}">#{gatTurnoBean.modulo.nombre}</span>
                    </f:facet>
                    <f:facet name="right">
                        <p:commandButton rendered="#{gatTurnoBean.accionListar}" title="Refrescar" ajax="false" actionListener="#{gatTurnoBean.refrescar()}" icon="ui-icon-refresh"/>
                        <p:commandButton rendered="#{gatTurnoBean.accionCrear}" title="Crear Turno" actionListener="#{gatTurnoBean.crear()}"  icon="ui-icon-document" update="@form"/>
                        <p:commandButton rendered="#{gatTurnoBean.accionListar}" title="Cambiar Sede" actionListener="#{gatTurnoBean.cambiarSede()}" icon="ui-icon-shuffle"/>
                        <p:inputText id="ctnReporTicket" value="#{gatTurnoBean.reporteTicketString}" style="display: none;" />
                    </f:facet>
                </p:toolbar>
                <div style="text-align: left !important">
                    <p><b>Sede:</b> #{gatTurnoBean.objetoSede.nombre}</p>
                </div>
                <p:dataTable var="obj" value="#{gatTurnoBean.lazyTiquetes}" paginator="true" rows="#{gatTurnoBean.tamanoPagina}" 
                             emptyMessage="No se encontraron registros"
                             currentPageReportTemplate="Registros del {startRecord} al {endRecord} de {totalRecords}, PÃ¡gina {currentPage} de {totalPages}"
                             paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             rowsPerPageTemplate="5,10,30,50,100" id="tablaRegistros" lazy="true"
                             widgetVar="tablaWidget"
                             rowKey="#{obj.id}" reflow="true" draggableRows="false">

                    <p:column headerText="Acciones" style="width: 50px; text-align: center;" rendered="#{gatTurnoBean.accionAdicional1}">
                        <p:commandButton rendered="#{gatTurnoBean.accionAdicional1}" title="Reimprimir" actionListener="#{gatTurnoBean.reIprimirTicket(obj.numero,obj.maeTipoServicioValor)}"  icon="ui-icon-document" update="@form"/>
                    </p:column>


                    <p:column headerText="Numero" filterBy="#{obj.numero}">
                        <f:facet name="filter">
                            <p:inputText label="numero" maxlength="64" style="width: 80%;" onchange="PF('tablaWidget').filter()"/>
                        </f:facet>
                        <h:outputText value="#{obj.numero}"/>
                    </p:column>

                    <p:column headerText="Usuario">
                        <h:outputText value="#{obj.gatUsuario.nombreCompleto}"/>
                    </p:column>

                    <p:column headerText="Prioritario">
                        <h:outputText value="#{obj.prioritarioStr}"/>
                    </p:column>

                    <p:column headerText="Tipo Servicio" filterBy="#{obj.maeTipoServicio}">
                        <f:facet name="filter">
                            <p:selectOneMenu onchange="PF('tablaWidget').filter()" style="width: 80%;">
                                <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />
                                <f:selectItems value="#{gatTurnoBean.listaServicios}" var="serv" itemValue="#{serv.id}" itemLabel="#{serv.nombre}" />
                            </p:selectOneMenu>
                        </f:facet>
                        <h:outputText value="#{obj.maeTipoServicioValor}"/>
                    </p:column>

                    <p:column headerText="Fecha Hora Crea" sortBy="#{obj.fechaHoraCrea}">
                        <h:outputText value="#{obj.fechaHoraCrea}">
                            <f:convertDateTime type="date" pattern="yyyy-MM-dd HH:mm:ss" timeZone="America/Bogota" />
                        </h:outputText>
                    </p:column>
                </p:dataTable>
            </h:form>

            <!-- Crear -->
            <p:dialog header="Crear" widgetVar="dialogoCrear" appendTo="@(body)" modal="true"  width="90%" dynamic="true">
                <p:scrollPanel mode="native" style="height:400px">
                    <h:form id="frmCrear">
                        <!-- Servicios -->
                        <p:panel id="pTurnoServicios" header="Servicios" style="margin-bottom:10px;" collapsed="false" toggleable="true">
                            <p:panelGrid id="panelTurnoServicio" columns="2" layout="grid" styleClass="showcase-text-align-center">

                                <h:outputText value="Tipo Servicio"   class="header-back"/>
                                <p:selectOneMenu id="tipoServicioTurno" value="#{gatTurnoBean.objeto.maeTipoServicio}" filter="true" required="true" requiredMessage="Tipo Servicio : Este campo no es obligatorio" >
                                    <f:selectItem value="#{null}" itemLabel=" -- " noSelectionOption="true" />
                                    <f:selectItems value="#{gatTurnoBean.listaServicios}" var="tipoServ" itemValue="#{tipoServ.id}" itemLabel="#{tipoServ.nombre}" />
                                    <p:ajax event="change" update="frmCrear" />
                                </p:selectOneMenu>

                            </p:panelGrid>
                        </p:panel>
                        <!-- Busqueda -->
                        <p:panel id="pCrear" header="Busqueda" style="margin-bottom:10px;" collapsed="false" toggleable="true" rendered="#{gatTurnoBean.configuracion.isTurneroNormal()}">
                            <p:panelGrid id="panelCrear" columns="2" layout="grid" styleClass="showcase-text-align-center">

                                <h:outputText value="Tipo Documento"   class="header-back" />
                                <p:selectOneMenu id="tipoDocumentoCrear" value="#{gatTurnoBean.objeto.gatUsuario.maeTipoDocumentoId}" filter="true"  requiredMessage="Tipo Documento : Este campo no es obligatorio" >
                                    <f:selectItem value="#{null}" itemLabel=" -- " noSelectionOption="true" />
                                    <f:selectItems value="#{gatTurnoBean.listaTipoDocumentos}" var="tipoDoc" itemValue="#{tipoDoc.id}" itemLabel="#{tipoDoc.nombre}" />
                                    <p:ajax event="change" listener="#{gatTurnoBean.buscarAfiliado()}" />
                                </p:selectOneMenu>

                                <h:outputText value="Documento"   class="header-back"/>
                                <p:inputText id="documentoCrear" value="#{gatTurnoBean.objeto.gatUsuario.numeroDocumento}"  requiredMessage="Documento : Este campo es obligatorio" >
                                    <p:ajax event="change" listener="#{gatTurnoBean.buscarAfiliado()}" />
                                </p:inputText>

                            </p:panelGrid>
                        </p:panel>
                        <!-- Datos -->
                        <p:panel id="pDatosCrear" header="Datos" style="margin-bottom:10px;" collapsed="false" toggleable="true">
                            <p:panelGrid id="panelDatosCrear" columns="4"
                                         columnClasses="ui-grid-col-2,ui-grid-col-4,ui-grid-col-2,ui-grid-col-4"
                                         layout="grid"
                                         styleClass="ui-panelgrid-blank ui-fluid" >

                                <h:outputText value="Nombres"  class="header-back" rendered="#{gatTurnoBean.configuracion.isTurneroNormal()}" />
                                <p:inputText id="nombreTurnoDatos" value="#{gatTurnoBean.objeto.gatUsuario.nombres}" readonly="#{gatTurnoBean.objeto.afiliado}"
                                             required="#{!gatTurnoBean.objeto.afiliado}" requiredMessage="Los nombres : Este campo es obligatorio" 
                                             rendered="#{gatTurnoBean.configuracion.isTurneroNormal()}" />

                                <h:outputText value="Apellidos"  class="header-back" rendered="#{gatTurnoBean.configuracion.isTurneroNormal()}" />
                                <p:inputText id="apellidoTurnoDatos" value="#{gatTurnoBean.objeto.gatUsuario.apellidos}" readonly="#{gatTurnoBean.objeto.afiliado}" required="#{!gatTurnoBean.objeto.afiliado}" 
                                             requiredMessage="Los apellidos : Este campo es obligatorio" rendered="#{gatTurnoBean.configuracion.isTurneroNormal()}" />

                                <h:outputText value="Fecha Nacimiento"   class="header-back" rendered="#{gatTurnoBean.configuracion.isTurneroNormal()}" />
                                <p:calendar id="fechaNacimientoTurno" value="#{gatTurnoBean.objeto.gatUsuario.fechaNacimiento}" navigator="true" yearRange="c-100:c" 
                                            maxdate="#{gatTurnoBean.fechaMaxima}" readonly="#{gatTurnoBean.objeto.afiliado}" pattern="yyyy-MM-dd" locale="es" 
                                            rendered="#{gatTurnoBean.configuracion.isTurneroNormal()}"/>

                                <h:outputText value="Prioritario"   class="header-back"/>
                                <p:inputSwitch id="prioritarioTurno" value="#{gatTurnoBean.objeto.prioritario}" onLabel="Si" offLabel="No" />

                            </p:panelGrid>
                        </p:panel>
                        <!--Acciones-->
                        <p:panelGrid id="panelAccionesCrear" style="width:100%;margin:10px 0px">
                            <f:facet name="footer">
                                <p:row>
                                    <p:column colspan="6" style="text-align: center">                                        
                                        <p:commandButton value="Guardar" type="button" onclick="guardarRemote()" validateClient="true"/>
                                        <p:remoteCommand name="guardarRemote" action ="#{gatTurnoBean.guardar}" update="frmCrear"/>
                                        <p:commandButton value="Cancelar" type="button" onclick="PF('dialogoCrear').hide()" immediate="true" style="margin-left: 5px;"/>
                                    </p:column>
                                </p:row>
                            </f:facet>
                        </p:panelGrid>
                    </h:form>
                </p:scrollPanel>
            </p:dialog>

            <!-- Lista Sedes -->
            <p:dialog header="Sedes" widgetVar="dialogoSede" appendTo="@(body)" modal="true"  width="50%" dynamic="true" closable="false">
                <h:form id="frmSede">
                    <p:panel id="pSede" header="Sedes" style="margin-bottom:10px;" collapsed="false" toggleable="true">
                        <p:panelGrid id="panelSede" columns="2" layout="grid" styleClass="showcase-text-align-center">

                            <h:outputText value="Sede" class="header-back"/>
                            <p:selectOneMenu id="sede" value="#{gatTurnoBean.objetoSede.id}" filter="true" required="true" requiredMessage="La sede : Este campo es obligatorio" >
                                <f:selectItem value="#{null}" itemLabel=" -- " noSelectionOption="true" />
                                <f:selectItems value="#{gatTurnoBean.listaSedes}" var="sede" itemValue="#{sede.id}" itemLabel="#{sede.nombre}" />
                                <p:ajax event="change" listener="#{gatTurnoBean.buscarSede()}" />
                            </p:selectOneMenu>

                        </p:panelGrid>
                    </p:panel>
                    <!--Acciones-->
                    <p:panelGrid id="panelAccionesCrear" style="width:100%;margin:10px 0px">
                        <f:facet name="footer">
                            <p:row>
                                <p:column colspan="6" style="text-align: center">                                        
                                    <p:commandButton value="Guardar" type="button" onclick="guardarRemote()" validateClient="true"/>
                                    <p:remoteCommand name="guardarRemote" action ="#{gatTurnoBean.seleccionar}" update="frmSede"/>
                                    <p:commandButton value="Salir" action="#{gatTurnoBean.salir()}" immediate="true" style="margin-left: 5px;"/>
                                </p:column>
                            </p:row>
                        </f:facet>
                    </p:panelGrid>
                </h:form>
            </p:dialog>         

        </center>
    </ui:define>
</ui:composition>
