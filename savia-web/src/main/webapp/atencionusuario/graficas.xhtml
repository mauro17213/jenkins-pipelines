<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<ui:composition template="/home.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui">
    <ui:define name="bodyJR"> 
        <style type="text/css">
            .left {
                text-align: left;
            }
            .right div {
                float: right;
            }
            .ui-panelgrid .ui-grid-responsive .ui-panelgrid-cell {
                border: 1px solid #e5e2e2;
            }
        </style>
        <center>
            <h:form id="frmGraficas">
                <p:toolbar>
                    <f:facet name="left">
                        <span title="#{ausGraficasBean.modulo.descripcion}">#{ausGraficasBean.modulo.nombre}</span>
                    </f:facet>
                    <f:facet name="right">
                        <p:commandButton title="Consultar" ajax="true" actionListener="#{ausGraficasBean.consultar()}" icon="ui-icon-search"/>
                    </f:facet>
                </p:toolbar>
                <p:panel id="panelGraficas" header="#{ausGraficasBean.objeto.tituloPrincipal}" style="margin-bottom:10px;" >
                    <p:dataTable id="tablaCasosResponsables" var="casoRes" value="#{ausGraficasBean.objeto.listaDatos}" widgetVar="tablaCasosResponsables" rendered="#{ausGraficasBean.objeto.dataResponsables}" scrollable="true" scrollHeight="80" emptyMessage="No se encontraron registros">
                        <f:facet name="header">
                            <div>
                                LISTA CASOS
                            </div>
                        </f:facet>
                        <p:column headerText="Nombre">
                            <h:outputText value="#{casoRes.nombre}" />
                        </p:column>
                        <p:column headerText="Cerrados">
                            <h:outputText value="#{casoRes.cantidadCerrados}" />
                        </p:column>
                        <p:column headerText="Vencidos">
                            <h:outputText value="#{casoRes.cantidadVencidos}" />
                        </p:column>
                        <p:column headerText="Pendientes">
                            <h:outputText value="#{casoRes.cantidadPendientes}" />
                        </p:column>
                    </p:dataTable>
                    <p:dataTable id="tablaCasosIpsPrescriptora" var="IpsPres" value="#{ausGraficasBean.objeto.listaDatos}" widgetVar="tablaCasosIpsPrescriptora" rendered="#{ausGraficasBean.objeto.dataIpsPrescriptora}" scrollable="true" scrollHeight="80" emptyMessage="No se encontraron registros">
                        <f:facet name="header">
                            <div>
                                LISTA IPS PRESCRIPTORA
                            </div>
                        </f:facet>
                        <p:column headerText="Nombre">
                            <h:outputText value="#{IpsPres.nombre}" />
                        </p:column>
                        <p:column headerText="Cerrados">
                            <h:outputText value="#{IpsPres.cantidadCerrados}" />
                        </p:column>
                        <p:column headerText="Vencidos">
                            <h:outputText value="#{IpsPres.cantidadVencidos}" />
                        </p:column>
                        <p:column headerText="Pendientes">
                            <h:outputText value="#{IpsPres.cantidadPendientes}" />
                        </p:column>
                    </p:dataTable>
                    <p:dataTable id="tablaCasosIpsDestino" var="IpsDes" value="#{ausGraficasBean.objeto.listaDatos}" widgetVar="tablaCasosIpsDestino" rendered="#{ausGraficasBean.objeto.dataIpsDestino}" scrollable="true" scrollHeight="80" emptyMessage="No se encontraron registros">
                        <f:facet name="header">
                            <div>
                                LISTA IPS DESTINO
                            </div>
                        </f:facet>
                        <p:column headerText="Nombre">
                            <h:outputText value="#{IpsDes.nombre}" />
                        </p:column>
                        <p:column headerText="Cerrados">
                            <h:outputText value="#{IpsDes.cantidadCerrados}" />
                        </p:column>
                        <p:column headerText="Vencidos">
                            <h:outputText value="#{IpsDes.cantidadVencidos}" />
                        </p:column>
                        <p:column headerText="Pendientes">
                            <h:outputText value="#{IpsDes.cantidadPendientes}" />
                        </p:column>
                    </p:dataTable>
                    <p:separator/>
                    <p:panelGrid id="panelGridGraficasBarra" style="width:100%;margin:10px 0px;" rendered="#{ausGraficasBean.objeto.graficasBarras}">
                        <p:row>
                            <p:column class="ui-g-6">
                                <p:barChart model="#{ausGraficasBean.barModel}" style="width: 100%; height: 500px;"/>
                            </p:column>
                            <p:column class="ui-g-6">
                                <p:barChart  model="#{ausGraficasBean.barModelUnida}" style="width: 100%; height: 500px;"/>
                            </p:column>
                        </p:row>
                    </p:panelGrid>
                    <p:panelGrid id="panelGridGraficaLinea"  style="width:100%;margin:10px 0px;" rendered="#{ausGraficasBean.objeto.graficasLinea}">
                        <p:row>
                            <p:column class="ui-g-12">
                                 <p:lineChart model="#{ausGraficasBean.lineModel}" style="width: 100%; height: 500px;"/>
                            </p:column>
                        </p:row>
                       
                    </p:panelGrid> 
                </p:panel>
            </h:form>
            <!--FILTROS-->
            <p:dialog header="CONSULTAR" widgetVar="dialogoConsultar" appendTo="@(body)" modal="true" dynamic="true" width="80%">
                <p:scrollPanel mode="native" style="width:100%;margin:10px 0px">
                    <h:form id="frmConsultar">
                        <p:panel id="pConsultar" header="Opciones" style="margin-bottom:10px;" collapsed="false" toggleable="true">
                            <p:panelGrid id="panelConsultar">
                                <p:row>
                                    <p:column class="ui-g-2">
                                        <p:outputLabel value="Tipo Reporte" for="tipoReporte" style="font-weight:bold"/>
                                    </p:column>
                                    <p:column class="ui-g-10">
                                        <p:selectOneMenu id="tipoReporte" label="Tipo Reporte" required="true" value="#{ausGraficasBean.objeto.tipoReporte}" requiredMessage="Tipo Documento: Este campo es obligatorio." editable="fase" style="width: 90%;" >
                                            <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />
                                            <f:selectItems value="#{ausGraficasBean.objeto.getListaReportes()}" var="tipRep" itemValue="#{tipRep}" itemLabel="#{tipRep}" />
                                            <p:ajax event="change"  listener="#{ausGraficasBean.objeto.generarListaOperaciones()}" update="operacion"></p:ajax>
                                        </p:selectOneMenu>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column class="ui-g-2">
                                        <p:outputLabel value="Fecha Desde" for="fechaDesde" style="font-weight:bold"/>
                                    </p:column>
                                    <p:column class="ui-g-4">
                                        <p:calendar id="fechaDesde" yearRange="c-100:c" label="Fecha Desde" pattern="yyyy-MM-dd"  value="#{ausGraficasBean.objeto.fechaDesde}" required="true" requiredMessage="Fecha Desde: se requiere tener una fecha valida">
                                            <p:ajax event="dateSelect" listener="#{ausGraficasBean.guardarFechaDesde}" />
                                        </p:calendar> 
                                    </p:column>
                                    <p:column class="ui-g-2">
                                        <p:outputLabel value="Fecha Hasta" for="fechaHasta" style="font-weight:bold"/>
                                    </p:column>
                                    <p:column class="ui-g-4">
                                        <p:calendar id="fechaHasta" yearRange="c-100:c" label="Fecha Desde" pattern="yyyy-MM-dd"  value="#{ausGraficasBean.objeto.fechaHasta}" required="true" requiredMessage="Fecha Hasta: se requiere una fecha valida">
                                            <p:ajax event="dateSelect" listener="#{ausGraficasBean.guardarFechaHasta}" />
                                        </p:calendar>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column class="ui-g-2">
                                        <p:outputLabel value="Operación" for="operacion" style="font-weight:bold"/>
                                    </p:column>
                                    <p:column class="ui-g-10">
                                        <p:selectOneMenu id="operacion" label="Operación" required="true" value="#{ausGraficasBean.objeto.tipoOperacion}" requiredMessage="Operación: Este campo es obligatorio." editable="fase" style="width: 90%;" >
                                            <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />
                                            <f:selectItems value="#{ausGraficasBean.objeto.listaOperaciones}"/>
                                            <p:ajax event="change" listener="#{ausGraficasBean.objeto.generarOpciones()}" update="frmConsultar"/>
                                        </p:selectOneMenu>
                                    </p:column>
                                </p:row>
                               
                                
                                <p:row id="rowUsuarios" rendered="#{ausGraficasBean.objeto.opcionUsuario}">
                                    <p:column class="ui-g-2">
                                        <p:outputLabel value="Lista Usuarios" for="listaUsuarios" style="font-weight:bold"/>
                                    </p:column>
                                    <p:column class="ui-g-10">
                                        <p:selectCheckboxMenu id="listaUsuarios" value="#{ausGraficasBean.objeto.listaFiltrosResponsable}" label="Responsables" required="true"
                                                      filter="true" filterMatchMode="startsWith" panelStyle="width:500px" requiredMessage="Debes seleccionar al menos un responsable" style="width: 90%;">
                                            <f:selectItems value="#{ausGraficasBean.objeto.listaUsuarios}" var="user" itemLabel="#{user.nombre}" itemValue="#{user.id}"/>
                                        </p:selectCheckboxMenu>
                                    </p:column>
                                </p:row>
                               

                                <p:row id="rowIps" rendered="#{ausGraficasBean.objeto.opcionIps}">
                                    <p:column class="ui-g-2">
                                        <p:outputLabel value="Prescriptora *" style="font-weight:bold"/>
                                    </p:column>
                                    <p:column class="ui-g-10">
                                        <p:commandButton immediate="true" action="#{ausGraficasBean.consultarSedes()}" 
                                                     icon="ui-icon-home" style="float:right" title="Seleccionar sede"/>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column class="ui-g-2">
                                        <p:outputLabel value="Estados" for="listaPulsadores" style="font-weight:bold"/>
                                    </p:column>
                                    <p:column class="ui-g-10">
                                        <p:selectManyMenu id="listaPulsadores" filter="true" value="#{ausGraficasBean.objeto.listaFiltrosPulsadores}" filterMatchMode="contains" showCheckbox="true" style="width: 90%;">
                                            <f:selectItems value="#{ausGraficasBean.objeto.listaPulsadores}"/>
                                        </p:selectManyMenu>
                                    </p:column>
                                </p:row>
                            </p:panelGrid>
                        </p:panel>
                        <p:dataTable id="listaIps" widgetVar="listaIps" var="ipsV" value="#{ausGraficasBean.prestadorSedes}" scrollable="true" style="margin-bottom:20px;" rendered="#{ausGraficasBean.objeto.opcionIps}" emptyMessage="No se encontraron IPS">
                            <f:facet name="header">
                                IPS
                            </f:facet>
                            <p:column headerText="Codigo">
                                <h:outputText value="#{ipsV.id}" />
                            </p:column>
                            <p:column headerText="Nombre">
                                <h:outputText value="#{ipsV.nombreSede}" />
                            </p:column>

                            <p:column style="text-align: center;">
                                <f:facet name="header">
                                    <h:outputText value="Borrar"/>
                                </f:facet>    
                                <p:commandButton title="Borrar" action="#{ausGraficasBean.borrarIPS(ipsV.id)}" immediate="true" icon="ui-icon-trash">
                                    <p:confirm header="Confirmación" message="Está seguro que desea eliminar?" icon="ui-icon-alert" />
                                </p:commandButton>
                            </p:column>
                        </p:dataTable>
                        <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                            <p:commandButton value="Si" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" style="left:25%"/>
                            <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" style="left:25%"/>
                        </p:confirmDialog>
                        <p:panelGrid style="width:100%;margin:10px 0px">
                            <f:facet name="footer">
                                <p:row>
                                    <p:column colspan="4" style="text-align: center">
                                        <h:panelGroup style="display:block; text-align:center; margin-top: 10px;">
                                            <p:commandButton value="Generar" type="button" onclick="generarRemoto()" validateClient="true"/>
                                            <p:remoteCommand name="generarRemoto" action="#{ausGraficasBean.generar()}" update="frmGraficas" />                                      
                                            <p:commandButton value="Cancelar" type="button" onclick="PF('dialogoConsultar').hide()" immediate="true" style="margin-left: 5px;"/>
                                        </h:panelGroup>
                                    </p:column>
                                </p:row>
                            </f:facet>
                        </p:panelGrid>                            
                    </h:form>
                </p:scrollPanel>                    
            </p:dialog>
            <!--SEDES PRESCRIPTORA-->
            <p:dialog header="Consultar Sedes Prescriptora" widgetVar="dialogoIpsLista" appendTo="@(body)" style="max-width: 70%; max-height: 80%; min-height:70vh!important;" modal="true"  dynamic="true">
                <p:scrollPanel mode="native" style="max-height: 400px; padding-bottom: 0px !important;">
                    <h:form id="frmPrestadorLista">
                        <h:panelGroup id ="hPanelIps">
                            <p:panelGrid id="panelIpsLista" style="height:auto;" columns="1">
                                
                                    <p:dataTable id="tablaRegistrosIps" 
                                                 widgetVar="tablaWidgetIPS" 
                                                 var="objIPS" 
                                                 value="#{ausGraficasBean.lazySedes}" 
                                                 rowKey="#{objIPS.id}"
                                                 rows="#{ausGraficasBean.tamanoPagina}" 
                                                 paginator="true" 
                                                 lazy="true" 
                                                 reflow="true" 
                                                 currentPageReportTemplate="Registros del {startRecord} al {endRecord} de {totalRecords}, Página {currentPage} de {totalPages}"
                                                 paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                                 rowsPerPageTemplate="5,10,30,50,100" 
                                                 emptyMessage= "No se encontraron registros" 
                                                 selectionMode="multiple">
                                        <p:ajax event="rowSelect" listener="#{ausGraficasBean.onRowSelectIps}" />
                                        <p:column headerText="Código Habilitacion" filterBy="#{objIPS.codigoHabilitacionSede}">
                                            <f:facet name="filter">
                                                <p:inputText label="Código Habilitación" maxlength="128" style="width: 95%;" onchange="PF('tablaWidgetIPS').filter()"/>
                                            </f:facet>
                                            <h:outputText value="#{objIPS.codigoHabilitacionSede}"/>
                                        </p:column>
                                        <p:column headerText="Tipo Documento" filterBy="#{objIPS.cntPrestador.maeTipoDocumentoValor}">
                                            <f:facet name="filter">
                                                <p:selectOneMenu onchange="PF('tablaWidgetIPS').filter()">
                                                    <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />
                                                    <f:selectItems value="#{ausGraficasBean.listaTiposDocumentoEmpresa}" var="tipoDoc" itemValue="#{tipoDoc.id}" itemLabel="#{tipoDoc.descripcion}" itemDescription="#{tipoDoc.descripcion}" />
                                                </p:selectOneMenu>
                                            </f:facet>
                                            <h:outputText value="#{objIPS.cntPrestador.maeTipoDocumentoValor}"/>
                                        </p:column>
                                        <p:column headerText="Numero Documento" filterBy="#{objIPS.cntPrestador.numeroDocumento}">
                                            <f:facet name="filter">
                                                <p:inputText label="Numero Documetno" maxlength="128" style="width: 95%;" onchange="PF('tablaWidgetIPS').filter()"/>
                                            </f:facet>
                                            <h:outputText value="#{objIPS.cntPrestador.numeroDocumento}"/>
                                        </p:column>
                                        <p:column headerText="Razón Social" filterBy="#{objIPS.cntPrestador.razonSocial}">
                                            <f:facet name="filter">
                                                <p:inputText label="Razón Social" maxlength="128" style="width: 95%;" onchange="PF('tablaWidgetIPS').filter()"/>
                                            </f:facet>
                                            <h:outputText value="#{objIPS.cntPrestador.razonSocial}"/>
                                        </p:column>
                                        <p:column headerText="Sede" filterBy="#{objIPS.nombreSede}">
                                            <f:facet name="filter">
                                                <p:inputText label="Sede" maxlength="128" style="width: 95%;" onchange="PF('tablaWidgetIPS').filter()"/>
                                            </f:facet>
                                            <h:outputText value="#{objIPS.nombreSede}"/>
                                        </p:column>
                                        <p:column headerText="Departamento">
                                            <h:outputText value="#{ausGraficasBean.obtenerDepartamento(objIPS.ubicacionId)}"/>
                                        </p:column>
                                        <p:column headerText="Municipio" filterBy="#{obj.ubicacionId}">
                                            <f:facet name="filter">
                                                <p:selectOneMenu onchange="PF('tablaWidgetIPS').filter()" filter="true" filterMatchMode="startsWith">
                                                    <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />
                                                    <f:selectItems value="#{ausGraficasBean.listaUbicacion}" var="tipoUbiC1" itemValue="#{tipoUbiC1.id}" itemLabel="#{tipoUbiC1.descripcion}" itemDescription="#{tipoUbiC1.descripcion}" />
                                                </p:selectOneMenu>
                                            </f:facet>
                                            <h:outputText value="#{ausGraficasBean.obtenerMunicipio(objIPS.ubicacionId)}"/>
                                        </p:column>
                                        <p:column headerText="Dirección">
                                            <f:facet name="filter">
                                                <p:inputText label="Dirección" maxlength="128" style="width: 95%;" onchange="PF('tablaWidgetIPS').filter()"/>
                                            </f:facet>
                                            <h:outputText value="#{objIPS.direccion}"/>
                                        </p:column>
                                    </p:dataTable>
                                <p:panelGrid  style="width:100%;margin:10px 0px">
                                    <f:facet name="footer">
                                        <p:row>
                                            <p:column colspan="4" style="text-align: center">
                                                <h:panelGroup style="display:block; text-align:center; margin-top: 10px;">                                    
                                                    <p:commandButton value="Cancelar" type="button" onclick="PF('dialogoIpsLista').hide()" immediate="true" style="margin-left: 5px;"/>
                                                </h:panelGroup>
                                            </p:column>
                                        </p:row>
                                    </f:facet>
                                </p:panelGrid>
                            </p:panelGrid>
                        </h:panelGroup>
                    </h:form>
                </p:scrollPanel>
            </p:dialog>
        </center>
    </ui:define>
</ui:composition>