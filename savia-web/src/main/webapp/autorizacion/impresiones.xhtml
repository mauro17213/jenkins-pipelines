<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<ui:composition template="/home.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui">
    <ui:define name="bodyJR">
        <style type="text/css">
            .responsivefix {overflow-y: scroll;max-height:100vh;max-width: 95%!important;margin-left: -2.5%!important;left: 5%!important;}
            @media only screen and (max-width: 960px) { 
                .responsivefix {height:90vh!important;}
                .smallModal{
                    width: 50%!important;
                    left: 50%!important;
                    margin-left: -25%!important;}
            }
        </style>

        <div id="overlay">
            <div class="loader">Cargando...</div>
        </div>
        <center>
            <h:form id="frmImpresionAutorizacion">
                <p:toolbar>
                    <f:facet name="left" >
                        <span title="#{impresionAutorizacionBean.modulo.descripcion}">#{impresionAutorizacionBean.modulo.nombre}</span>
                        <p:spacer width="30"/>
                        <p:outputLabel value="Desde"/>
                        <p:spacer width="5"/>
                        <p:calendar id="fInicial" value="#{impresionAutorizacionBean.paramConsulta.parametroConsulta1}" pattern="yyyy-MM-dd" yearRange="c-100:c"  type="localDate" navigator="true">
                            <p:ajax event="dateSelect" update="tablaRegistros"/>
                            <f:convertDateTime pattern="yyyy-MM-dd" type="both" timeZone="America/Bogota"/>
                        </p:calendar>
                        <p:spacer width="10"/>
                        <p:outputLabel value="Hasta"/>
                        <p:spacer width="5"/>
                        <p:calendar id="fFinal" value="#{impresionAutorizacionBean.paramConsulta.parametroConsulta2}" pattern="yyyy-MM-dd" yearRange="c-100:c"  type="localDate" navigator="true">
                            <p:ajax event="dateSelect" update="tablaRegistros"/>
                            <f:convertDateTime pattern="yyyy-MM-dd" type="both" timeZone="America/Bogota"/>
                        </p:calendar>
                    </f:facet>
                    <f:facet name="right">
                        <p:commandButton rendered="#{impresionAutorizacionBean.accionListar}" title="Refrescar" ajax="false" actionListener="#{impresionAutorizacionBean.refrescar}" icon="ui-icon-refresh"/>
                        <h:commandLink>
                            <p:commandButton icon="ui-icon-excel" title="Exportar" ajax="false"/>
                            <p:dataExporter type="csv" pageOnly="true" 
                                            target="tablaRegistros" encoding="ISO-8859-1" fileName="conexiones-impresiones" />
                        </h:commandLink>
                    </f:facet>
                </p:toolbar>
                <p:dataTable id="tablaRegistros" widgetVar="tablaWidget" var="obj" value="#{impresionAutorizacionBean.lazyImpresion}" rowKey="#{obj.id}"
                             rows="#{impresionAutorizacionBean.tamanoPagina}" paginator="true" sortMode="single"
                             currentPageReportTemplate="Registros del {startRecord} al {endRecord} de {totalRecords}, Página {currentPage} de {totalPages}"
                             paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             rowsPerPageTemplate="5,10,30,50,100" 
                             emptyMessage="No se encontraron registros" style="font-size:0.8em!important;">
                    <p:column headerText="Fecha Impresión" sortBy="#{obj.fechaHoraCrea}">
                        <h:outputText value="#{obj.fechaHoraCrea}"/>
                    </p:column>
                    <p:column headerText="Tipo Documento" filterBy="#{obj.auAnexo4Id.afiliadoTipoDocumento}">
                        <f:facet name="filter">
                            <p:selectOneMenu onchange="PF('tablaWidget').filter()">
                                <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />
                                <f:selectItems value="#{impresionAutorizacionBean.listaTipoDocumentoAfiliado}" var="tipoDoc" itemLabel="#{tipoDoc.nombre}" itemValue="#{tipoDoc.id}" />
                            </p:selectOneMenu>                        
                        </f:facet>
                        <h:outputText value="#{impresionAutorizacionBean.obtenerTipoDocumentoAfiliado(obj.auAnexo4Id.asegAfiliadoId.maeTipoDocumento)}"/>
                    </p:column>
                    <p:column headerText="Número Documento" filterBy="#{obj.auAnexo4Id.afiliadoNumeroDocumento}">
                        <f:facet name="filter">
                            <p:inputText maxlength="16" style="width: 95%;" onchange="PF('tablaWidget').filter()"/>
                        </f:facet>
                        <h:outputText value="#{obj.auAnexo4Id.afiliadoNumeroDocumento}"/>
                    </p:column>
                    <p:column headerText="Usuario" filterBy="#{obj.usuarioCrea}"  >
                        <f:facet name="filter">
                            <p:inputText maxlength="16" style="width: 95%;" 
                                         onchange="PF('tablaWidget').filter()"/>
                        </f:facet>
                        <h:outputText value="#{obj.usuarioCrea}">
                            <p:inputText maxlength="16" style="width: 95%;" onchange="PF('tablaWidget').filter()"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Solicitud" filterBy="#{obj.auAnexo4Id.auAnexo3Id.id}">
                        <f:facet name="filter">
                            <p:inputText maxlength="16" style="width: 95%;" onchange="PF('tablaWidget').filter()"/>
                        </f:facet>
                        <h:outputText value="#{obj.auAnexo4Id.obtenerNumeroSolicitud()}"/>
                    </p:column>
                    <p:column headerText="Autorización" filterBy="#{obj.auAnexo4Id.id}"  >
                        <f:facet name="filter">
                            <p:inputText maxlength="16" style="width: 95%;" 
                                         onchange="PF('tablaWidget').filter()"/>
                        </f:facet>
                        <h:outputText value="#{obj.auAnexo4Id.id}">
                            <p:inputText maxlength="16" style="width: 95%;" onchange="PF('tablaWidget').filter()"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Impresiones Realizadas" >
                        <h:outputText value="#{obj.auAnexo4Id.impresionesRealizadas}"/>
                    </p:column>
                    <p:column headerText="Impresiones Autorizadas" >
                        <h:outputText value="#{obj.auAnexo4Id.impresionesAutorizadas}"/>
                    </p:column>
                    <p:column headerText="Terminal Impresión" filterBy="#{obj.terminalCrea}"  >
                        <f:facet name="filter">
                            <p:inputText maxlength="16" style="width: 95%;" 
                                         onchange="PF('tablaWidget').filter()"/>
                        </f:facet>
                        <h:outputText value="#{obj.terminalCrea}">
                            <p:inputText maxlength="48" style="width: 95%;" onchange="PF('tablaWidget').filter()"/>
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Acciones" style="text-align: center;" exportable="false">
                        <p:commandButton rendered="#{impresionAutorizacionBean.accionVer}" 
                                         title="Ver" actionListener="#{impresionAutorizacionBean.ver(obj.id)}" 
                                         icon="ui-icon-search">
                        </p:commandButton>
                    </p:column>
                </p:dataTable>  
            </h:form>
            <p:dialog header="Ver registros de impresión" widgetVar="dialogoVer" appendTo="@(body)" modal="true" >
                <h:form id="frmVer">
                    <p:panel id="pImpresionVer" header="Información Impresión" style="margin-bottom:10px;" collapsed="false" toggleable="true">
                        <p:panelGrid id="panelImpresionVer" columns="4"
                                     columnClasses="ui-grid-col-2,ui-grid-col-4,ui-grid-col-2,ui-grid-col-4"
                                     layout="grid"
                                     styleClass="ui-panelgrid-blank ui-fluid" >

                            <p:outputLabel value="Tipo Documento" style="font-weight:bold"/>
                            <p:outputLabel value="#{impresionAutorizacionBean.obtenerTipoDocumentoAfiliado(impresionAutorizacionBean.objeto.auAnexo4Id.asegAfiliadoId.maeTipoDocumento)}"/>

                            <p:outputLabel value="Número Documento" style="font-weight:bold"/>
                            <p:outputLabel value="#{impresionAutorizacionBean.objeto.auAnexo4Id.asegAfiliadoId.numeroDocumento}"/>

                            <p:outputLabel value="Nombre Completo" style="font-weight:bold"/>
                            <p:outputLabel value="#{impresionAutorizacionBean.objeto.auAnexo4Id.asegAfiliadoId.nombreCompleto}"/>

                            <p:outputLabel value="Número Autorización" style="font-weight:bold"/>
                            <p:outputLabel value="#{impresionAutorizacionBean.objeto.auAnexo4Id.id}"/>

                            <p:outputLabel value="Número Solicitud" style="font-weight:bold"/>
                            <p:outputLabel value="#{impresionAutorizacionBean.objeto.auAnexo4Id.obtenerNumeroSolicitud()}"/>

                            <p:outputLabel value="Tipo Impresión" style="font-weight:bold"/>
                            <p:outputLabel value="#{impresionAutorizacionBean.objeto.obtenerTipoImpresion()}"/>

                            <p:outputLabel value="Origen" style="font-weight:bold"/>
                            <p:outputLabel value="#{impresionAutorizacionBean.objeto.obtenerOrigen()}"/>

                            <p:outputLabel value="Impresiones Realizadas" style="font-weight:bold"/>
                            <p:outputLabel value="#{impresionAutorizacionBean.objeto.auAnexo4Id.impresionesRealizadas}"/>

                            <p:outputLabel value="Impresiones Autorizadas" style="font-weight:bold"/>
                            <p:outputLabel value="#{impresionAutorizacionBean.objeto.auAnexo4Id.impresionesAutorizadas}"/>

                            <p:outputLabel value="Responsable" style="font-weight:bold"/>
                            <p:outputLabel value="#{impresionAutorizacionBean.objeto.usuarioCrea}"/>

                            <p:outputLabel value="Fecha Impresión" style="font-weight:bold"/>
                            <p:outputLabel value="#{impresionAutorizacionBean.objeto.fechaHoraCrea}"/>

                        </p:panelGrid>
                    </p:panel>
                </h:form>
            </p:dialog>

            <script type="text/javascript">
                //<![CDATA[
                function start() {
                    PF('statusDialog').show();
                }

                function stop() {
                    PF('statusDialog').hide();
                }
                //]]>
            </script>
        </center>
    </ui:define>
</ui:composition>
