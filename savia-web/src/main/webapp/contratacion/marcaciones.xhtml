<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<ui:composition template="/home.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui">
    <ui:define name="bodyJR">
        <center>
            <style>
                .ui-panelgrid .ui-grid-responsive .ui-panelgrid-cell {
                    border: 1px solid #e5e2e2;
                }

            </style>
            <script type="text/javascript">
                //<![CDATA[ 
                function noPuntuacion(e) {
                    var key = window.Event ? e.which : e.keyCode
                    return (key != 44 && key != 46 && key != 59)
                }
                ;
                function soloNumeros(e) {
                    var key = window.Event ? e.which : e.keyCode
                    return (key >= 48 && key <= 57)
                }
                ;
                //]]>
            </script>
            <h:form id="frmMarcaciones">
                <p:toolbar>
                    <f:facet name="left" >
                        <span title="#{marcacionesBean.modulo.descripcion}">#{marcacionesBean.modulo.nombre}</span>
                    </f:facet>
                    <f:facet name="right">
                        <p:commandButton rendered="#{marcacionesBean.accionListar}" title="Refrescar" ajax="false" actionListener="#{marcacionesBean.refrescar}" icon="ui-icon-refresh"/>
                    </f:facet>
                </p:toolbar>
                <p:dataTable var="obj" value="#{marcacionesBean.lazyContratoDetalle}" paginator="true" rows="#{marcacionesBean.tamanoPagina}" 
                             emptyMessage="No se encontraron registros"
                             currentPageReportTemplate="Registros del {startRecord} al {endRecord} de {totalRecords}, Página {currentPage} de {totalPages}"
                             paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             rowsPerPageTemplate="5,10,30,50,100" id="tablaRegistros" lazy="true"
                             widgetVar="tablaWidget"
                             style="font-size:11px;"
                             scrollable="false"
                             scrollWidth="100%"
                             rowKey="#{obj.id}" reflow="true">

                    <p:column style="text-align: center;">
                        <f:facet name="header">
                            <h:outputText value="Acciones"/>
                        </f:facet>    
                        <p:commandButton rendered="#{marcacionesBean.accionVer}" title="Ver" actionListener="#{marcacionesBean.ver(obj.id)}" icon="ui-icon-search"/>
                        <p:commandButton rendered="#{marcacionesBean.accionEditar}" title="Gestionar" actionListener="#{marcacionesBean.editar(obj.id)}" icon="ui-icon-pencil"/>
                    </p:column>
                    <p:column headerText="Número del Contrato" sortBy="#{obj.cntContrato.contrato}" filterBy="#{obj.cntContrato.contrato}">
                        <f:facet name="filter">
                            <p:inputText maxlength="32" style="width: 95%;" onkeypress="
                                    if (event.keyCode === 13) {
                                        onchange();
                                        return false;
                                    }" onchange="PF('tablaWidget').filter()" />
                        </f:facet>
                        <h:outputText value="#{obj.cntContrato.contrato}" title="#{obj.cntContrato.contrato}"/>
                    </p:column>
                    <p:column headerText="Código Habilitación Sede" sortBy="#{obj.cntContratoSede.cntPrestadorSede.codigoHabilitacionSede}" filterBy="#{obj.cntContratoSede.cntPrestadorSede.codigoHabilitacionSede}">
                        <f:facet name="filter">
                            <p:inputText maxlength="32" style="width: 95%;" onkeypress="
                                    if (event.keyCode === 13) {
                                        onchange();
                                        return false;
                                    }" onchange="PF('tablaWidget').filter()" />
                        </f:facet>
                        <h:outputText value="#{obj.cntContratoSede.cntPrestadorSede.codigoHabilitacionSede}" title="#{obj.cntContratoSede.cntPrestadorSede.codigoHabilitacionSede}"/>
                    </p:column>
                    <p:column headerText="Modalidad Contrato" sortBy="#{obj.cntContratoSede.maeModalidadContratoId}" filterBy="#{obj.cntContratoSede.maeModalidadContratoId}">
                        <f:facet name="filter">
                            <p:selectOneMenu onchange="PF('tablaWidget').filter()" style="width: 88%;" >
                                <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />
                                <f:selectItems value="#{marcacionesBean.listaModalidadContrato}" var="modalidad" itemValue="#{modalidad.id}" itemLabel="#{modalidad.nombre}" itemDescription="#{modalidad.descripcion}"/>
                            </p:selectOneMenu>
                        </f:facet>
                        <h:outputText value="#{obj.cntContratoSede.maeModalidadContratoValor}" title="#{obj.cntContratoSede.maeModalidadContratoValor}"/>
                    </p:column>
                    <p:column headerText="Tipo" sortBy="#{obj.tipoTecnologia}" filterBy="#{obj.tipoTecnologia}">
                        <f:facet name="filter">
                            <p:selectOneMenu onchange="PF('tablaWidget').filter()" style="width: 70%;" >
                                <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />
                                <f:selectItem itemLabel=" Tecnologia (CUP)" itemValue="1"  />
                                <f:selectItem itemLabel=" Medicamento (CUM)" itemValue="2" />
                                <f:selectItem itemLabel=" Insumo " itemValue="3" />
                                <f:selectItem itemLabel=" Paquete " itemValue="4" />
                            </p:selectOneMenu>
                        </f:facet>
                        <h:outputText value="#{marcacionesBean.getTipoTecnologia(obj.tipoTecnologia)}" title="#{marcacionesBean.getTipoTecnologia(obj.tipoTecnologia)}"/>
                    </p:column>
                    <p:column headerText="Código" sortBy="#{obj.maTecnologiaCodigo}" filterBy="#{obj.maTecnologiaCodigo}">
                        <f:facet name="filter">
                            <p:inputText label="Código" maxlength="16" style="width: 95%;" onkeypress="if (event.keyCode === 13) {
                                        onchange();
                                        return false;
                                    }"  onchange="PF('tablaWidget').filter()" />
                        </f:facet>
                        <h:outputText value="#{obj.maTecnologiaCodigo}" title="#{obj.maTecnologiaCodigo}"/>
                    </p:column>
                    <p:column headerText="Nombre" sortBy="#{obj.maTecnologiaValor}" filterBy="#{obj.maTecnologiaValor}" style="width: 240px;">
                        <f:facet name="filter">
                            <p:inputText label="Nombre" maxlength="256" style="width: 95%;" onkeypress="if (event.keyCode === 13) {
                                        onchange();
                                        return false;
                                    }"  onchange="PF('tablaWidget').filter()" />
                        </f:facet>
                        <h:outputText value="#{obj.maTecnologiaValor}" title="#{obj.maTecnologiaValor}"/>
                    </p:column>
                    <p:column headerText="Aplica Autorización Manual" filterBy="#{obj.automaticoManual}">
                        <f:facet name="filter">
                            <p:selectOneMenu onchange="PF('tablaWidget').filter()" style="width: 80%;" >
                                <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />
                                <f:selectItem itemLabel="No" itemValue="0"  />
                                <f:selectItem itemLabel="Si" itemValue="1"  />
                            </p:selectOneMenu>
                        </f:facet>
                        <h:outputText value="#{marcacionesBean.getBooleanStr(obj.automaticoManual)}" title="#{marcacionesBean.getBooleanStr(obj.automaticoManual)}"/>
                    </p:column>
                    <p:column headerText="Aplica Autorización Masiva" filterBy="#{obj.automaticoMasivo}">
                        <f:facet name="filter">
                            <p:selectOneMenu onchange="PF('tablaWidget').filter()" style="width: 80%;" >
                                <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />
                                <f:selectItem itemLabel="No" itemValue="0"  />
                                <f:selectItem itemLabel="Si" itemValue="1"  />
                            </p:selectOneMenu>
                        </f:facet>
                        <h:outputText value="#{marcacionesBean.getBooleanStr(obj.automaticoMasivo)}" title="#{marcacionesBean.getBooleanStr(obj.automaticoMasivo)}"/>
                    </p:column>
                    <p:column headerText="Aplica Interoperabilidad" filterBy="#{obj.automaticoInteroperabilidad}">
                        <f:facet name="filter">
                            <p:selectOneMenu onchange="PF('tablaWidget').filter()" style="width: 80%;" >
                                <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />
                                <f:selectItem itemLabel="No" itemValue="0"  />
                                <f:selectItem itemLabel="Si" itemValue="1"  />
                            </p:selectOneMenu>
                        </f:facet>
                        <h:outputText value="#{marcacionesBean.getBooleanStr(obj.automaticoInteroperabilidad)}" title="#{marcacionesBean.getBooleanStr(obj.automaticoInteroperabilidad)}"/>
                    </p:column>
                    <p:column headerText="Aplica Preautorización" filterBy="#{obj.preautorizacion}">
                        <f:facet name="filter">
                            <p:selectOneMenu onchange="PF('tablaWidget').filter()" style="width: 80%;" >
                                <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />
                                <f:selectItem itemLabel="No" itemValue="0"  />
                                <f:selectItem itemLabel="Si" itemValue="1"  />
                            </p:selectOneMenu>
                        </f:facet>
                        <h:outputText value="#{marcacionesBean.getBooleanStr(obj.preautorizacion)}" title="#{marcacionesBean.getBooleanStr(obj.preautorizacion)}"/>
                    </p:column>
                    <p:column headerText="Ámbito" style="width: 55px;" filterBy="#{obj.maeAmbitoId}">
                        <f:facet name="filter">
                            <p:selectOneMenu onchange="PF('tablaWidget').filter()" style="width: 80%;" >
                                <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />
                                <f:selectItems value="#{marcacionesBean.listaAmbito}" var="AMBITO" itemValue="#{AMBITO.id}" itemLabel="#{AMBITO.nombre}" itemDescription="#{AMBITO.descripcion}" />
                            </p:selectOneMenu>
                        </f:facet>
                        <h:outputText value="#{obj.maeAmbitoValor}" title="#{obj.maeAmbitoValor}"/>
                    </p:column>
                    <p:column headerText="Activo" >
                        <h:outputText value="#{marcacionesBean.getBooleanStr(obj.activo)}" title="#{marcacionesBean.getBooleanStr(obj.activo)}"/>
                    </p:column>
                </p:dataTable>
                <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                    <p:commandButton value="Si" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" style="left:25%"/>
                    <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" style="left:25%"/>
                </p:confirmDialog>
            </h:form>

            <!-- Pantalla Ver -->

            <p:dialog header="Ver" widgetVar="dialogoVer" appendTo="@(body)" position="center" width="80%" modal="true" style="max-height: 60%">
                <p:scrollPanel mode="native" style="height:300px">
                    <h:form class="frmAuditoria" style="text-align: right;">
                        <p:commandButton id="auditoria" class="btnAuditoria" action="#{marcacionesBean.getAuditoria(marcacionesBean.objeto.auditoriaStrHTML)}" icon="ui-icon-comment" title="Auditoría" />
                    </h:form>
                    <h:form id="frmVer">
                        <p:panelGrid id="panelInsumos" columns="4"
                                     columnClasses="ui-grid-col-2,ui-grid-col-4,ui-grid-col-2,ui-grid-col-4"
                                     layout="grid"
                                     styleClass="ui-panelgrid-blank ui-fluid" >

                            <p:outputLabel value="Número Contrato" style="font-weight:bold"/>
                            <p:outputLabel value="#{marcacionesBean.objeto.cntContrato.contrato}" />

                            <p:outputLabel value="Código Habilitación Sede" style="font-weight:bold"/>
                            <p:outputLabel value="#{marcacionesBean.objeto.cntContratoSede.cntPrestadorSede.codigoHabilitacionSede}" />

                            <p:outputLabel value="Modalidad Contrato" style="font-weight:bold"/>
                            <p:outputLabel value="#{marcacionesBean.objeto.cntContratoSede.maeModalidadContratoValor}" />

                            <p:outputLabel value="Tipo Tecnología" style="font-weight:bold"/>
                            <p:outputLabel value="#{marcacionesBean.getTipoTecnologia(marcacionesBean.objeto.tipoTecnologia)}" />

                            <p:outputLabel value="Código Tecnología" style="font-weight:bold"/>
                            <p:outputLabel value="#{marcacionesBean.objeto.maTecnologiaCodigo}" />

                            <p:outputLabel value="Descripción Tecnología" style="font-weight:bold"/>
                            <p:outputLabel value="#{marcacionesBean.objeto.maTecnologiaValor}"/>

                            <p:outputLabel value="Automático Manual" style="font-weight:bold"/>
                            <p:outputLabel value="#{marcacionesBean.getBooleanStr(marcacionesBean.objeto.automaticoManual)}" />

                            <p:outputLabel value="Automático Masivo" style="font-weight:bold"/>
                            <p:outputLabel value="#{marcacionesBean.getBooleanStr(marcacionesBean.objeto.automaticoMasivo)}" />

                            <p:outputLabel value="Automático Interoperabilidad" style="font-weight:bold"/>
                            <p:outputLabel value="#{marcacionesBean.getBooleanStr(marcacionesBean.objeto.automaticoInteroperabilidad)}" />

                            <p:outputLabel value="Preautorización" style="font-weight:bold"/>
                            <p:outputLabel value="#{marcacionesBean.getBooleanStr(marcacionesBean.objeto.preautorizacion)}" />

                            <p:outputLabel value="Ámbito" style="font-weight:bold"/>
                            <p:outputLabel value="#{marcacionesBean.objeto.maeAmbitoValor}" />

                            <p:outputLabel value="Activo" style="font-weight:bold"/>
                            <p:outputLabel value="#{marcacionesBean.getBooleanStr(marcacionesBean.objeto.activo)}" />

                        </p:panelGrid>
                        <p:panelGrid  style="width:100%;margin:10px 0px">
                            <f:facet name="footer">
                                <p:row>
                                    <p:column style="text-align: center">
                                        <h:panelGroup style="display:block; text-align:center;">
                                            <p:commandButton value="Salir" type="button" onclick="PF('dialogoVer').hide()" immediate="true" />
                                        </h:panelGroup>
                                    </p:column>
                                </p:row>
                            </f:facet>
                        </p:panelGrid>
                    </h:form>
                </p:scrollPanel>
            </p:dialog>

            <!-- Pantalla Editar -->

            <p:dialog header="Editar" widgetVar="dialogoEditar" appendTo="@(body)" modal="true"  width="80%" dynamic="true" style="max-height: 60%">
                <p:scrollPanel mode="native" style="height:250px">
                    <h:form class="frmAuditoria" style="text-align: right;">
                        <p:commandButton id="auditoria" class="btnAuditoria" action="#{marcacionesBean.getAuditoria(marcacionesBean.objeto.auditoriaStrHTML)}" icon="ui-icon-comment" title="Auditoría" />
                    </h:form>
                    <h:form id="frmEditar">
                        <p:panelGrid id="panelEditar" columns="4"
                                     columnClasses="ui-grid-col-2,ui-grid-col-4,ui-grid-col-2,ui-grid-col-4"
                                     layout="grid"
                                     styleClass="ui-panelgrid-blank ui-fluid" >

                            <p:outputLabel value="Número Contrato"  style="font-weight:bold"/>
                            <p:outputLabel value="#{marcacionesBean.objeto.cntContrato.contrato}" />

                            <p:outputLabel value="Código Habilitación Sede"  style="font-weight:bold"/>
                            <p:outputLabel value="#{marcacionesBean.objeto.cntContratoSede.cntPrestadorSede.codigoHabilitacionSede}" />

                            <p:outputLabel value="Modalidad Contrato"  style="font-weight:bold"/>
                            <p:outputLabel value="#{marcacionesBean.objeto.cntContratoSede.maeModalidadContratoValor}" />

                            <p:outputLabel value="Tipo Tecnología"  style="font-weight:bold"/>
                            <p:outputLabel value="#{marcacionesBean.getTipoTecnologia(marcacionesBean.objeto.tipoTecnologia)}" />

                            <p:outputLabel value="Código Tecnología"  style="font-weight:bold"/>
                            <p:outputLabel value="#{marcacionesBean.objeto.maTecnologiaCodigo}" />

                            <p:outputLabel value="Descripción Tecnología"  style="font-weight:bold"/>
                            <p:outputLabel value="#{marcacionesBean.objeto.maTecnologiaValor}"/>

                            <p:outputLabel value="Automático Manual" for="automaticoManual"  style="font-weight:bold"/>
                            <p:selectBooleanButton id="automaticoManual" value="#{marcacionesBean.objeto.automaticoManual}" onLabel="Si" offLabel="No" 
                                                   onIcon="ui-icon-check" offIcon="ui-icon-close"  style="width:60px" required="true" requiredMessage="Automático Manual: Este campo es obligatorio."/>

                            <p:outputLabel value="Automático Masivo" for="automaticoMasivo"  style="font-weight:bold"/>
                            <p:selectBooleanButton id="automaticoMasivo" value="#{marcacionesBean.objeto.automaticoMasivo}" onLabel="Si" offLabel="No" 
                                                   onIcon="ui-icon-check" offIcon="ui-icon-close"  style="width:60px" required="true" requiredMessage="Automático Masivo: Este campo es obligatorio."/>

                            <p:outputLabel value="Automático Interoperabilidad" for="automaticoInteroperabilidad"  style="font-weight:bold"/>
                            <p:selectBooleanButton id="automaticoInteroperabilidad" value="#{marcacionesBean.objeto.automaticoInteroperabilidad}" onLabel="Si" offLabel="No" 
                                                   onIcon="ui-icon-check" offIcon="ui-icon-close"  style="width:60px" required="true" requiredMessage="Automático Interoperabilidad: Este campo es obligatorio."/>

                            <p:outputLabel value="Preautorización" for="preautorizacion"  style="font-weight:bold"/>
                            <p:selectBooleanButton id="preautorizacion" value="#{marcacionesBean.objeto.preautorizacion}" onLabel="Si" offLabel="No" 
                                                   onIcon="ui-icon-check" offIcon="ui-icon-close"  style="width:60px" required="true" requiredMessage="Preautorización: Este campo es obligatorio."/>

                            <p:outputLabel value="Ámbito"  style="font-weight:bold"/>
                            <p:outputLabel value="#{marcacionesBean.objeto.maeAmbitoValor}" />

                            <p:outputLabel value="Activo"  style="font-weight:bold"/>
                            <p:outputLabel value="#{marcacionesBean.getBooleanStr(marcacionesBean.objeto.activo)}" />

                        </p:panelGrid>
                        <p:panelGrid id="panelEditar2" style="width:100%;margin:10px 0px">
                            <f:facet name="footer">
                                <p:row>
                                    <p:column colspan="4" style="text-align: center">
                                        <h:panelGroup style="display:block; text-align:center;">
                                            <p:commandButton onclick="modificarRemote()" type="button" value="Guardar" validateClient="true"/>
                                            <p:remoteCommand name="modificarRemote" action ="#{marcacionesBean.modificar()}" update="panelEditar,panelEditar2"/>
                                            <p:commandButton value="Cancelar" type="button" onclick="PF('dialogoEditar').hide()" immediate="true" style="margin-left: 5px;"/>
                                        </h:panelGroup>
                                    </p:column>
                                </p:row>
                            </f:facet>
                        </p:panelGrid>
                    </h:form>
                </p:scrollPanel>
            </p:dialog>

        </center>
    </ui:define>
</ui:composition>
