<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="./../home.xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
                >

    <ui:define name="bodyJR">
        <h:outputStylesheet name="css/cntjuridica.css"/>  
        <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
        <h:outputScript name="js/Cntjuridico.js" />
        <center >
            <h:form id="frmGestion">
                <p:toolbar>
                    <f:facet name="left" >
                        <span title="#{cntjTareaBean.modulo.descripcion}">#{cntjTareaBean.modulo.nombre}</span>
                    </f:facet>
                    <f:facet name="right">
                        <p:commandButton rendered="#{cntjTareaBean.accionListar}" class="boton-normal btn1" title="Refrescar" ajax="true" actionListener="#{cntjTareaBean.listar}" icon="pi pi-sync" />
                    </f:facet>
                </p:toolbar>
                
                <p:dataTable var="obj" class="listaDatos"  paginator="true" rows="#{cntjTareaBean.tamanoPagina}" value="#{cntjTareaBean.lazyExpediente}"
                             emptyMessage="No se encontraron registros" lazy="true"
                             currentPageReportTemplate="Registros del {startRecord} al {endRecord} de {totalRecords}, Página {currentPage} de {totalPages}"
                             paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             rowsPerPageTemplate="5,10,30,50,100" id="tablaRegistros" 
                             widgetVar="tablaWidgetPrincipal"
                             style="font-size:11px;"
                             scrollable="false"
                             scrollWidth="140%"
                             rowKey="#{obj.id}" reflow="true">

                    <p:column headerText="Opciones" style="text-align: center;">
                        <p:commandButton rendered="#{cntjTareaBean.accionCrear}" title="Gestionar" actionListener="#{cntjTareaBean.crearGestion(obj.id)}" icon="pi pi-file-check" class="btn-icono"/>
                        <p:commandButton rendered="#{cntjTareaBean.accionVer}" title="Documentos" actionListener="#{cntjTareaBean.verdocumentos(obj.id)}" icon="pi pi-file-pdf" class="btn-icono"/>                        
                    </p:column>

                    <p:column headerText="Expediente" filterBy="#{obj.numeroExpediente}"  >
                        <f:facet name="filter">
                            <p:inputText label="Expediente" maxlength="128" class="txtFiltro" onchange="PF('tablaWidgetPrincipal').filter()"/>
                        </f:facet>
                        <h:outputText value="#{obj.numeroExpediente}" title="#{obj.numeroExpediente}"/>
                    </p:column>

                    <p:column headerText="Proceso" >                        
                        <h:outputText value="#{obj.procesoId.nombre}" title="#{obj.procesoId.nombre}"/>
                    </p:column>

                    <p:column headerText="Estado Actual" filterBy="#{obj.estadoActual.nombre}"  >
                        <f:facet name="filter">
                            <p:inputText label="Expediente" maxlength="128" class="txtFiltro" onchange="PF('tablaWidgetPrincipal').filter()"/>
                        </f:facet>
                        <h:outputText value="#{obj.estadoActual.nombre}" title="#{obj.estadoActual.nombre}"/>
                    </p:column>

                    <p:column headerText="Fecha Estado Actual" >
                        <h:outputText value="#{obj.fechaEjecucionEstado}" title="#{obj.fechaEjecucionEstado}" >
                            <f:convertDateTime pattern="yyyy-MM-dd" />
                        </h:outputText>
                    </p:column>
                </p:dataTable>
                <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                    <p:commandButton value="Si" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" style="left:25%"/>
                    <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" style="left:25%"/>
                </p:confirmDialog>
            </h:form>
            
            <!-- Gestionar -->
            <p:dialog id="modalGestionar" header="Gestionar" widgetVar="dialogoGestionar" appendTo="@(body)" fitViewport="true" resizable="false" styleClass="fullscreen-dialog"  >
                <div class="bodyDialog" >
                    <h:form id="frmGestionar" class="formDialogo">
                        <p:scrollPanel mode="native">
                            <p:panel  style="margin-bottom:10px;" toggleable="true">

                                <p:panelGrid id="panel1" columns="4"
                                             columnClasses="ui-grid-col-3,ui-grid-col-3, ui-grid-col-3,ui-grid-col-3"
                                             layout="grid"
                                             styleClass="ui-panelgrid-blank ui-fluid" >
                                    
                                    <h:outputText value="Número Expediente" style="font-weight:bold" class="header-back" />
                                    <h:outputText value="#{cntjTareaBean.objeto.numeroExpediente}"  />
                                    
                                    <h:outputText value="Proceso" style="font-weight:bold" class="header-back" />
                                    <h:outputText value="#{cntjTareaBean.objeto.procesoId.nombre}"  />

                                    <h:outputText value="Estado Actual" style="font-weight:bold" class="header-back" />
                                    <h:outputText value="#{cntjTareaBean.objeto.estadoActual.nombre}"  />

                                    <h:outputText value="Fecha" style="font-weight:bold" class="header-back" />
                                    <p:calendar id="cfechaEjecucion" value="#{cntjTareaBean.objeToEjecucion.fechaEjecucion}"  autocomplete="off" navigator="true" locale="es" pattern="yyyy-MM-dd" size="30" 
                                                maxlength="10" readonlyInput="true" showOn="button" 
                                                mindate="#{cntjTareaBean.objeto.fechaEjecucionEstado}"
                                                maxdate="#{cntjTareaBean.fechaActual}"
                                                readonly="#{cntjTareaBean.modificarFechaGestion}"
                                                />

                                    <h:outputText value="Paso Permitido" style="font-weight:bold" class="header-back" />
                                    <h:outputText rendered="#{cntjTareaBean.listaEstadoSiguiente.size() == 0}" value=""  />
                                    <p:selectOneMenu rendered="#{cntjTareaBean.listaEstadoSiguiente.size() > 0}" id="ctransicion" value="#{cntjTareaBean.objeToEjecucion.cntjEstadoId.id}" required="true" requiredMessage="Paso Permitido: valor obligatorio" >
                                        <f:selectItems value="#{cntjTareaBean.listaEstadoSiguiente}" var="estado" itemValue="#{estado.id}" itemLabel="#{estado.cntjTransicionId.nombre}" itemDescription="#{estado.cntjTransicionId.nombre}" />
                                        <p:ajax event="change" listener="#{cntjTareaBean.validarEstadoSiguiente()}" update="cestadosiguiente,ctransicion"  />
                                    </p:selectOneMenu> 

                                    <h:outputText value="Estado Siguiente" style="font-weight:bold" class="header-back" />
                                    <h:outputText id="cestadosiguiente" value="#{cntjTareaBean.objeToEjecucion.estadoSiguiente}"  />

                                </p:panelGrid>

                                <p:panelGrid columns="2"
                                             columnClasses="ui-grid-col-3,ui-grid-col-9"
                                             layout="grid"
                                             styleClass="ui-panelgrid-blank ui-fluid" >

                                    <p:outputLabel value="Observación" class="header-back" />
                                    <p:column style="margin-right: 4px;">
                                        <p:inputTextarea id="idescripcion" value="#{cntjTareaBean.objeToEjecucion.observacion}" 
                                                         rows="3" cols="140" maxlength="512"  />
                                    </p:column>

                                </p:panelGrid>

                            </p:panel>
                            
                            <p:panel id="panelCampos" header="Campos por Gestionar" style="margin-bottom:10px;" toggleable="true">     
                                <p:accordionPanel widgetVar="basic" 
                                                  value="#{cntjTareaBean.listaCamposTransicion}" 
                                                  var="campoItem" 
                                                  activeIndex="-1" 
                                                  class="acordeon"
                                                  >
                                    <p:tab title="#{campoItem.nombre}"  >
                                        <p:panelGrid columns="1"
                                             columnClasses="ui-grid-col-12"
                                             layout="grid"
                                             styleClass="ui-panelgrid-blank ui-fluid">
                                            
                                            <p:inputTextarea rendered="#{campoItem.tipoDato == 0}" 
                                                             value="#{campoItem.valor}"   
                                                             rows="3" cols="140" maxlength="512"  />

                                            <p:inputNumber rendered="#{campoItem.tipoDato == 1}" 
                                                           value="#{campoItem.valor}" 
                                                           maxlength="32" 
                                                           decimalPlaces="0"  
                                                           thousandSeparator="" 
                                                           emptyValue="empty" 
                                                           readonly="false"  />
                                            
                                            <p:calendar rendered="#{campoItem.tipoDato == 2}" 
                                                        value="#{campoItem.valorDt}" 
                                                        autocomplete="off" 
                                                        navigator="true" 
                                                        pattern="yyyy-MM-dd" 
                                                        locale="es" 
                                                        size="30" 
                                                        maxlength="10" 
                                                        readonlyInput="true"  
                                                        showOn="button" >
                                                <p:ajax event="dateSelect" listener="#{cntjTareaBean.establecerValorCampoDate(campoItem.id, campoItem.existente)}" process="@this" update="@this"  />
                                            </p:calendar>
                                            
                                            <p:selectBooleanButton rendered="#{campoItem.tipoDato == 3}" 
                                                                   value="#{campoItem.valorBl}" 
                                                                   onLabel="Si" 
                                                                   offLabel="No"  
                                                                   onIcon="ui-icon-check" 
                                                                   offIcon="ui-icon-close" 
                                                                   style="width:60px" >
                                                <p:ajax listener="#{cntjTareaBean.establecerValorCampoBoolean(campoItem.id, campoItem.existente)}" update="@this" />
                                            </p:selectBooleanButton>

                                            <p:selectOneMenu rendered="#{campoItem.tipoDato == 4 and campoItem.aplicaMaestro eq true}" 
                                                             value="#{campoItem.valor}" >
                                                <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />
                                                <f:selectItems value="#{cntjTareaBean.consultarMaestroDinamico(campoItem)}" 
                                                               var="mae" 
                                                               itemValue="#{mae.id}" 
                                                               itemLabel="#{mae.nombre}" 
                                                               itemDescription="#{mae.nombre}" />
                                                <p:ajax event="change" listener="#{cntjTareaBean.establecerValorCampoSelect(campoItem)}" process="@this" update="@this"  />
                                            </p:selectOneMenu>

                                            <p:selectOneMenu rendered="#{campoItem.tipoDato == 4 and campoItem.aplicaMaestro eq false}" 
                                                             value="#{campoItem.valor}"  >
                                                <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />
                                                <f:selectItems value="#{cntjTareaBean.consultarMaestroDinamico(campoItem)}" 
                                                               var="mae" itemValue="#{mae.id}" 
                                                               itemLabel="#{mae.nombre}" 
                                                               itemDescription="#{mae.nombre}" />
                                                <p:ajax event="change" listener="#{cntjTareaBean.establecerValorCampoSelect(campoItem)}" process="@this" update="@this"  />
                                            </p:selectOneMenu>

                                            <p:column rendered="#{campoItem.tipoDato == 5}">
                                                <p:inputText value="#{campoItem.valorStr}" readonly="true" pt:data-id="campo-#{campoItem.id}" />
                                                <p:commandButton process="@this"  
                                                                 actionListener="#{cntjTareaBean.listarTerceros(campoItem)}" 
                                                                 icon="pi pi-user" 
                                                                 class="btn-icono"
                                                                 title="Seleccionar contratista" 
                                                                 style="width: 2.3rem; height: 1.6rem;" 
                                                                 />
                                            </p:column>
                                            
                                            <p:column rendered="#{campoItem.tipoDato == 6}">
                                                <div style="width: 100%; display: flex; flex-direction: column; align-items: end; ">
                                                    <p:commandButton process="@this"  
                                                                 actionListener="#{cntjTareaBean.ingresarTextEditor(campoItem)}" 
                                                                 icon="pi pi-file-edit" 
                                                                 class="btn-icono"
                                                                 title="Agregar Contenido" 
                                                                 style="width: 2.3rem; height: 1.6rem;"  />
                                                
                                                    <p:textEditor 
                                                              value="#{campoItem.valor}" 
                                                              allowBlocks="true" 
                                                              allowFormatting="true" 
                                                              allowImages="true" 
                                                              allowLinks="true" 
                                                              allowStyles="true"  
                                                              height="360px" 
                                                              style="width: 100%;"
                                                              toolbarVisible="false"
                                                              readonly="true"
                                                              pt:data-id="campo-#{campoItem.id}" 
                                                              />
                                                </div>
                                            </p:column>
                                                                                        
                                            <p:inputText rendered="#{campoItem.tipoDato == 7}"
                                                value="#{campoItem.valor}" 
                                                pt:data-id="campo-#{campoItem.id}" 
                                                readonly="true"  />
                                            
                                            <p:column rendered="#{campoItem.tipoDato == 8}">
                                                <p:inputText id="cusuario" value="#{campoItem.valorStr}" readonly="true" pt:data-id="campo-#{campoItem.id}"  />
                                                <p:commandButton process="@this"  
                                                                 actionListener="#{cntjTareaBean.listarUsuario(campoItem)}" 
                                                                 icon="pi pi-user" 
                                                                 class="btn-icono"
                                                                 title="Seleccionar usuario" 
                                                                 style="width: 2.3rem; height: 1.6rem;" 
                                                                 update="@this" />
                                            </p:column>

                                            <p:inputNumber rendered="#{campoItem.tipoDato == 9}" 
                                                           id="cvalormoneda" 
                                                           value="#{campoItem.valor}" 
                                                           minValue="0" 
                                                           decimalSeparator=","
                                                           thousandSeparator="."   
                                                           decimalPlaces="0" 
                                                           symbol="$ " 
                                                           symbolPosition="p"  />
                                            
                                             
                                            
                                        </p:panelGrid>
                                    </p:tab>
                                </p:accordionPanel>
                                
                                
                            </p:panel>     
                            
                            <p:panel id="camposGestionados" header="Campos Gestionados"  style="margin-bottom:10px;" toggleable="true" collapsed="true" >
                                <p:accordionPanel widgetVar="ac2" 
                                                  value="#{cntjTareaBean.listaCamposGestionados}" 
                                                  var="itemCampo" 
                                                  activeIndex="-1" 
                                                  class="acordeon"
                                                  >
                                    <p:tab  title="#{itemCampo.nombre}" >
                                        <p:panelGrid columns="1"
                                             columnClasses="ui-grid-col-12"
                                             layout="grid"
                                             styleClass="ui-panelgrid-blank ui-fluid">
                                            
                                            <p:inputTextarea rendered="#{itemCampo.tipoDato == 0}" 
                                                             value="#{itemCampo.valor}"   
                                                             rows="3" cols="140" maxlength="512" 
                                                             disabled="#{cntjTareaBean.permitirModificarValoresGestionados}"
                                                             />

                                            <p:inputNumber rendered="#{itemCampo.tipoDato == 1}" 
                                                           value="#{itemCampo.valor}" 
                                                           maxlength="32" 
                                                           decimalPlaces="0"  
                                                           thousandSeparator="" 
                                                           emptyValue="empty" 
                                                           readonly="false"  
                                                           disabled="#{cntjTareaBean.permitirModificarValoresGestionados}"
                                                           />
                                            
                                            <p:calendar rendered="#{itemCampo.tipoDato == 2}" 
                                                        value="#{itemCampo.valorDt}" 
                                                        autocomplete="off" 
                                                        navigator="true" 
                                                        pattern="yyyy-MM-dd" 
                                                        locale="es" 
                                                        size="30" 
                                                        maxlength="10" 
                                                        readonlyInput="true"  
                                                        showOn="button"
                                                        disabled="#{cntjTareaBean.permitirModificarValoresGestionados}"
                                                        >
                                                <p:ajax event="dateSelect" listener="#{cntjTareaBean.establecerValorCampoDate(itemCampo.id, itemCampo.existente)}" process="@this" update="@this"  />
                                            </p:calendar>
                                            

                                            <p:selectBooleanButton rendered="#{itemCampo.tipoDato == 3}" 
                                                                   value="#{itemCampo.valorBl}" 
                                                                   onLabel="Si" 
                                                                   offLabel="No"  
                                                                   onIcon="ui-icon-check" 
                                                                   offIcon="ui-icon-close" 
                                                                   style="width:60px" 
                                                                   disabled="#{cntjTareaBean.permitirModificarValoresGestionados}"
                                                                   >
                                                <p:ajax listener="#{cntjTareaBean.establecerValorCampoBoolean(itemCampo.id, itemCampo.existente)}" update="@this" />
                                            </p:selectBooleanButton>

                                            <p:selectOneMenu rendered="#{itemCampo.tipoDato == 4 and itemCampo.aplicaMaestro eq true}" 
                                                             value="#{itemCampo.valor}" 
                                                             disabled="#{cntjTareaBean.permitirModificarValoresGestionados}"
                                                             >
                                                <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />
                                                <f:selectItems value="#{cntjTareaBean.consultarMaestroDinamico(itemCampo)}" 
                                                               var="mae" 
                                                               itemValue="#{mae.id}" 
                                                               itemLabel="#{mae.nombre}" 
                                                               itemDescription="#{mae.nombre}" />
                                                <p:ajax event="change" listener="#{cntjTareaBean.establecerValorCampoSelect(itemCampo)}" process="@this" update="@this"  />
                                            </p:selectOneMenu>

                                            <p:selectOneMenu rendered="#{itemCampo.tipoDato == 4 and itemCampo.aplicaMaestro eq false}" 
                                                             value="#{itemCampo.valor}" 
                                                             disabled="#{cntjTareaBean.permitirModificarValoresGestionados}"
                                                             >
                                                <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />
                                                <f:selectItems value="#{cntjTareaBean.consultarMaestroDinamico(itemCampo)}" 
                                                               var="mae" itemValue="#{mae.id}" 
                                                               itemLabel="#{mae.nombre}" 
                                                               itemDescription="#{mae.nombre}" />
                                                <p:ajax event="change" listener="#{cntjTareaBean.establecerValorCampoSelect(itemCampo)}" process="@this" update="@this"  />
                                            </p:selectOneMenu>

                                            <p:column rendered="#{itemCampo.tipoDato == 5}">
                                                <p:inputText value="#{itemCampo.valorStr}" readonly="true" pt:data-id="campo-#{itemCampo.id}" />
                                                <p:commandButton process="@this"  
                                                                 actionListener="#{cntjTareaBean.listarTerceros(itemCampo)}" 
                                                                 icon="pi pi-user" 
                                                                 class="btn-icono"
                                                                 title="Seleccionar contratista" 
                                                                 style="width: 2.3rem; height: 1.6rem;" 
                                                                 disabled="#{cntjTareaBean.permitirModificarValoresGestionados}"
                                                                 />
                                            </p:column>
                                            
                                            <p:column rendered="#{itemCampo.tipoDato == 6}">
                                                <div style="width: 100%; display: flex; flex-direction: column; align-items: end; ">
                                                    <p:commandButton process="@this"  
                                                                 actionListener="#{cntjTareaBean.ingresarTextEditor(itemCampo)}" 
                                                                 icon="pi pi-file-edit" 
                                                                 class="btn-icono"
                                                                 title="Agregar Contenido" 
                                                                 style="width: 2.3rem; height: 1.6rem;" 
                                                                 disabled="#{cntjTareaBean.permitirModificarValoresGestionados}"
                                                                 />
                                                
                                                    <p:textEditor 
                                                              value="#{itemCampo.valor}" 
                                                              allowBlocks="true" 
                                                              allowFormatting="true" 
                                                              allowImages="true" 
                                                              allowLinks="true" 
                                                              allowStyles="true"  
                                                              height="360px" 
                                                              style="width: 100%;"
                                                              toolbarVisible="false"
                                                              readonly="true"
                                                              pt:data-id="campo-#{itemCampo.id}" 
                                                              />
                                                </div>
                                            </p:column>
                                            
                                            
                                            <p:inputText rendered="#{itemCampo.tipoDato == 7}"
                                                value="#{itemCampo.valor}" 
                                                pt:data-id="campo-#{itemCampo.id}" 
                                                readonly="true"  
                                                disabled="#{cntjTareaBean.permitirModificarValoresGestionados}"
                                                />
                                            

                                            <p:column rendered="#{itemCampo.tipoDato == 8}">
                                                <p:inputText id="cusuario" value="#{itemCampo.valorStr}" readonly="true" pt:data-id="campo-#{itemCampo.id}"  />
                                                <p:commandButton process="@this"  
                                                                 actionListener="#{cntjTareaBean.listarUsuario(itemCampo)}" 
                                                                 icon="pi pi-user" 
                                                                 class="btn-icono"
                                                                 title="Seleccionar usuario" 
                                                                 style="width: 2.3rem; height: 1.6rem;" 
                                                                 update="@this" 
                                                                 disabled="#{cntjTareaBean.permitirModificarValoresGestionados}"
                                                                 />
                                            </p:column>

                                            <p:inputNumber rendered="#{itemCampo.tipoDato == 9}" 
                                                           id="cvalormoneda" 
                                                           value="#{itemCampo.valor}" 
                                                           minValue="0" 
                                                           decimalSeparator=","
                                                           thousandSeparator="."   
                                                           decimalPlaces="0" 
                                                           symbol="$ " 
                                                           symbolPosition="p"
                                                           disabled="#{cntjTareaBean.permitirModificarValoresGestionados}"
                                                           />
                                            
                                             
                                            
                                        </p:panelGrid>
                                    </p:tab>
                                </p:accordionPanel>
                            </p:panel>

                            <p:panel header="Ajuntos" style="margin-bottom:10px;" toggleable="true">  
                                <div align="right" class="contenedor-opciones"> 
                                    <p:commandButton rendered="#{cntjTareaBean.accionAdicional2}" title="Agregar Adjunto" process="@form" immediate="true" actionListener="#{cntjTareaBean.agregarAdjunto()}" icon="pi pi-plus-circle" class="btn-icono" />
                                </div>
                                <p:dataTable id="tablaAdjuntos" class="listaDatos" widgetVar="tblWidgetAdj" var="adjunto" value="#{cntjTareaBean.listaAdjuntos}"
                                             rows="#{cntjTareaBean.tamanoPagina}" paginator="true" lazy="false" reflow="true"
                                             currentPageReportTemplate="Registros del {startRecord} al {endRecord} de {totalRecords}, Página {currentPage} de {totalPages}"
                                             paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                             rowsPerPageTemplate="5,10,30,50,100" 
                                             emptyMessage= "No se encontraron registros" >

                                    <p:column headerText="Acción" >                                        
                                        <p:commandButton title="Eliminar adjunto" actionListener="#{cntjTareaBean.eliminarAdjunto(adjunto.id)}" process="@this" update="frmGestionar:tablaAdjuntos" icon="pi pi-trash"  class="btn-icono" >
                                            <p:confirm header="Confirmación" message="¿Está seguro que desea borrar el registro?" icon="ui-icon-alert" />
                                        </p:commandButton>
                                    </p:column>

                                    <p:column headerText="Documento" >                                        
                                        <h:outputText value="#{adjunto.nombre}"/>
                                    </p:column>

                                </p:dataTable>
                                                                
                            </p:panel>
                        </p:scrollPanel>
                        
                        <p:panelGrid class="footerdialog">
                            <f:facet name="footer">
                                <p:row>
                                    <p:column colspan="6" style="text-align: center">        
                                        <p:commandButton value="Guardar Borrador" class="boton btn-azul" actionListener="#{cntjTareaBean.guardarBorrador()}" validateClient="true" process="@form" update="@form" />   
                                        <p:commandButton value="Previsualizar Documento" class="boton btn-azul" actionListener="#{cntjTareaBean.previsualizarDocumentos()}" update="@form" />   
                                        <p:commandButton value="Avanzar" class="boton btn-azul" actionListener="#{cntjTareaBean.guardarGestion()}" validateClient="true" process="@form" update="@form" />   
                                        <p:commandButton value="Salir" class="boton btn-oscuro" type="button" onclick="PF('dialogoGestionar').hide()" immediate="true" style="margin-left: 5px;"/>                                        
                                    </p:column>
                                </p:row>
                            </f:facet>
                        </p:panelGrid>

                    </h:form>
                </div>
            </p:dialog> 
            
            <!-- Listar documentos -->
            <p:dialog header="Documentos" widgetVar="dialogoDocumentos"  appendTo="@(body)" modal="true" position="center" width="90%"  style="height: auto;"  >
                <div class="bodyDialog" >
                    <h:form id="frmDocumentos" class="formDialogo">

                        <p:dataTable id="tablaRegistros" var="doc" class="listaDatos" value="#{cntjTareaBean.lazyDocumentos}"  paginator="true" rows="#{cntjTareaBean.tamanoPagina}" 
                                     emptyMessage="No se encontraron registros"
                                     currentPageReportTemplate="Registros del {startRecord} al {endRecord} de {totalRecords}, Página {currentPage} de {totalPages}"
                                     paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                     rowsPerPageTemplate="5,10,30,50,100"  lazy="true"
                                     widgetVar="tablaWidget"
                                     style="font-size:11px;"
                                     scrollable="false"
                                     scrollWidth="140%"
                                     rowKey="#{obj.id}" reflow="true">

                            <p:column headerText="Opciones" style="text-align: center;">
                                <p:commandButton id="btndesc" icon="pi pi-cloud-download" class="btn-icono"    
                                                 rendered="#{doc.documentoExiste == true}"
                                                 title="Descargar documento" 
                                                 actionListener="#{cntjTareaBean.descargarDocumento(doc)}" 
                                                 ajax="false" 
                                                 immediate="true"
                                                 process="@this"/>
                                <p:commandButton rendered="#{cntjTareaBean.accionAdicional3}" title="Ver Documento" actionListener="#{cntjTareaBean.visualizardocumentos(doc.id)}"   icon="pi pi-search" class="btn-icono"/>
                            </p:column>

                            <p:column headerText="Documento" filterBy="#{doc.nombre}"  >
                                <f:facet name="filter">
                                    <p:inputText label="Responsable" maxlength="128" style="width: 95%;" 
                                                 onkeypress="if (event.keyCode === 13) { onchange(); return false; }" 
                                                 onchange="PF('tablaWidget').filter()"/>
                                </f:facet>
                                <h:outputText value="#{doc.nombre}" title="#{doc.nombre}"/>
                            </p:column>

                            <p:column headerText="Tipo"  >
                                <h:outputText value="#{cntjTareaBean.getTipoDocumento(doc.tipo)}" title="#{cntjTareaBean.getTipoDocumento(doc.tipo)}" />
                            </p:column>

                            <p:column headerText="Fecha Generación" >
                                <h:outputText value="#{doc.fechaHoraCrea}" title="#{doc.fechaHoraCrea}">
                                    <f:convertDateTime pattern="yyyy-MM-dd" />
                                </h:outputText>
                            </p:column>

                        </p:dataTable>

                        <p:panelGrid id="panelCrear" class="footerdialog" style="width: 100%;">
                            <f:facet name="footer">
                                <p:row>
                                    <p:column colspan="6" style="text-align: center">
                                        <p:commandButton value="Salir" class="boton btn-oscuro"  type="button" onclick="PF('dialogoDocumentos').hide()" immediate="true" style="margin-left: 5px;"/>
                                    </p:column>
                                </p:row>
                            </f:facet>
                        </p:panelGrid>

                    </h:form>
                </div>
            </p:dialog> 
            
            <!-- Agregar campo -->
            <p:dialog id="modalAddCampo" header="Agregar Campos" widgetVar="dialogoAddCampo"  appendTo="@(body)" position="center" width="50%" modal="true" fitViewport="true" resizable="false"  >
                <div class="bodyDialogFull" >
                    <h:form id="frmAddCampo" class="formDialogo">
                        <p:scrollPanel mode="native" >
                            <p:panel header="Información del campo" style="margin-bottom:10px;" toggleable="true">

                                <p:panelGrid  columns="2"
                                              columnClasses="ui-grid-col-4,ui-grid-col-8"
                                              layout="grid"
                                              styleClass="ui-panelgrid-blank ui-fluid" >

                                    <h:outputText value="Campo" style="font-weight:bold" class="header-back" />
                                    <p:selectOneMenu  id="ctransicion" value="#{cntjTareaBean.objetoCampo.nombre}" >
                                        <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />
                                        <f:selectItems value="#{cntjTareaBean.listaCampos}" var="campo" itemValue="#{campo.nombre}" itemLabel="#{campo.nombre}" itemDescription="#{campo.nombre}" />
                                        <p:ajax event="change" listener="#{cntjTareaBean.validarTipoCampo()}" update="frmAddCampo"  />
                                    </p:selectOneMenu> 

                                    <h:outputText rendered="#{cntjTareaBean.objetoCampo.tipoDato != null and cntjTareaBean.objetoCampo.tipoDato != 6}" value="Valor" style="font-weight:bold" class="header-back" />
                                    <p:inputTextarea rendered="#{cntjTareaBean.objetoCampo.tipoDato == 0}" id="cvalor" 
                                                     value="#{cntjTareaBean.objetoCampo.valor}" 
                                                     required="true" requiredMessage="Valor: debe ingresar el valor."    
                                                     rows="3" cols="140" maxlength="512"  />
                                        
                                        

                                    <p:calendar rendered="#{cntjTareaBean.objetoCampo.tipoDato == 2}" id="cvalor1"  value="#{cntjTareaBean.objetoCampo.valorDt}" autocomplete="off" navigator="true" pattern="yyyy-MM-dd" locale="es" size="30" required="true" requiredMessage="Valor: debe ingresar el valor." 
                                                maxlength="10" readonlyInput="true"  showOn="button"  />

                                    <p:inputNumber rendered="#{cntjTareaBean.objetoCampo.tipoDato == 1}" id="cvalor2" value="#{cntjTareaBean.objetoCampo.valor}" maxlength="32" decimalPlaces="0"  thousandSeparator="" emptyValue="empty" readonly="false" required="true" requiredMessage="Valor: debe ingresar el valor."   />

                                    <p:selectBooleanButton rendered="#{cntjTareaBean.objetoCampo.tipoDato == 3}" id="cvalor3" value="#{cntjTareaBean.objetoCampo.valor}" onLabel="Si" offLabel="No"  onIcon="ui-icon-check" offIcon="ui-icon-close" style="width:60px" />

                                    <p:selectOneMenu rendered="#{cntjTareaBean.objetoCampo.tipoDato == 4 and cntjTareaBean.objetoCampo.aplicaMaestro eq true}" id="cvalor4" value="#{cntjTareaBean.objetoCampo.valor}" >
                                        <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />
                                        <f:selectItems value="#{cntjTareaBean.listaMaestroCampo}" var="mae" itemValue="#{mae.id}" itemLabel="#{mae.nombre}" itemDescription="#{mae.nombre}" />
                                    </p:selectOneMenu>

                                    <p:selectOneMenu rendered="#{cntjTareaBean.objetoCampo.tipoDato == 4 and cntjTareaBean.objetoCampo.aplicaMaestro eq false}" id="cvalor5" value="#{cntjTareaBean.objetoCampo.valor}" required="true" requiredMessage="Valor: Debe seleccionar una opción."  >
                                        <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />
                                        <f:selectItems value="#{cntjTareaBean.listaMaestroCampo}" var="mae" itemValue="#{mae.id}" itemLabel="#{mae.nombre}" itemDescription="#{mae.nombre}" />
                                    </p:selectOneMenu>

                                    <p:column rendered="#{cntjTareaBean.objetoCampo.tipoDato == 5}">
                                        <p:inputText id="ctercero" value="#{cntjTareaBean.tercero.razonSocial}" readonly="true" required="true" requiredMessage="Valor: Debe seleccionar un registro para este campo." />
                                        <p:commandButton process="@this"  actionListener="#{cntjTareaBean.listarTerceros()}" icon="pi pi-user" class="btn-icono"
                                                         title="Seleccionar contratista" style="width: 2.3rem; height: 1.6rem;" update="ctercero" />
                                    </p:column>

                                    <p:column rendered="#{cntjTareaBean.objetoCampo.tipoDato == 8}">
                                        <p:inputText id="cusuario" value="#{cntjTareaBean.usuario.nombre}" readonly="true" required="true" requiredMessage="Valor: Debe seleccionar un registro para este campo." />
                                        <p:commandButton process="@this"  actionListener="#{cntjTareaBean.listarUsuario()}" icon="pi pi-user" class="btn-icono"
                                                         title="Seleccionar usuario" style="width: 2.3rem; height: 1.6rem;" update="cusuario" />
                                    </p:column>

                                    <p:inputNumber rendered="#{cntjTareaBean.objetoCampo.tipoDato == 9}" 
                                                   id="cvalormoneda" 
                                                   value="#{cntjTareaBean.objetoCampo.valor}" 
                                                   minValue="0" 
                                                   decimalSeparator=","
                                                   thousandSeparator="."   
                                                   decimalPlaces="0" 
                                                   symbol="$ " 
                                                   symbolPosition="p" 
                                                   required="true" 
                                                   requiredMessage="Valor: debe ingresar el valor."  />

                                </p:panelGrid>


                            </p:panel>

                            <p:panel header="Valor" rendered="#{cntjTareaBean.objetoCampo.tipoDato == 6}" style="margin-bottom:4rem;" toggleable="true" >

                                <pe:sunEditor id="eestructura" 
                                              value="#{cntjTareaBean.objetoCampo.valor}" 
                                              height="auto" 
                                              width="100%" 
                                              secure='true' 
                                              required="true" 
                                              styleClass="editorSunSmall"
                                              requiredMessage="Debe diligenciar la estructura."
                                              locale="es"
                                              style="min-height: 90px !important;"
                                              toolbar="[
                                              ['font', 'fontSize', 'formatBlock'],
                                              ['bold', 'underline', 'italic', 'strike', 'subscript', 'superscript'],
                                              ['fontColor', 'hiliteColor', 'textStyle'],
                                              ['removeFormat'],
                                              ['undo', 'redo'],
                                              ['indent', 'outdent'],
                                              ['align', 'horizontalRule', 'list', 'table', 'image']
                                              ]"
                                              />
                                
                                
                                
                            </p:panel> 
                        </p:scrollPanel>
                        
                        <p:panelGrid id="panelCrear" class="footerdialog">
                            <f:facet name="footer">
                                <p:remoteCommand name="guardarCamposRemoto" action="#{cntjTareaBean.guardarCampos()}" validateClient="true" process="@form" update="@form" />
                            </f:facet>
                        </p:panelGrid>

                    </h:form>
                </div>
                <div class="nuevoFooter">
                    <p:button value="Agregar" class="boton btn-azul" onclick="guardarCamposRemoto(); return false;"  />                    
                    <p:button value="Salir" class="boton btn-oscuro" onclick="PF('dialogoAddCampo').hide(); return false;"  />                    
                </div>
            </p:dialog> 
            
            <!-- Agregar adjunto gestion -->
            <p:dialog header="Crear Adjunto" widgetVar="dialogoCrearAdjunto" appendTo="@(body)" modal="true"  width="50%" >
                <div class="bodyDialog200">
                    <h:form id="frmCrearAdjunto" >  
                        <p:panel>
                            <p:panelGrid id="panelCrearAdjunto" columns="2" 
                                         columnClasses="ui-grid-col-4, ui-grid-col-8"
                                         layout="grid" 
                                         styleClass="ui-panelgrid-blank ui-fluid">

                                <h:outputText value="Documento"  class="header-back" />
                                <p:selectOneMenu id="adTipo" value="#{cntjTareaBean.adjunto.estadoDocumento.procesodocumentoId.id}" filter="true" filterMatchMode="contains" required="true" requiredMessage="Documento: Valor obligatorio." >
                                    <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />
                                    <f:selectItems value="#{cntjTareaBean.listaEstadoDocumento}" var="tipo" itemLabel="#{tipo.procesodocumentoId.nombre}" itemValue="#{tipo.procesodocumentoId.id}" />
                                    <p:ajax event="change" update="adTipo"/>
                                </p:selectOneMenu>

                            </p:panelGrid>

                            <p:panelGrid columns="1" class="footerUpload" >
                                <f:facet name="footer">
                                    <p:fileUpload id="cargarDocumentoInforme" 
                                                  label="Agregar Documento" 
                                                  uploadLabel="Subir"
                                                  cancelLabel="Cancelar"
                                                  fileLimitMessage="Máximo número de archivos excedido, los permitidos son: 1" 
                                                  invalidFileMessage="Tipo inválido de archivo"
                                                  invalidSizeMessage="Tamaño del archivo no permitivo, tamaño máximo permitido es : 10 mb."                                                      
                                                  listener="#{cntjTareaBean.adjuntarArchivo}" 
                                                  mode="advanced" 
                                                  dragDropSupport="false"
                                                  required="true" 
                                                  requiredMessage="Se debe agregar un Documento." 
                                                  fileLimit="1" 
                                                  allowTypes="/(\.|\/)(pdf|PDF)$/"
                                                  multiple="false"
                                                  sizeLimit="10000000"/>
                                </f:facet>

                            </p:panelGrid>
                        </p:panel>                   
                    </h:form>
                </div>
            </p:dialog> 
            
            <!-- Dialogo listar terceros -->
            <p:dialog header="Consultar Tercero" widgetVar="dialogoListaTercero" appendTo="@(body)" modal="true" style="max-width: 90%;max-height: 90%;" dynamic="true">
                <p:scrollPanel mode="native" style="max-height: 500px; padding-bottom: 0px !important;" >
                    <h:form id="frmTerceroLista">
                        <div align="right">
                            <p:commandButton title="Refrescar" actionListener="#{cntjTareaBean.refrescarTerceros()}"  icon="ui-icon-refresh"/>
                        </div>
                        <p:panelGrid style="height:auto;" columns="1">

                            <p:dataTable id="tablaTerceros" class="listaDatos" widgetVar="tablaWidgetTercero" var="obj" value="#{cntjTareaBean.lazyTerceros}" rowKey="#{obj.id}"
                                         rows="#{cntjTareaBean.tamanoPagina}" paginator="true" lazy="true" reflow="true"
                                         currentPageReportTemplate="Registros del {startRecord} al {endRecord} de {totalRecords}, Página {currentPage} de {totalPages}"
                                         paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                         rowsPerPageTemplate="5,10,30,50,100" 
                                         emptyMessage= "No se encontraron registros" selectionMode="single">

                                <p:ajax event="rowSelect" listener="#{cntjTareaBean.onRowSelectTercero}"/>

                                <p:column headerText="Tipo" filterBy="#{obj.tipoTercero}"  >        
                                    <f:facet name="filter">
                                        <p:selectOneMenu onchange="PF('tablaWidget').filter()" style="width: 80%;">
                                            <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />
                                            <f:selectItems value="#{cntjTareaBean.listaTipoTercero}" var="tipo" itemValue="#{tipo.id}" itemLabel="#{tipo.nombre}" itemDescription="#{tipo.descripcion}" />
                                        </p:selectOneMenu>
                                    </f:facet>
                                    <h:outputText value="#{cntjTareaBean.getTipoTerceroStr(obj.tipoTercero)}"/>
                                </p:column>

                                <p:column headerText="Tipo Documento" filterBy="#{obj.maeTipoDocumentoId}"  > 
                                    <f:facet name="filter">
                                        <p:selectOneMenu onchange="PF('tablaWidget').filter()" style="width: 80%;" filter="true" filterMatchMode="contains">
                                            <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />
                                            <f:selectItems value="#{cntjTareaBean.listaTipoDocumentoTercero}" var="tipo" itemValue="#{tipo.id}" itemLabel="#{tipo.nombre}" itemDescription="#{tipo.descripcion}" />
                                        </p:selectOneMenu>
                                    </f:facet>
                                    <h:outputText value="#{obj.maeTipoDocumentoValor}"/>
                                </p:column>

                                <p:column headerText="Documento" filterBy="#{obj.numeroDocumento}" >
                                    <f:facet name="filter">
                                        <p:inputText label="Documento" maxlength="128" style="width: 95%;" onchange="PF('tablaWidget').filter()"/>
                                    </f:facet>
                                    <h:outputText value="#{obj.numeroDocumento}" />
                                </p:column>

                                <p:column headerText="Nombre/Razón Social" filterBy="#{obj.razonSocial}" >
                                    <f:facet name="filter">
                                        <p:inputText maxlength="128" onkeypress="if (event.keyCode === 13) {
                                                    onchange();
                                                    return false;
                                                }" style="width: 95%;" onchange="PF('tablaWidget').filter()"/>
                                    </f:facet>
                                    <h:outputText value="#{obj.razonSocial}"/>
                                </p:column>

                            </p:dataTable>

                        </p:panelGrid>
                    </h:form>
                </p:scrollPanel>
            </p:dialog>
            
            <!-- Modifiar campo -->
            <p:dialog id="modalModificarCampo" header="Modificar Campos" widgetVar="dialogoModificarCampo"  appendTo="@(body)" position="center" width="50%" modal="true" fitViewport="true" resizable="false"  >
                <div class="bodyDialogFull" >
                    <h:form id="frmModificarCampo" class="formDialogo">
                        <p:scrollPanel mode="native" >
                            <p:panel header="Información del campo" style="margin-bottom:10px;" toggleable="true">

                                <p:panelGrid  columns="2"
                                              columnClasses="ui-grid-col-4,ui-grid-col-8"
                                              layout="grid"
                                              styleClass="ui-panelgrid-blank ui-fluid" >

                                    <h:outputText value="Campo" style="font-weight:bold" class="header-back" />
                                    <h:outputText value="#{cntjTareaBean.objetoCampo.nombre}" />
                                    

                                    <h:outputText rendered="#{cntjTareaBean.objetoCampo.tipoDato != null and cntjTareaBean.objetoCampo.tipoDato != 6}" value="Valor" style="font-weight:bold" class="header-back" />
                                    <p:inputTextarea rendered="#{cntjTareaBean.objetoCampo.tipoDato == 0}" id="cvalor" 
                                                     value="#{cntjTareaBean.objetoCampo.valor}" 
                                                     required="true" requiredMessage="Valor: debe ingresar el valor."    
                                                     rows="3" cols="140" maxlength="512"  />
                                        
                                        

                                    <p:calendar rendered="#{cntjTareaBean.objetoCampo.tipoDato == 2}" id="cvalor1"  value="#{cntjTareaBean.objetoCampo.valorDt}" autocomplete="off" navigator="true" pattern="yyyy-MM-dd" locale="es" size="30" required="true" requiredMessage="Valor: debe ingresar el valor." 
                                                maxlength="10" readonlyInput="true"  showOn="button"  />

                                    <p:inputNumber rendered="#{cntjTareaBean.objetoCampo.tipoDato == 1}" id="cvalor2" value="#{cntjTareaBean.objetoCampo.valor}" maxlength="32" decimalPlaces="0"  thousandSeparator="" emptyValue="empty" readonly="false" required="true" requiredMessage="Valor: debe ingresar el valor."   />

                                    <p:selectBooleanButton rendered="#{cntjTareaBean.objetoCampo.tipoDato == 3}" id="cvalor3" value="#{cntjTareaBean.objetoCampo.valor}" onLabel="Si" offLabel="No"  onIcon="ui-icon-check" offIcon="ui-icon-close" style="width:60px" />

                                    <p:selectOneMenu rendered="#{cntjTareaBean.objetoCampo.tipoDato == 4 and cntjTareaBean.objetoCampo.aplicaMaestro eq true}" id="cvalor4" value="#{cntjTareaBean.objetoCampo.valor}" >
                                        <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />
                                        <f:selectItems value="#{cntjTareaBean.listaMaestroCampo}" var="mae" itemValue="#{mae.id}" itemLabel="#{mae.nombre}" itemDescription="#{mae.nombre}" />
                                    </p:selectOneMenu>

                                    <p:selectOneMenu rendered="#{cntjTareaBean.objetoCampo.tipoDato == 4 and cntjTareaBean.objetoCampo.aplicaMaestro eq false}" id="cvalor5" value="#{cntjTareaBean.objetoCampo.valor}" required="true" requiredMessage="Valor: Debe seleccionar una opción."  >
                                        <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />
                                        <f:selectItems value="#{cntjTareaBean.listaMaestroCampo}" var="mae" itemValue="#{mae.id}" itemLabel="#{mae.nombre}" itemDescription="#{mae.nombre}" />
                                    </p:selectOneMenu>

                                    <p:column rendered="#{cntjTareaBean.objetoCampo.tipoDato == 5}">
                                        <p:inputText id="ctercero" value="#{cntjTareaBean.tercero.razonSocial}" readonly="true" required="true" requiredMessage="Valor: Debe seleccionar un registro para este campo." />
                                        <p:commandButton process="@this"  actionListener="#{cntjTareaBean.listarTerceros()}" icon="pi pi-user" class="btn-icono"
                                                         title="Seleccionar contratista" style="width: 2.3rem; height: 1.6rem;" update="ctercero" />
                                    </p:column>

                                </p:panelGrid>


                            </p:panel>

                            <p:panel header="Valor" rendered="#{cntjTareaBean.objetoCampo.tipoDato == 6}" style="margin-bottom:4rem;" toggleable="true" >

                                <pe:sunEditor id="eestructura" 
                                              value="#{cntjTareaBean.objetoCampo.valor}" 
                                              height="auto" 
                                              width="100%" 
                                              secure='true' 
                                              required="true" 
                                              styleClass="editorSunSmall"
                                              requiredMessage="Debe diligenciar la estructura."
                                              locale="es"
                                              style="min-height: 90px !important;"
                                              toolbar="[
                                              ['font', 'fontSize', 'formatBlock'],
                                              ['bold', 'underline', 'italic', 'strike', 'subscript', 'superscript'],
                                              ['fontColor', 'hiliteColor', 'textStyle'],
                                              ['removeFormat'],
                                              ['undo', 'redo'],
                                              ['indent', 'outdent'],
                                              ['align', 'horizontalRule', 'list', 'table', 'image']
                                              ]"
                                              />
                                
                            </p:panel> 
                        </p:scrollPanel>
                        
                        <p:panelGrid id="panelCrear" class="footerdialog">
                            <f:facet name="footer">
                                <p:remoteCommand name="modificarCamposRemoto" action="#{cntjTareaBean.modificarCampos()}" validateClient="true" process="@form" update="@form" />
                            </f:facet>
                        </p:panelGrid>

                    </h:form>
                </div>
                <div class="nuevoFooter">
                    <p:button value="Modificar" class="boton btn-azul" onclick="modificarCamposRemoto(); return false;"  />                    
                    <p:button value="Salir" class="boton btn-oscuro" onclick="PF('dialogoModificarCampo').hide(); return false;"  />                    
                </div>
            </p:dialog> 
            
            <!-- Dialogo listar usuarios -->
            <p:dialog header="Consultar Usuarios" widgetVar="dialogoUsuariosLista" appendTo="@(body)" modal="true" style="max-width: 90%;max-height: 90%;" dynamic="true">
                <p:scrollPanel mode="native" style="max-height: 500px; padding-bottom: 0px !important;" >
                    <h:form id="frmUsuariosLista">
                        <div align="right">
                            <p:commandButton rendered="#{cntjTareaBean.accionListar}" title="Refrescar" actionListener="#{cntjTareaBean.refrescarUsuarios()}" oncomplete="PF('tablaWidgetUsuarios').filter()" icon="ui-icon-refresh"/>
                        </div>
                        <p:panelGrid id="panelUsuariosLista" style="height:auto;" columns="1">

                            <p:dataTable id="tablaRegistrosUsuarios" class="listaDatos" widgetVar="tablaWidgetUsuarios" var="obj" value="#{cntjTareaBean.lazyUsuarios}" rowKey="#{obj.id}"
                                         rows="#{cntjTareaBean.tamanoPagina}" paginator="true" lazy="true" reflow="true"
                                         currentPageReportTemplate="Registros del {startRecord} al {endRecord} de {totalRecords}, Página {currentPage} de {totalPages}"
                                         paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                                         rowsPerPageTemplate="5,10,30,50,100" 
                                         emptyMessage= "No se encontraron registros" selectionMode="single">
                                <p:ajax event="rowSelect" listener="#{cntjTareaBean.onRowSelectUsuario}"/>
                                <p:column headerText="Nombre" filterBy="#{obj.nombre}">
                                    <f:facet name="filter">
                                        <p:inputText label="Nombre" maxlength="128" style="width: 95%;" onchange="PF('tablaWidgetUsuarios').filter()"/>
                                    </f:facet>
                                    <h:outputText value="#{obj.nombre}"/>
                                </p:column>

                                <p:column headerText="Activo">
                                    <h:outputText value="#{obj.activoStr}"/>
                                </p:column>

                            </p:dataTable>

                        </p:panelGrid>
                    </h:form>
                </p:scrollPanel>
            </p:dialog>
            
            <!-- Dialogo visualizar documento -->
            <p:dialog header="Visualizar Documento" widgetVar="dialogoVisualizarDoc" appendTo="@(body)" fitViewport="true" resizable="false" styleClass="fullscreen-dialog" onShow="visualizarPdfFullPagina('frmVisualizaDoc:infoPdf','pdfViewer');"   >
                <div class="bodyDialogFull" style="height: 100%; position: relative; overflow: hidden !important;" >
                    <h:form id="frmVisualizaDoc" style="height: 100%; overflow: auto;" >
                        
                        <p:panel  style="margin-bottom:10px; border: 0px;"   >
                                <p:panelGrid columns="2"
                                             columnClasses="ui-grid-col-3,ui-grid-col-9"
                                             layout="grid"
                                             styleClass="ui-panelgrid-blank ui-fluid" >

                                     <h:outputText value="Documento" style="font-weight:bold" class="header-back" />
                                     <h:outputText value="#{cntjTareaBean.objDocumento.documentoNombre}"  />

                                </p:panelGrid>

                            </p:panel>
                        
                        <h:inputHidden id="infoPdf" value="#{cntjTareaBean.contenidoPdf}" />
                        <div id="pdfViewer" style="height:100%; display: flex;flex-direction: column;align-items: center;" ></div>
                        
                    </h:form>
                </div>  
                <div class="nuevoFooter">
                    <p:button value="Salir" class="boton btn-oscuro" onclick="PF('dialogoVisualizarDoc').hide(); return false;"  />                    
                </div>
            </p:dialog>
            
            <!-- Editor de texto -->
            <p:dialog id="modalAddEditTest" header="Editor de Texto" widgetVar="dialogoAddEditTest"  appendTo="@(body)" fitViewport="true" resizable="false" styleClass="fullscreen-dialog" 
                      onShow="cargarEstructuraSunEditor();" onHide="removerFoco()" >
                <div class="bodyDialogFull" >
                    <h:form id="frmAddEditTest" class="formDialogo">
                        <p:scrollPanel mode="native" >                            
                            <p:panel header="Valor" style="margin-bottom:4rem;" toggleable="true" >

                                <h:inputHidden id="hiddenFormato" value="#{cntjTareaBean.objCampoAux.valorStr}" />
                                <pe:sunEditor id="eestructura" 
                                              value="#{cntjTareaBean.objCampoAux.valor}" 
                                              height="auto" 
                                              width="100%" 
                                              secure='true' 
                                              required="true" 
                                              styleClass="editorSun"
                                              style="height: auto; min-height: 500px;"
                                              requiredMessage="Debe diligenciar información."
                                              locale="es"
                                              toolbar="[
                                              ['font', 'fontSize', 'formatBlock'],
                                              ['bold', 'underline', 'italic', 'strike', 'subscript', 'superscript'],
                                              ['fontColor', 'hiliteColor', 'textStyle'],
                                              ['removeFormat'],
                                              ['undo', 'redo'],
                                              ['indent', 'outdent'],
                                              ['align', 'horizontalRule', 'list', 'table', 'image']
                                              ]"
                                              />
                                
                                
                                
                            </p:panel> 
                        </p:scrollPanel>
                        
                        <p:panelGrid id="panelCrear" class="footerdialog">
                            <f:facet name="footer">
                                <p:remoteCommand name="guardarEditorTextoRemoto" action="#{cntjTareaBean.guardarTextEditor()}" validateClient="true" process="@form" update="@form" />
                            </f:facet>
                        </p:panelGrid>

                    </h:form>
                </div>
                <div class="nuevoFooter">
                    <p:button value="Agregar" class="boton btn-azul" onclick="guardarEditorTextoRemoto(); return false;"  />                    
                    <p:button value="Salir" class="boton btn-oscuro" onclick="PF('dialogoAddEditTest').hide(); return false;"  />                    
                </div>
            </p:dialog> 
            
             <!-- Dialogo visualizar documento -->
            <p:dialog header="Previsualizar Documento" widgetVar="dialogoPreVisualizarDoc" appendTo="@(body)" fitViewport="true" resizable="false" styleClass="fullscreen-dialog" >
                <div class="bodyDialogFull" style="height: 100%; position: relative; overflow: hidden !important;"  >
                    <h:form id="frmPreVisualizaDoc" style="height: 100%; overflow: auto;" >
                        
                        <p:panel  style="margin-bottom:10px; border: 0px;"   >
                                <p:panelGrid columns="2"
                                             columnClasses="ui-grid-col-3,ui-grid-col-9"
                                             layout="grid"
                                             styleClass="ui-panelgrid-blank ui-fluid" >

                                    <h:outputText value="Documento" style="font-weight:bold" class="header-back" />
                                    <p:selectOneMenu value="#{cntjTareaBean.objPlantilla.id}" >
                                        <f:selectItem itemLabel=" -- " itemValue="#{null}" noSelectionOption="true" />
                                        <f:selectItems value="#{cntjTareaBean.listaPrevisualizacion}" 
                                                       var="item" 
                                                       itemValue="#{item.id}" 
                                                       itemLabel="#{item.procesodocumentoId.nombre}" 
                                                       itemDescription="#{item.procesodocumentoId.nombre}" />
                                        <p:ajax event="change" listener="#{cntjTareaBean.previsualizaDocumento()}" process="@this" update="@this"  />
                                    </p:selectOneMenu>

                                </p:panelGrid>

                            </p:panel>
                        
                        <p:outputPanel rendered="#{not empty cntjTareaBean.contenidoPdf}">
                            <!-- <iframe  src="data:application/pdf;base64,#{cntjTareaBean.contenidoPdf}"
                                     width="100%" height="100%" style="border: none;"></iframe> -->
                            <h:inputHidden id="infoPdf" value="#{cntjTareaBean.contenidoPdf}" />
                            <div id="pdfViewer2" style="height:100%; display: flex;flex-direction: column;align-items: center;" ></div>
                        </p:outputPanel>
                        
                        <p:outputPanel rendered="#{empty cntjTareaBean.contenidoPdf}" style="display: flex; flex-direction: column;  align-items: center; justify-content: center;">
                            <p>No hay información para visualizar, debe seleccionar un documento para realizar la previsualización.</p>
                        </p:outputPanel>
                        
                        
                    </h:form>
                </div>  
                <div class="nuevoFooter">
                    <p:button value="Salir" class="boton btn-oscuro" onclick="PF('dialogoPreVisualizarDoc').hide(); return false;"  />                    
                </div>
            </p:dialog>
            
            
            
            
            
            <script type="text/javascript">
                                
                function actualizarCampoPorDataId(idCampo, valor) {
                    const campos = document.querySelectorAll('[data-id]');                   
                    if (campos) {
                        campos.forEach(campo => {
                            if (campo.getAttribute('data-id') === 'campo-'+idCampo) {
                                const clientId = campo.id;
                                document.getElementById(clientId).value = valor;
                            }                            
                        });
                    }
                }
                
                function actualizarCampoEditorPorDataId(idCampo, valor) {
                    const campos = document.querySelectorAll('[data-id]');                    
                    if (campos) {
                        campos.forEach(campo => {
                            if (campo.getAttribute('data-id') === 'campo-'+idCampo) {
                                const editorDiv = campo.querySelector('.ql-editor');
                                if (editorDiv) {
                                    editorDiv.innerHTML = valor;
                                }                                
                            }                            
                        });
                    }
                }
                
                function cargarEstructuraSunEditor(){
                    var form = document.getElementById('frmAddEditTest');
                    if (form) {
                        var editor = form.querySelector('.sun-editor-editable');
                        if (editor) {
                            var valor = document.getElementById("frmAddEditTest:hiddenFormato").value;
                            editor.innerHTML = valor;
                        }
                    }                    
                }
                
                function removerFoco(){
                    document.getElementById('modalGestionar')?.focus();
                }

            </script>
            
        </center>
    </ui:define>

</ui:composition>
